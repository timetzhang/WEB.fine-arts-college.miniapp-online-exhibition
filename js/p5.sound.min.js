!function(root,factory){"function"==typeof define&&define.amd?define("p5.sound",["p5"],function(p5){factory(p5)}):"object"==typeof exports?factory(require("../p5")):factory(root.p5)}(this,function(p5){var shims,audiocontext,master,Master,p5sound,helpers,errorHandler,CustomError,panner,soundfile,amplitude,fft,Tone_core_Tone,Tone_signal_SignalBase,Tone_signal_WaveShaper,Tone_type_TimeBase,Tone,Tone_type_Time,Tone_type_Frequency,Tone_type_TransportTime,Tone_core_Emitter,Tone_core_Context,Tone_type_Type,Tone_core_Param,Tone_core_Gain,Tone_signal_Signal,Tone_signal_Add,Tone_signal_Multiply,Tone_signal_Scale,signal,oscillator,Tone_core_Timeline,Tone_signal_TimelineSignal,envelope,pulse,noise,audioin,Tone_signal_Negate,Tone_signal_Subtract,Tone_signal_GreaterThanZero,Tone_signal_GreaterThan,Tone_signal_Abs,Tone_signal_Modulo,Tone_signal_Pow,Tone_signal_AudioToGain,Tone_signal_Expr,Tone_signal_EqualPowerGain,Tone_component_CrossFade,effect,filter,src_eqFilter,eq,Effect,EQFilter,panner3d,listener3d,delay,reverb,Tone_core_TimelineState,Tone_core_Clock,metro,looper,soundloop,compressor,soundRecorder,peakdetect,gain,audioVoice,monosynth,polysynth,distortion,src_app,p5SOUND;shims=function(){!function(){function fixSetTarget(param){param&&(param.setTargetAtTime||(param.setTargetAtTime=param.setTargetValueAtTime))}window.hasOwnProperty("webkitAudioContext")&&!window.hasOwnProperty("AudioContext")&&(window.AudioContext=window.webkitAudioContext,"function"!=typeof AudioContext.prototype.createGain&&(AudioContext.prototype.createGain=AudioContext.prototype.createGainNode),"function"!=typeof AudioContext.prototype.createDelay&&(AudioContext.prototype.createDelay=AudioContext.prototype.createDelayNode),"function"!=typeof AudioContext.prototype.createScriptProcessor&&(AudioContext.prototype.createScriptProcessor=AudioContext.prototype.createJavaScriptNode),"function"!=typeof AudioContext.prototype.createPeriodicWave&&(AudioContext.prototype.createPeriodicWave=AudioContext.prototype.createWaveTable),AudioContext.prototype.internal_createGain=AudioContext.prototype.createGain,AudioContext.prototype.createGain=function(){var node=this.internal_createGain();return fixSetTarget(node.gain),node},AudioContext.prototype.internal_createDelay=AudioContext.prototype.createDelay,AudioContext.prototype.createDelay=function(maxDelayTime){var node=maxDelayTime?this.internal_createDelay(maxDelayTime):this.internal_createDelay();return fixSetTarget(node.delayTime),node},AudioContext.prototype.internal_createBufferSource=AudioContext.prototype.createBufferSource,AudioContext.prototype.createBufferSource=function(){var node=this.internal_createBufferSource();return node.start?(node.internal_start=node.start,node.start=function(when,offset,duration){void 0!==duration?node.internal_start(when||0,offset,duration):node.internal_start(when||0,offset||0)}):node.start=function(when,offset,duration){offset||duration?this.noteGrainOn(when||0,offset,duration):this.noteOn(when||0)},node.stop?(node.internal_stop=node.stop,node.stop=function(when){node.internal_stop(when||0)}):node.stop=function(when){this.noteOff(when||0)},fixSetTarget(node.playbackRate),node},AudioContext.prototype.internal_createDynamicsCompressor=AudioContext.prototype.createDynamicsCompressor,AudioContext.prototype.createDynamicsCompressor=function(){var node=this.internal_createDynamicsCompressor();return fixSetTarget(node.threshold),fixSetTarget(node.knee),fixSetTarget(node.ratio),fixSetTarget(node.reduction),fixSetTarget(node.attack),fixSetTarget(node.release),node},AudioContext.prototype.internal_createBiquadFilter=AudioContext.prototype.createBiquadFilter,AudioContext.prototype.createBiquadFilter=function(){var node=this.internal_createBiquadFilter();return fixSetTarget(node.frequency),fixSetTarget(node.detune),fixSetTarget(node.Q),fixSetTarget(node.gain),node},"function"!=typeof AudioContext.prototype.createOscillator&&(AudioContext.prototype.internal_createOscillator=AudioContext.prototype.createOscillator,AudioContext.prototype.createOscillator=function(){var node=this.internal_createOscillator();return node.start?(node.internal_start=node.start,node.start=function(when){node.internal_start(when||0)}):node.start=function(when){this.noteOn(when||0)},node.stop?(node.internal_stop=node.stop,node.stop=function(when){node.internal_stop(when||0)}):node.stop=function(when){this.noteOff(when||0)},node.setPeriodicWave||(node.setPeriodicWave=node.setWaveTable),fixSetTarget(node.frequency),fixSetTarget(node.detune),node})),window.hasOwnProperty("webkitOfflineAudioContext")&&!window.hasOwnProperty("OfflineAudioContext")&&(window.OfflineAudioContext=window.webkitOfflineAudioContext)}(window),navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;var el=document.createElement("audio");p5.prototype.isSupported=function(){return!!el.canPlayType};var isOGGSupported=function(){return!!el.canPlayType&&el.canPlayType('audio/ogg; codecs="vorbis"')},isMP3Supported=function(){return!!el.canPlayType&&el.canPlayType("audio/mpeg;")},isWAVSupported=function(){return!!el.canPlayType&&el.canPlayType('audio/wav; codecs="1"')},isAACSupported=function(){return!!el.canPlayType&&(el.canPlayType("audio/x-m4a;")||el.canPlayType("audio/aac;"))},isAIFSupported=function(){return!!el.canPlayType&&el.canPlayType("audio/x-aiff;")};p5.prototype.isFileSupported=function(extension){switch(extension.toLowerCase()){case"mp3":return isMP3Supported();case"wav":return isWAVSupported();case"ogg":return isOGGSupported();case"aac":case"m4a":case"mp4":return isAACSupported();case"aif":case"aiff":return isAIFSupported();default:return!1}}}(),audiocontext=function(){var audiocontext=new window.AudioContext,iOS;if(p5.prototype.getAudioContext=function(){return audiocontext},!!navigator.userAgent.match(/(iPad|iPhone|iPod)/g)){var iosStarted=!1,startIOS=function(){if(!iosStarted){var buffer=audiocontext.createBuffer(1,1,22050),source=audiocontext.createBufferSource();source.buffer=buffer,source.connect(audiocontext.destination),source.start(0),console.log("start ios!"),"running"===audiocontext.state&&(iosStarted=!0)}};document.addEventListener("touchend",startIOS,!1),document.addEventListener("touchstart",startIOS,!1)}return audiocontext}(),p5sound=new function(){var audiocontext=p5.prototype.getAudioContext();this.input=audiocontext.createGain(),this.output=audiocontext.createGain(),this.limiter=audiocontext.createDynamicsCompressor(),this.limiter.threshold.value=-3,this.limiter.ratio.value=20,this.limiter.knee.value=1,this.audiocontext=audiocontext,this.output.disconnect(),this.input.connect(this.limiter),this.limiter.connect(this.output),this.meter=audiocontext.createGain(),this.fftMeter=audiocontext.createGain(),this.output.connect(this.meter),this.output.connect(this.fftMeter),this.output.connect(this.audiocontext.destination),this.soundArray=[],this.parts=[],this.extensions=[]},p5.prototype.getMasterVolume=function(){return p5sound.output.gain.value},p5.prototype.masterVolume=function(vol,rampTime,tFromNow){if("number"==typeof vol){var rampTime=rampTime||0,tFromNow=tFromNow||0,now=p5sound.audiocontext.currentTime,currentVol=p5sound.output.gain.value;p5sound.output.gain.cancelScheduledValues(now+tFromNow),p5sound.output.gain.linearRampToValueAtTime(currentVol,now+tFromNow),p5sound.output.gain.linearRampToValueAtTime(vol,now+tFromNow+rampTime)}else{if(!vol)return p5sound.output.gain;vol.connect(p5sound.output.gain)}},p5.prototype.soundOut=p5.soundOut=p5sound,p5.soundOut._silentNode=p5sound.audiocontext.createGain(),p5.soundOut._silentNode.gain.value=0,p5.soundOut._silentNode.connect(p5sound.audiocontext.destination),helpers=function(){var p5sound=master;p5.prototype.sampleRate=function(){return p5sound.audiocontext.sampleRate},p5.prototype.freqToMidi=function(f){var mathlog2=Math.log(f/440)/Math.log(2),m;return Math.round(12*mathlog2)+69};var midiToFreq=p5.prototype.midiToFreq=function(m){return 440*Math.pow(2,(m-69)/12)},noteToFreq=function(note){if("string"!=typeof note)return note;var wholeNotes,value={A:21,B:23,C:24,D:26,E:28,F:29,G:31}[note[0].toUpperCase()],octave;switch(value+=12*(~~note.slice(-1)-1),note[1]){case"#":value+=1;break;case"b":value-=1}return midiToFreq(value)};function convertToWav(audioBuffer){var leftChannel,rightChannel,interleaved=interleave(leftChannel=audioBuffer.getChannelData(0),rightChannel=audioBuffer.numberOfChannels>1?audioBuffer.getChannelData(1):leftChannel),buffer=new window.ArrayBuffer(44+2*interleaved.length),view=new window.DataView(buffer);writeUTFBytes(view,0,"RIFF"),view.setUint32(4,36+2*interleaved.length,!0),writeUTFBytes(view,8,"WAVE"),writeUTFBytes(view,12,"fmt "),view.setUint32(16,16,!0),view.setUint16(20,1,!0),view.setUint16(22,2,!0),view.setUint32(24,44100,!0),view.setUint32(28,176400,!0),view.setUint16(32,4,!0),view.setUint16(34,16,!0),writeUTFBytes(view,36,"data"),view.setUint32(40,2*interleaved.length,!0);for(var lng=interleaved.length,index=44,volume=1,i=0;i<lng;i++)view.setInt16(index,32767*interleaved[i],!0),index+=2;return view}function interleave(leftChannel,rightChannel){for(var length=leftChannel.length+rightChannel.length,result=new Float32Array(length),inputIndex=0,index=0;index<length;)result[index++]=leftChannel[inputIndex],result[index++]=rightChannel[inputIndex],inputIndex++;return result}function writeUTFBytes(view,offset,string){for(var lng=string.length,i=0;i<lng;i++)view.setUint8(offset+i,string.charCodeAt(i))}return p5.prototype.soundFormats=function(){p5sound.extensions=[];for(var i=0;i<arguments.length;i++){if(arguments[i]=arguments[i].toLowerCase(),!(["mp3","wav","ogg","m4a","aac"].indexOf(arguments[i])>-1))throw arguments[i]+" is not a valid sound format!";p5sound.extensions.push(arguments[i])}},p5.prototype.disposeSound=function(){for(var i=0;i<p5sound.soundArray.length;i++)p5sound.soundArray[i].dispose()},p5.prototype.registerMethod("remove",p5.prototype.disposeSound),p5.prototype._checkFileFormats=function(paths){var path;if("string"==typeof paths){var extTest=(path=paths).split(".").pop();if(["mp3","wav","ogg","m4a","aac"].indexOf(extTest)>-1)if(p5.prototype.isFileSupported(extTest))path=path;else for(var pathSplit=path.split("."),pathCore=pathSplit[pathSplit.length-1],i=0;i<p5sound.extensions.length;i++){var extension=p5sound.extensions[i],supported;if(supported=p5.prototype.isFileSupported(extension)){pathCore="",2===pathSplit.length&&(pathCore+=pathSplit[0]);for(var i=1;i<=pathSplit.length-2;i++){var p;pathCore+="."+pathSplit[i]}path=pathCore+=".",path=path+=extension;break}}else for(var i=0;i<p5sound.extensions.length;i++){var extension=p5sound.extensions[i],supported;if(supported=p5.prototype.isFileSupported(extension)){path=path+"."+extension;break}}}else if("object"==typeof paths)for(var i=0;i<paths.length;i++){var extension=paths[i].split(".").pop(),supported;if(supported=p5.prototype.isFileSupported(extension)){path=paths[i];break}}return path},p5.prototype._mathChain=function(o,math,thisChain,nextChain,type){for(var i in o.mathOps)o.mathOps[i]instanceof type&&(o.mathOps[i].dispose(),(thisChain=i)<o.mathOps.length-1&&(nextChain=o.mathOps[i+1]));return o.mathOps[thisChain-1].disconnect(),o.mathOps[thisChain-1].connect(math),math.connect(nextChain),o.mathOps[thisChain]=math,o},{convertToWav:convertToWav,midiToFreq:midiToFreq,noteToFreq:noteToFreq}}(master=p5sound),errorHandler=function(name,errorTrace,failedPath){var err=new Error,tempStack,splitStack,splitStack;return err.name=name,err.originalStack=err.stack+errorTrace,tempStack=err.stack+errorTrace,err.failedPath=failedPath,splitStack=(splitStack=tempStack.split("\n")).filter(function(ln){return!ln.match(/(p5.|native code|globalInit)/g)}),err.stack=splitStack.join("\n"),err},panner=function(){var p5sound,ac=master.audiocontext;void 0!==ac.createStereoPanner?(p5.Panner=function(input,output){this.stereoPanner=this.input=ac.createStereoPanner(),input.connect(this.stereoPanner),this.stereoPanner.connect(output)},p5.Panner.prototype.pan=function(val,tFromNow){var time=tFromNow||0,t=ac.currentTime+time;this.stereoPanner.pan.linearRampToValueAtTime(val,t)},p5.Panner.prototype.inputChannels=function(){},p5.Panner.prototype.connect=function(obj){this.stereoPanner.connect(obj)},p5.Panner.prototype.disconnect=function(){this.stereoPanner&&this.stereoPanner.disconnect()}):(p5.Panner=function(input,output,numInputChannels){this.input=ac.createGain(),input.connect(this.input),this.left=ac.createGain(),this.right=ac.createGain(),this.left.channelInterpretation="discrete",this.right.channelInterpretation="discrete",numInputChannels>1?(this.splitter=ac.createChannelSplitter(2),this.input.connect(this.splitter),this.splitter.connect(this.left,1),this.splitter.connect(this.right,0)):(this.input.connect(this.left),this.input.connect(this.right)),this.output=ac.createChannelMerger(2),this.left.connect(this.output,0,1),this.right.connect(this.output,0,0),this.output.connect(output)},p5.Panner.prototype.pan=function(val,tFromNow){var time=tFromNow||0,t=ac.currentTime+time,v=(val+1)/2,rightVal=Math.cos(v*Math.PI/2),leftVal=Math.sin(v*Math.PI/2);this.left.gain.linearRampToValueAtTime(leftVal,t),this.right.gain.linearRampToValueAtTime(rightVal,t)},p5.Panner.prototype.inputChannels=function(numChannels){1===numChannels?(this.input.disconnect(),this.input.connect(this.left),this.input.connect(this.right)):2===numChannels&&(this.splitter,this.splitter=ac.createChannelSplitter(2),this.input.disconnect(),this.input.connect(this.splitter),this.splitter.connect(this.left,1),this.splitter.connect(this.right,0))},p5.Panner.prototype.connect=function(obj){this.output.connect(obj)},p5.Panner.prototype.disconnect=function(){this.output&&this.output.disconnect()})}(master),soundfile=function(){var CustomError=errorHandler,p5sound=master,ac=p5sound.audiocontext,midiToFreq=helpers.midiToFreq,convertToWav=helpers.convertToWav;p5.SoundFile=function(paths,onload,onerror,whileLoading){if(void 0!==paths){if("string"==typeof paths||"string"==typeof paths[0]){var path=p5.prototype._checkFileFormats(paths);this.url=path}else if("object"==typeof paths&&!(window.File&&window.FileReader&&window.FileList&&window.Blob))throw"Unable to load file because the File API is not supported";paths.file&&(paths=paths.file),this.file=paths}this._onended=function(){},this._looping=!1,this._playing=!1,this._paused=!1,this._pauseTime=0,this._cues=[],this._cueIDCounter=0,this._lastPos=0,this._counterNode=null,this._scopeNode=null,this.bufferSourceNodes=[],this.bufferSourceNode=null,this.buffer=null,this.playbackRate=1,this.input=p5sound.audiocontext.createGain(),this.output=p5sound.audiocontext.createGain(),this.reversed=!1,this.startTime=0,this.endTime=null,this.pauseTime=0,this.mode="sustain",this.startMillis=null,this.panPosition=0,this.panner=new p5.Panner(this.output,p5sound.input,2),(this.url||this.file)&&this.load(onload,onerror),p5sound.soundArray.push(this),this._whileLoading="function"==typeof whileLoading?whileLoading:function(){}},p5.prototype.registerPreloadMethod("loadSound",p5.prototype),p5.prototype.loadSound=function(path,callback,onerror,whileLoading){window.location.origin.indexOf("file://")>-1&&"undefined"===window.cordova&&window.alert("This sketch may require a server to load external files. Please see http://bit.ly/1qcInwS");var self=this,s;return new p5.SoundFile(path,function(){"function"==typeof callback&&callback.apply(self,arguments),"function"==typeof self._decrementPreload&&self._decrementPreload()},onerror,whileLoading)},p5.SoundFile.prototype.load=function(callback,errorCallback){var self=this,errorTrace=(new Error).stack;if(void 0!==this.url&&""!==this.url){var request=new XMLHttpRequest;request.addEventListener("progress",function(evt){self._updateProgress(evt)},!1),request.open("GET",this.url,!0),request.responseType="arraybuffer",request.onload=function(){if(200===request.status){if(!self.panner)return;ac.decodeAudioData(request.response,function(buff){self.panner&&(self.buffer=buff,self.panner.inputChannels(buff.numberOfChannels),callback&&callback(self))},function(){if(self.panner){var err=new CustomError("decodeAudioData",errorTrace,self.url),msg="AudioContext error at decodeAudioData for "+self.url;errorCallback?(err.msg=msg,errorCallback(err)):console.error(msg+"\n The error stack trace includes: \n"+err.stack)}})}else{if(!self.panner)return;var err=new CustomError("loadSound",errorTrace,self.url),msg="Unable to load "+self.url+". The request status was: "+request.status+" ("+request.statusText+")";errorCallback?(err.message=msg,errorCallback(err)):console.error(msg+"\n The error stack trace includes: \n"+err.stack)}},request.onerror=function(){var err=new CustomError("loadSound",errorTrace,self.url),msg="There was no response from the server at "+self.url+". Check the url and internet connectivity.";errorCallback?(err.message=msg,errorCallback(err)):console.error(msg+"\n The error stack trace includes: \n"+err.stack)},request.send()}else if(void 0!==this.file){var reader=new FileReader;reader.onload=function(){self.panner&&ac.decodeAudioData(reader.result,function(buff){self.panner&&(self.buffer=buff,self.panner.inputChannels(buff.numberOfChannels),callback&&callback(self))})},reader.onerror=function(e){self.panner&&onerror&&onerror(e)},reader.readAsArrayBuffer(this.file)}},p5.SoundFile.prototype._updateProgress=function(evt){if(evt.lengthComputable){var percentComplete=evt.loaded/evt.total*.99;this._whileLoading(percentComplete,evt)}else this._whileLoading("size unknown")},p5.SoundFile.prototype.isLoaded=function(){return!!this.buffer},p5.SoundFile.prototype.play=function(startTime,rate,amp,_cueStart,duration){if(this.output){var self=this,now=p5sound.audiocontext.currentTime,cueStart,cueEnd,time=startTime||0;if(time<0&&(time=0),time+=now,void 0!==rate&&this.rate(rate),void 0!==amp&&this.setVolume(amp),!this.buffer)throw"not ready to play file, buffer has yet to load. Try preload()";if(this._pauseTime=0,"restart"===this.mode&&this.buffer&&this.bufferSourceNode&&(this.bufferSourceNode.stop(time),this._counterNode.stop(time)),"untildone"!==this.mode||!this.isPlaying()){if(this.bufferSourceNode=this._initSourceNode(),delete this._counterNode,this._counterNode=this._initCounterNode(),_cueStart){if(!(_cueStart>=0&&_cueStart<this.buffer.duration))throw"start time out of range";cueStart=_cueStart}else cueStart=0;duration&&(duration=duration<=this.buffer.duration-cueStart?duration:this.buffer.duration),this._paused?(this.bufferSourceNode.start(time,this.pauseTime,duration),this._counterNode.start(time,this.pauseTime,duration)):(this.bufferSourceNode.start(time,cueStart,duration),this._counterNode.start(time,cueStart,duration)),this._playing=!0,this._paused=!1,this.bufferSourceNodes.push(this.bufferSourceNode),this.bufferSourceNode._arrayIndex=this.bufferSourceNodes.length-1;var clearOnEnd=function(){this._playing=!1,this.removeEventListener("ended",clearOnEnd,!1),self._onended(self),self.bufferSourceNodes.forEach(function(n,i){!1===n._playing&&self.bufferSourceNodes.splice(i)}),0===self.bufferSourceNodes.length&&(self._playing=!1)};this.bufferSourceNode.onended=clearOnEnd,this.bufferSourceNode.loop=this._looping,this._counterNode.loop=this._looping,!0===this._looping&&(cueEnd=duration||cueStart-1e-15,this.bufferSourceNode.loopStart=cueStart,this.bufferSourceNode.loopEnd=cueEnd,this._counterNode.loopStart=cueStart,this._counterNode.loopEnd=cueEnd)}}else console.warn("SoundFile.play() called after dispose")},p5.SoundFile.prototype.playMode=function(str){var s=str.toLowerCase();if("restart"===s&&this.buffer&&this.bufferSourceNode)for(var i=0;i<this.bufferSourceNodes.length-1;i++){var now=p5sound.audiocontext.currentTime;this.bufferSourceNodes[i].stop(now)}if("restart"!==s&&"sustain"!==s&&"untildone"!==s)throw'Invalid play mode. Must be either "restart" or "sustain"';this.mode=s},p5.SoundFile.prototype.pause=function(startTime){var now=p5sound.audiocontext.currentTime,time,pTime=(startTime||0)+now;this.isPlaying()&&this.buffer&&this.bufferSourceNode?(this.pauseTime=this.currentTime(),this.bufferSourceNode.stop(pTime),this._counterNode.stop(pTime),this._paused=!0,this._playing=!1,this._pauseTime=this.currentTime()):this._pauseTime=0},p5.SoundFile.prototype.loop=function(startTime,rate,amp,loopStart,duration){this._looping=!0,this.play(startTime,rate,amp,loopStart,duration)},p5.SoundFile.prototype.setLoop=function(bool){if(!0===bool)this._looping=!0;else{if(!1!==bool)throw"Error: setLoop accepts either true or false";this._looping=!1}this.bufferSourceNode&&(this.bufferSourceNode.loop=this._looping,this._counterNode.loop=this._looping)},p5.SoundFile.prototype.isLooping=function(){return!!this.bufferSourceNode&&(!0===this._looping&&!0===this.isPlaying())},p5.SoundFile.prototype.isPlaying=function(){return this._playing},p5.SoundFile.prototype.isPaused=function(){return this._paused},p5.SoundFile.prototype.stop=function(timeFromNow){var time=timeFromNow||0;if("sustain"===this.mode||"untildone"===this.mode)this.stopAll(time),this._playing=!1,this.pauseTime=0,this._paused=!1;else if(this.buffer&&this.bufferSourceNode){var now=p5sound.audiocontext.currentTime,t=time||0;this.pauseTime=0,this.bufferSourceNode.stop(now+t),this._counterNode.stop(now+t),this._playing=!1,this._paused=!1}},p5.SoundFile.prototype.stopAll=function(_time){var now=p5sound.audiocontext.currentTime,time=_time||0;if(this.buffer&&this.bufferSourceNode){for(var i=0;i<this.bufferSourceNodes.length;i++)if(void 0!==typeof this.bufferSourceNodes[i])try{this.bufferSourceNodes[i].onended=function(){},this.bufferSourceNodes[i].stop(now+time)}catch(e){}this._counterNode.stop(now+time),this._onended(this)}},p5.SoundFile.prototype.setVolume=function(vol,_rampTime,_tFromNow){if("number"==typeof vol){var rampTime=_rampTime||0,tFromNow=_tFromNow||0,now=p5sound.audiocontext.currentTime,currentVol=this.output.gain.value;this.output.gain.cancelScheduledValues(now+tFromNow),this.output.gain.linearRampToValueAtTime(currentVol,now+tFromNow),this.output.gain.linearRampToValueAtTime(vol,now+tFromNow+rampTime)}else{if(!vol)return this.output.gain;vol.connect(this.output.gain)}},p5.SoundFile.prototype.amp=p5.SoundFile.prototype.setVolume,p5.SoundFile.prototype.fade=p5.SoundFile.prototype.setVolume,p5.SoundFile.prototype.getVolume=function(){return this.output.gain.value},p5.SoundFile.prototype.pan=function(pval,tFromNow){this.panPosition=pval,this.panner.pan(pval,tFromNow)},p5.SoundFile.prototype.getPan=function(){return this.panPosition},p5.SoundFile.prototype.rate=function(playbackRate){var reverse=!1;if(void 0===playbackRate)return this.playbackRate;if(this.playbackRate=playbackRate,0===playbackRate?playbackRate=1e-13:playbackRate<0&&!this.reversed?(playbackRate=Math.abs(playbackRate),reverse=!0):playbackRate>0&&this.reversed&&(reverse=!0),this.bufferSourceNode){var now=p5sound.audiocontext.currentTime;this.bufferSourceNode.playbackRate.cancelScheduledValues(now),this.bufferSourceNode.playbackRate.linearRampToValueAtTime(Math.abs(playbackRate),now),this._counterNode.playbackRate.cancelScheduledValues(now),this._counterNode.playbackRate.linearRampToValueAtTime(Math.abs(playbackRate),now)}return reverse&&this.reverseBuffer(),this.playbackRate},p5.SoundFile.prototype.setPitch=function(num){var newPlaybackRate=midiToFreq(num)/midiToFreq(60);this.rate(newPlaybackRate)},p5.SoundFile.prototype.getPlaybackRate=function(){return this.playbackRate},p5.SoundFile.prototype.duration=function(){return this.buffer?this.buffer.duration:0},p5.SoundFile.prototype.currentTime=function(){return this.reversed?Math.abs(this._lastPos-this.buffer.length)/ac.sampleRate:this._lastPos/ac.sampleRate},p5.SoundFile.prototype.jump=function(cueTime,duration){if(cueTime<0||cueTime>this.buffer.duration)throw"jump time out of range";if(duration>this.buffer.duration-cueTime)throw"end time out of range";var cTime=cueTime||0,dur=duration||void 0;this.isPlaying()&&this.stop(0),this.play(0,this.playbackRate,this.output.gain.value,cTime,dur)},p5.SoundFile.prototype.channels=function(){return this.buffer.numberOfChannels},p5.SoundFile.prototype.sampleRate=function(){return this.buffer.sampleRate},p5.SoundFile.prototype.frames=function(){return this.buffer.length},p5.SoundFile.prototype.getPeaks=function(length){if(!this.buffer)throw"Cannot load peaks yet, buffer is not loaded";if(length||(length=5*window.width),this.buffer){for(var buffer=this.buffer,sampleSize=buffer.length/length,sampleStep=~~(sampleSize/10)||1,channels=buffer.numberOfChannels,peaks=new Float32Array(Math.round(length)),c=0;c<channels;c++)for(var chan=buffer.getChannelData(c),i=0;i<length;i++){for(var start=~~(i*sampleSize),end=~~(start+sampleSize),max=0,j=start;j<end;j+=sampleStep){var value=chan[j];value>max?max=value:-value>max&&(max=value)}(0===c||Math.abs(max)>peaks[i])&&(peaks[i]=max)}return peaks}},p5.SoundFile.prototype.reverseBuffer=function(){if(!this.buffer)throw"SoundFile is not done loading";{var currentPos=this._lastPos/ac.sampleRate,curVol=this.getVolume();this.setVolume(0,.001);const numChannels=this.buffer.numberOfChannels;for(var i=0;i<numChannels;i++)this.buffer.getChannelData(i).reverse();this.reversed=!this.reversed,currentPos&&this.jump(this.duration()-currentPos),this.setVolume(curVol,.001)}},p5.SoundFile.prototype.onended=function(callback){return this._onended=callback,this},p5.SoundFile.prototype.add=function(){},p5.SoundFile.prototype.dispose=function(){var now=p5sound.audiocontext.currentTime,index=p5sound.soundArray.indexOf(this);if(p5sound.soundArray.splice(index,1),this.stop(now),this.buffer&&this.bufferSourceNode){for(var i=0;i<this.bufferSourceNodes.length-1;i++)if(null!==this.bufferSourceNodes[i]){this.bufferSourceNodes[i].disconnect();try{this.bufferSourceNodes[i].stop(now)}catch(e){console.warning("no buffer source node to dispose")}this.bufferSourceNodes[i]=null}if(this.isPlaying()){try{this._counterNode.stop(now)}catch(e){console.log(e)}this._counterNode=null}}this.output&&(this.output.disconnect(),this.output=null),this.panner&&(this.panner.disconnect(),this.panner=null)},p5.SoundFile.prototype.connect=function(unit){unit?unit.hasOwnProperty("input")?this.panner.connect(unit.input):this.panner.connect(unit):this.panner.connect(p5sound.input)},p5.SoundFile.prototype.disconnect=function(){this.panner&&this.panner.disconnect()},p5.SoundFile.prototype.getLevel=function(){console.warn("p5.SoundFile.getLevel has been removed from the library. Use p5.Amplitude instead")},p5.SoundFile.prototype.setPath=function(p,callback){var path=p5.prototype._checkFileFormats(p);this.url=path,this.load(callback)},p5.SoundFile.prototype.setBuffer=function(buf){var numChannels=buf.length,size=buf[0].length,newBuffer=ac.createBuffer(numChannels,size,ac.sampleRate);buf[0]instanceof Float32Array||(buf[0]=new Float32Array(buf[0]));for(var channelNum=0;channelNum<numChannels;channelNum++){var channel;newBuffer.getChannelData(channelNum).set(buf[channelNum])}this.buffer=newBuffer,this.panner.inputChannels(numChannels)};var _createCounterBuffer=function(buffer){const len=buffer.length,audioBuf=ac.createBuffer(1,buffer.length,ac.sampleRate),arrayBuffer=audioBuf.getChannelData(0);for(var index=0;index<len;index++)arrayBuffer[index]=index;return audioBuf};p5.SoundFile.prototype._initCounterNode=function(){var self=this,now=ac.currentTime,cNode=ac.createBufferSource();return self._scopeNode&&(self._scopeNode.disconnect(),delete self._scopeNode.onaudioprocess,delete self._scopeNode),self._scopeNode=ac.createScriptProcessor(256,1,1),cNode.buffer=_createCounterBuffer(self.buffer),cNode.playbackRate.setValueAtTime(self.playbackRate,now),cNode.connect(self._scopeNode),self._scopeNode.connect(p5.soundOut._silentNode),self._scopeNode.onaudioprocess=function(processEvent){var inputBuffer=processEvent.inputBuffer.getChannelData(0);self._lastPos=inputBuffer[inputBuffer.length-1]||0,self._onTimeUpdate(self._lastPos)},cNode},p5.SoundFile.prototype._initSourceNode=function(){var bufferSourceNode=ac.createBufferSource();return bufferSourceNode.buffer=this.buffer,bufferSourceNode.playbackRate.value=this.playbackRate,bufferSourceNode.connect(this.output),bufferSourceNode},p5.SoundFile.prototype.processPeaks=function(callback,_initThreshold,_minThreshold,_minPeaks){var bufLen=this.buffer.length,sampleRate=this.buffer.sampleRate,buffer=this.buffer,allPeaks=[],initialThreshold,threshold=_initThreshold||.9,minThreshold=_minThreshold||.22,minPeaks=_minPeaks||200,offlineContext=new window.OfflineAudioContext(1,bufLen,sampleRate),source=offlineContext.createBufferSource();source.buffer=buffer;var filter=offlineContext.createBiquadFilter();filter.type="lowpass",source.connect(filter),filter.connect(offlineContext.destination),source.start(0),offlineContext.startRendering(),offlineContext.oncomplete=function(e){if(self.panner){var filteredBuffer=e.renderedBuffer,bufferData=filteredBuffer.getChannelData(0);do{allPeaks=getPeaksAtThreshold(bufferData,threshold),threshold-=.005}while(Object.keys(allPeaks).length<minPeaks&&threshold>=minThreshold);var intervalCounts,groups,topTempos=groupNeighborsByTempo(countIntervalsBetweenNearbyPeaks(allPeaks),filteredBuffer.sampleRate).sort(function(intA,intB){return intB.count-intA.count}).splice(0,5);this.tempo=topTempos[0].tempo;var bpmVariance=5,tempoPeaks=getPeaksAtTopTempo(allPeaks,topTempos[0].tempo,filteredBuffer.sampleRate,5);callback(tempoPeaks)}}};var Peak=function(amp,i){this.sampleIndex=i,this.amplitude=amp,this.tempos=[],this.intervals=[]};function getPeaksAtThreshold(data,threshold){for(var peaksObj={},length=data.length,i=0;i<length;i++){if(data[i]>threshold){var amp=data[i],peak=new Peak(amp,i);peaksObj[i]=peak,i+=6e3}i++}return peaksObj}function countIntervalsBetweenNearbyPeaks(peaksObj){for(var intervalCounts=[],peaksArray=Object.keys(peaksObj).sort(),index=0;index<peaksArray.length;index++)for(var i=0;i<10;i++){var startPeak=peaksObj[peaksArray[index]],endPeak=peaksObj[peaksArray[index+i]];if(startPeak&&endPeak){var startPos=startPeak.sampleIndex,endPos,interval=endPeak.sampleIndex-startPos,foundInterval;interval>0&&startPeak.intervals.push(interval),intervalCounts.some(function(intervalCount){if(intervalCount.interval===interval)return intervalCount.count++,intervalCount})||intervalCounts.push({interval:interval,count:1})}}return intervalCounts}function groupNeighborsByTempo(intervalCounts,sampleRate){var tempoCounts=[];return intervalCounts.forEach(function(intervalCount){try{var theoreticalTempo=Math.abs(60/(intervalCount.interval/sampleRate)),foundTempo;if(theoreticalTempo=mapTempo(theoreticalTempo),!tempoCounts.some(function(tempoCount){if(tempoCount.tempo===theoreticalTempo)return tempoCount.count+=intervalCount.count})){if(isNaN(theoreticalTempo))return;tempoCounts.push({tempo:Math.round(theoreticalTempo),count:intervalCount.count})}}catch(e){throw e}}),tempoCounts}function getPeaksAtTopTempo(peaksObj,tempo,sampleRate,bpmVariance){for(var peaksAtTopTempo=[],peaksArray=Object.keys(peaksObj).sort(),i=0;i<peaksArray.length;i++)for(var key,peak=peaksObj[peaksArray[i]],j=0;j<peak.intervals.length;j++){var intervalBPM=Math.round(Math.abs(60/(peak.intervals[j]/sampleRate)));intervalBPM=mapTempo(intervalBPM),Math.abs(intervalBPM-tempo)<bpmVariance&&peaksAtTopTempo.push(peak.sampleIndex/sampleRate)}return peaksAtTopTempo=peaksAtTopTempo.filter(function(peakTime,index,arr){var dif;if(arr[index+1]-peakTime>.01)return!0})}function mapTempo(theoreticalTempo){if(isFinite(theoreticalTempo)&&0!==theoreticalTempo){for(;theoreticalTempo<90;)theoreticalTempo*=2;for(;theoreticalTempo>180&&theoreticalTempo>90;)theoreticalTempo/=2;return theoreticalTempo}}var Cue=function(callback,time,id,val){this.callback=callback,this.time=time,this.id=id,this.val=val};p5.SoundFile.prototype.addCue=function(time,callback,val){var id=this._cueIDCounter++,cue=new Cue(callback,time,id,val);return this._cues.push(cue),id},p5.SoundFile.prototype.removeCue=function(id){for(var cueLength=this._cues.length,i=0;i<cueLength;i++){var cue;if(this._cues[i].id===id){this._cues.splice(i,1);break}}this._cues.length},p5.SoundFile.prototype.clearCues=function(){this._cues=[]},p5.SoundFile.prototype._onTimeUpdate=function(position){for(var playbackTime=position/this.buffer.sampleRate,cueLength=this._cues.length,i=0;i<cueLength;i++){var cue=this._cues[i],callbackTime=cue.time,val=cue.val;this._prevTime<callbackTime&&callbackTime<=playbackTime&&cue.callback(val)}this._prevTime=playbackTime},p5.SoundFile.prototype.save=function(fileName){const dataView=convertToWav(this.buffer);p5.prototype.saveSound([dataView],fileName,"wav")},p5.SoundFile.prototype.getBlob=function(){const dataView=convertToWav(this.buffer);return new Blob([dataView],{type:"audio/wav"})}}(errorHandler,master,helpers,helpers),amplitude=function(){var p5sound=master;p5.Amplitude=function(smoothing){this.bufferSize=2048,this.audiocontext=p5sound.audiocontext,this.processor=this.audiocontext.createScriptProcessor(this.bufferSize,2,1),this.input=this.processor,this.output=this.audiocontext.createGain(),this.smoothing=smoothing||0,this.volume=0,this.average=0,this.stereoVol=[0,0],this.stereoAvg=[0,0],this.stereoVolNorm=[0,0],this.volMax=.001,this.normalize=!1,this.processor.onaudioprocess=this._audioProcess.bind(this),this.processor.connect(this.output),this.output.gain.value=0,this.output.connect(this.audiocontext.destination),p5sound.meter.connect(this.processor),p5sound.soundArray.push(this)},p5.Amplitude.prototype.setInput=function(source,smoothing){p5sound.meter.disconnect(),smoothing&&(this.smoothing=smoothing),null==source?(console.log("Amplitude input source is not ready! Connecting to master output instead"),p5sound.meter.connect(this.processor)):source instanceof p5.Signal?source.output.connect(this.processor):source?(source.connect(this.processor),this.processor.disconnect(),this.processor.connect(this.output)):p5sound.meter.connect(this.processor)},p5.Amplitude.prototype.connect=function(unit){unit?unit.hasOwnProperty("input")?this.output.connect(unit.input):this.output.connect(unit):this.output.connect(this.panner.connect(p5sound.input))},p5.Amplitude.prototype.disconnect=function(){this.output&&this.output.disconnect()},p5.Amplitude.prototype._audioProcess=function(event){for(var channel=0;channel<event.inputBuffer.numberOfChannels;channel++){for(var inputBuffer=event.inputBuffer.getChannelData(channel),bufLength=inputBuffer.length,total=0,sum=0,x,i=0;i<bufLength;i++)x=inputBuffer[i],this.normalize?(total+=Math.max(Math.min(x/this.volMax,1),-1),sum+=Math.max(Math.min(x/this.volMax,1),-1)*Math.max(Math.min(x/this.volMax,1),-1)):(total+=x,sum+=x*x);var average=total/bufLength,rms=Math.sqrt(sum/bufLength);this.stereoVol[channel]=Math.max(rms,this.stereoVol[channel]*this.smoothing),this.stereoAvg[channel]=Math.max(average,this.stereoVol[channel]*this.smoothing),this.volMax=Math.max(this.stereoVol[channel],this.volMax)}var self=this,volSum=this.stereoVol.reduce(function(previousValue,currentValue,index){return self.stereoVolNorm[index-1]=Math.max(Math.min(self.stereoVol[index-1]/self.volMax,1),0),self.stereoVolNorm[index]=Math.max(Math.min(self.stereoVol[index]/self.volMax,1),0),previousValue+currentValue});this.volume=volSum/this.stereoVol.length,this.volNorm=Math.max(Math.min(this.volume/this.volMax,1),0)},p5.Amplitude.prototype.getLevel=function(channel){return void 0!==channel?this.normalize?this.stereoVolNorm[channel]:this.stereoVol[channel]:this.normalize?this.volNorm:this.volume},p5.Amplitude.prototype.toggleNormalize=function(bool){this.normalize="boolean"==typeof bool?bool:!this.normalize},p5.Amplitude.prototype.smooth=function(s){s>=0&&s<1?this.smoothing=s:console.log("Error: smoothing must be between 0 and 1")},p5.Amplitude.prototype.dispose=function(){var index=p5sound.soundArray.indexOf(this);p5sound.soundArray.splice(index,1),this.input&&(this.input.disconnect(),delete this.input),this.output&&(this.output.disconnect(),delete this.output),delete this.processor}}(master),fft=function(){var p5sound=master;p5.FFT=function(smoothing,bins){this.input=this.analyser=p5sound.audiocontext.createAnalyser(),Object.defineProperties(this,{bins:{get:function(){return this.analyser.fftSize/2},set:function(b){this.analyser.fftSize=2*b},configurable:!0,enumerable:!0},smoothing:{get:function(){return this.analyser.smoothingTimeConstant},set:function(s){this.analyser.smoothingTimeConstant=s},configurable:!0,enumerable:!0}}),this.smooth(smoothing),this.bins=bins||1024,p5sound.fftMeter.connect(this.analyser),this.freqDomain=new Uint8Array(this.analyser.frequencyBinCount),this.timeDomain=new Uint8Array(this.analyser.frequencyBinCount),this.bass=[20,140],this.lowMid=[140,400],this.mid=[400,2600],this.highMid=[2600,5200],this.treble=[5200,14e3],p5sound.soundArray.push(this)},p5.FFT.prototype.setInput=function(source){source?(source.output?source.output.connect(this.analyser):source.connect&&source.connect(this.analyser),p5sound.fftMeter.disconnect()):p5sound.fftMeter.connect(this.analyser)},p5.FFT.prototype.waveform=function(){for(var bins,mode,normalArray,i=0;i<arguments.length;i++)"number"==typeof arguments[i]&&(bins=arguments[i],this.analyser.fftSize=2*bins),"string"==typeof arguments[i]&&(mode=arguments[i]);if(mode&&!p5.prototype._isSafari())return timeToFloat(this,this.timeDomain),this.analyser.getFloatTimeDomainData(this.timeDomain),this.timeDomain;timeToInt(this,this.timeDomain),this.analyser.getByteTimeDomainData(this.timeDomain);for(var normalArray=new Array,j=0;j<this.timeDomain.length;j++){var scaled=p5.prototype.map(this.timeDomain[j],0,255,-1,1);normalArray.push(scaled)}return normalArray},p5.FFT.prototype.analyze=function(){for(var mode,i=0;i<arguments.length;i++)"number"==typeof arguments[i]&&(this.bins=arguments[i],this.analyser.fftSize=2*this.bins),"string"==typeof arguments[i]&&(mode=arguments[i]);if(mode&&"db"===mode.toLowerCase())return freqToFloat(this),this.analyser.getFloatFrequencyData(this.freqDomain),this.freqDomain;freqToInt(this,this.freqDomain),this.analyser.getByteFrequencyData(this.freqDomain);var normalArray=Array.apply([],this.freqDomain);return normalArray.length,this.analyser.fftSize,normalArray.constructor,Array,normalArray},p5.FFT.prototype.getEnergy=function(frequency1,frequency2){var nyquist=p5sound.audiocontext.sampleRate/2;if("bass"===frequency1?(frequency1=this.bass[0],frequency2=this.bass[1]):"lowMid"===frequency1?(frequency1=this.lowMid[0],frequency2=this.lowMid[1]):"mid"===frequency1?(frequency1=this.mid[0],frequency2=this.mid[1]):"highMid"===frequency1?(frequency1=this.highMid[0],frequency2=this.highMid[1]):"treble"===frequency1&&(frequency1=this.treble[0],frequency2=this.treble[1]),"number"!=typeof frequency1)throw"invalid input for getEnergy()";if(frequency2){if(frequency1&&frequency2){if(frequency1>frequency2){var swap=frequency2;frequency2=frequency1,frequency1=swap}for(var lowIndex=Math.round(frequency1/nyquist*this.freqDomain.length),highIndex=Math.round(frequency2/nyquist*this.freqDomain.length),total=0,numFrequencies=0,i=lowIndex;i<=highIndex;i++)total+=this.freqDomain[i],numFrequencies+=1;var toReturn;return total/numFrequencies}throw"invalid input for getEnergy()"}var index=Math.round(frequency1/nyquist*this.freqDomain.length);return this.freqDomain[index]},p5.FFT.prototype.getFreq=function(freq1,freq2){var x;return console.log("getFreq() is deprecated. Please use getEnergy() instead."),this.getEnergy(freq1,freq2)},p5.FFT.prototype.getCentroid=function(){for(var nyquist=p5sound.audiocontext.sampleRate/2,cumulative_sum=0,centroid_normalization=0,i=0;i<this.freqDomain.length;i++)cumulative_sum+=i*this.freqDomain[i],centroid_normalization+=this.freqDomain[i];var mean_freq_index=0,spec_centroid_freq;return 0!==centroid_normalization&&(mean_freq_index=cumulative_sum/centroid_normalization),mean_freq_index*(nyquist/this.freqDomain.length)},p5.FFT.prototype.smooth=function(s){return void 0!==s&&(this.smoothing=s),this.smoothing},p5.FFT.prototype.dispose=function(){var index=p5sound.soundArray.indexOf(this);p5sound.soundArray.splice(index,1),this.analyser&&(this.analyser.disconnect(),delete this.analyser)},p5.FFT.prototype.linAverages=function(N){for(var N=N||16,spectrum=this.freqDomain,spectrumLength=spectrum.length,spectrumStep=Math.floor(spectrumLength/N),linearAverages=new Array(N),groupIndex=0,specIndex=0;specIndex<spectrumLength;specIndex++)linearAverages[groupIndex]=void 0!==linearAverages[groupIndex]?(linearAverages[groupIndex]+spectrum[specIndex])/2:spectrum[specIndex],specIndex%spectrumStep==spectrumStep-1&&groupIndex++;return linearAverages},p5.FFT.prototype.logAverages=function(octaveBands){for(var nyquist=p5sound.audiocontext.sampleRate/2,spectrum=this.freqDomain,spectrumLength=spectrum.length,logAverages=new Array(octaveBands.length),octaveIndex=0,specIndex=0;specIndex<spectrumLength;specIndex++){var specIndexFrequency;Math.round(specIndex*nyquist/this.freqDomain.length)>octaveBands[octaveIndex].hi&&octaveIndex++,logAverages[octaveIndex]=void 0!==logAverages[octaveIndex]?(logAverages[octaveIndex]+spectrum[specIndex])/2:spectrum[specIndex]}return logAverages},p5.FFT.prototype.getOctaveBands=function(N,fCtr0){var N=N||3,fCtr0,octaveBands=[],lastFrequencyBand={lo:(fCtr0=fCtr0||15.625)/Math.pow(2,1/(2*N)),ctr:fCtr0,hi:fCtr0*Math.pow(2,1/(2*N))};octaveBands.push(lastFrequencyBand);for(var nyquist=p5sound.audiocontext.sampleRate/2;lastFrequencyBand.hi<nyquist;){var newFrequencyBand={};newFrequencyBand.lo=lastFrequencyBand.hi,newFrequencyBand.ctr=lastFrequencyBand.ctr*Math.pow(2,1/N),newFrequencyBand.hi=newFrequencyBand.ctr*Math.pow(2,1/(2*N)),octaveBands.push(newFrequencyBand),lastFrequencyBand=newFrequencyBand}return octaveBands};var freqToFloat=function(fft){fft.freqDomain instanceof Float32Array==!1&&(fft.freqDomain=new Float32Array(fft.analyser.frequencyBinCount))},freqToInt=function(fft){fft.freqDomain instanceof Uint8Array==!1&&(fft.freqDomain=new Uint8Array(fft.analyser.frequencyBinCount))},timeToFloat=function(fft){fft.timeDomain instanceof Float32Array==!1&&(fft.timeDomain=new Float32Array(fft.analyser.frequencyBinCount))},timeToInt=function(fft){fft.timeDomain instanceof Uint8Array==!1&&(fft.timeDomain=new Uint8Array(fft.analyser.frequencyBinCount))}}(master),Tone_signal_SignalBase=function(Tone){"use strict";return Tone.SignalBase=function(){},Tone.extend(Tone.SignalBase),Tone.SignalBase.prototype.connect=function(node,outputNumber,inputNumber){return Tone.Signal&&Tone.Signal===node.constructor||Tone.Param&&Tone.Param===node.constructor||Tone.TimelineSignal&&Tone.TimelineSignal===node.constructor?(node._param.cancelScheduledValues(0),node._param.value=0,node.overridden=!0):node instanceof AudioParam&&(node.cancelScheduledValues(0),node.value=0),Tone.prototype.connect.call(this,node,outputNumber,inputNumber),this},Tone.SignalBase}(Tone_core_Tone=function(){"use strict";var Tone=function(inputs,outputs){this.isUndef(inputs)||1===inputs?this.input=this.context.createGain():inputs>1&&(this.input=new Array(inputs)),this.isUndef(outputs)||1===outputs?this.output=this.context.createGain():outputs>1&&(this.output=new Array(inputs))},audioContext;return Tone.prototype.set=function(params,value,rampTime){if(this.isObject(params))rampTime=value;else if(this.isString(params)){var tmpObj={};tmpObj[params]=value,params=tmpObj}paramLoop:for(var attr in params){value=params[attr];var parent=this;if(-1!==attr.indexOf(".")){for(var attrSplit=attr.split("."),i=0;i<attrSplit.length-1;i++)if((parent=parent[attrSplit[i]])instanceof Tone){attrSplit.splice(0,i+1);var innerParam=attrSplit.join(".");parent.set(innerParam,value);continue paramLoop}attr=attrSplit[attrSplit.length-1]}var param=parent[attr];this.isUndef(param)||(Tone.Signal&&param instanceof Tone.Signal||Tone.Param&&param instanceof Tone.Param?param.value!==value&&(this.isUndef(rampTime)?param.value=value:param.rampTo(value,rampTime)):param instanceof AudioParam?param.value!==value&&(param.value=value):param instanceof Tone?param.set(value):param!==value&&(parent[attr]=value))}return this},Tone.prototype.get=function(params){this.isUndef(params)?params=this._collectDefaults(this.constructor):this.isString(params)&&(params=[params]);for(var ret={},i=0;i<params.length;i++){var attr=params[i],parent=this,subRet=ret;if(-1!==attr.indexOf(".")){for(var attrSplit=attr.split("."),j=0;j<attrSplit.length-1;j++){var subAttr=attrSplit[j];subRet[subAttr]=subRet[subAttr]||{},subRet=subRet[subAttr],parent=parent[subAttr]}attr=attrSplit[attrSplit.length-1]}var param=parent[attr];this.isObject(params[attr])?subRet[attr]=param.get():Tone.Signal&&param instanceof Tone.Signal?subRet[attr]=param.value:Tone.Param&&param instanceof Tone.Param?subRet[attr]=param.value:param instanceof AudioParam?subRet[attr]=param.value:param instanceof Tone?subRet[attr]=param.get():this.isFunction(param)||this.isUndef(param)||(subRet[attr]=param)}return ret},Tone.prototype._collectDefaults=function(constr){var ret=[];if(this.isUndef(constr.defaults)||(ret=Object.keys(constr.defaults)),!this.isUndef(constr._super))for(var superDefs=this._collectDefaults(constr._super),i=0;i<superDefs.length;i++)-1===ret.indexOf(superDefs[i])&&ret.push(superDefs[i]);return ret},Tone.prototype.toString=function(){for(var className in Tone){var isLetter=className[0].match(/^[A-Z]$/),sameConstructor=Tone[className]===this.constructor;if(this.isFunction(Tone[className])&&isLetter&&sameConstructor)return className}return"Tone"},Object.defineProperty(Tone.prototype,"numberOfInputs",{get:function(){return this.input?this.isArray(this.input)?this.input.length:1:0}}),Object.defineProperty(Tone.prototype,"numberOfOutputs",{get:function(){return this.output?this.isArray(this.output)?this.output.length:1:0}}),Tone.prototype.dispose=function(){return this.isUndef(this.input)||(this.input instanceof AudioNode&&this.input.disconnect(),this.input=null),this.isUndef(this.output)||(this.output instanceof AudioNode&&this.output.disconnect(),this.output=null),this},Tone.prototype.connect=function(unit,outputNum,inputNum){return Array.isArray(this.output)?(outputNum=this.defaultArg(outputNum,0),this.output[outputNum].connect(unit,0,inputNum)):this.output.connect(unit,outputNum,inputNum),this},Tone.prototype.disconnect=function(destination,outputNum,inputNum){this.isArray(this.output)?this.isNumber(destination)?this.output[destination].disconnect():(outputNum=this.defaultArg(outputNum,0),this.output[outputNum].disconnect(destination,0,inputNum)):this.output.disconnect.apply(this.output,arguments)},Tone.prototype.connectSeries=function(){if(arguments.length>1)for(var currentUnit=arguments[0],i=1;i<arguments.length;i++){var toUnit=arguments[i];currentUnit.connect(toUnit),currentUnit=toUnit}return this},Tone.prototype.chain=function(){if(arguments.length>0)for(var currentUnit=this,i=0;i<arguments.length;i++){var toUnit=arguments[i];currentUnit.connect(toUnit),currentUnit=toUnit}return this},Tone.prototype.fan=function(){if(arguments.length>0)for(var i=0;i<arguments.length;i++)this.connect(arguments[i]);return this},AudioNode.prototype.chain=Tone.prototype.chain,AudioNode.prototype.fan=Tone.prototype.fan,Tone.prototype.defaultArg=function(given,fallback){if(this.isObject(given)&&this.isObject(fallback)){var ret={};for(var givenProp in given)ret[givenProp]=this.defaultArg(fallback[givenProp],given[givenProp]);for(var fallbackProp in fallback)ret[fallbackProp]=this.defaultArg(given[fallbackProp],fallback[fallbackProp]);return ret}return this.isUndef(given)?fallback:given},Tone.prototype.optionsObject=function(values,keys,defaults){var options={};if(1===values.length&&this.isObject(values[0]))options=values[0];else for(var i=0;i<keys.length;i++)options[keys[i]]=values[i];return this.isUndef(defaults)?options:this.defaultArg(options,defaults)},Tone.prototype.isUndef=function(val){return void 0===val},Tone.prototype.isFunction=function(val){return"function"==typeof val},Tone.prototype.isNumber=function(arg){return"number"==typeof arg},Tone.prototype.isObject=function(arg){return"[object Object]"===Object.prototype.toString.call(arg)&&arg.constructor===Object},Tone.prototype.isBoolean=function(arg){return"boolean"==typeof arg},Tone.prototype.isArray=function(arg){return Array.isArray(arg)},Tone.prototype.isString=function(arg){return"string"==typeof arg},Tone.noOp=function(){},Tone.prototype._readOnly=function(property){if(Array.isArray(property))for(var i=0;i<property.length;i++)this._readOnly(property[i]);else Object.defineProperty(this,property,{writable:!1,enumerable:!0})},Tone.prototype._writable=function(property){if(Array.isArray(property))for(var i=0;i<property.length;i++)this._writable(property[i]);else Object.defineProperty(this,property,{writable:!0})},Tone.State={Started:"started",Stopped:"stopped",Paused:"paused"},Tone.prototype.equalPowerScale=function(percent){var piFactor=.5*Math.PI;return Math.sin(percent*piFactor)},Tone.prototype.dbToGain=function(db){return Math.pow(2,db/6)},Tone.prototype.gainToDb=function(gain){return Math.log(gain)/Math.LN10*20},Tone.prototype.intervalToFrequencyRatio=function(interval){return Math.pow(2,interval/12)},Tone.prototype.now=function(){return Tone.context.now()},Tone.now=function(){return Tone.context.now()},Tone.extend=function(child,parent){function TempConstructor(){}Tone.prototype.isUndef(parent)&&(parent=Tone),TempConstructor.prototype=parent.prototype,child.prototype=new TempConstructor,child.prototype.constructor=child,child._super=parent},Object.defineProperty(Tone,"context",{get:function(){return audioContext},set:function(context){audioContext=Tone.Context&&context instanceof Tone.Context?context:new Tone.Context(context),Tone.Context&&Tone.Context.emit("init",audioContext)}}),Object.defineProperty(Tone.prototype,"context",{get:function(){return Tone.context}}),Tone.setContext=function(ctx){Tone.context=ctx},Object.defineProperty(Tone.prototype,"blockTime",{get:function(){return 128/this.context.sampleRate}}),Object.defineProperty(Tone.prototype,"sampleTime",{get:function(){return 1/this.context.sampleRate}}),Object.defineProperty(Tone,"supported",{get:function(){var hasAudioContext=window.hasOwnProperty("AudioContext")||window.hasOwnProperty("webkitAudioContext"),hasPromises=window.hasOwnProperty("Promise"),hasWorkers=window.hasOwnProperty("Worker");return hasAudioContext&&hasPromises&&hasWorkers}}),Tone.version="r10",window.TONE_SILENCE_VERSION_LOGGING,Tone}()),Tone_signal_WaveShaper=function(Tone){"use strict";return Tone.WaveShaper=function(mapping,bufferLen){this._shaper=this.input=this.output=this.context.createWaveShaper(),this._curve=null,Array.isArray(mapping)?this.curve=mapping:isFinite(mapping)||this.isUndef(mapping)?this._curve=new Float32Array(this.defaultArg(mapping,1024)):this.isFunction(mapping)&&(this._curve=new Float32Array(this.defaultArg(bufferLen,1024)),this.setMap(mapping))},Tone.extend(Tone.WaveShaper,Tone.SignalBase),Tone.WaveShaper.prototype.setMap=function(mapping){for(var i=0,len=this._curve.length;i<len;i++){var normalized=i/(len-1)*2-1;this._curve[i]=mapping(normalized,i)}return this._shaper.curve=this._curve,this},Object.defineProperty(Tone.WaveShaper.prototype,"curve",{get:function(){return this._shaper.curve},set:function(mapping){this._curve=new Float32Array(mapping),this._shaper.curve=this._curve}}),Object.defineProperty(Tone.WaveShaper.prototype,"oversample",{get:function(){return this._shaper.oversample},set:function(oversampling){if(-1===["none","2x","4x"].indexOf(oversampling))throw new RangeError("Tone.WaveShaper: oversampling must be either 'none', '2x', or '4x'");this._shaper.oversample=oversampling}}),Tone.WaveShaper.prototype.dispose=function(){return Tone.prototype.dispose.call(this),this._shaper.disconnect(),this._shaper=null,this._curve=null,this},Tone.WaveShaper}(Tone_core_Tone),(Tone=Tone_core_Tone).TimeBase=function(val,units){if(!(this instanceof Tone.TimeBase))return new Tone.TimeBase(val,units);if(this._expr=this._noOp,val instanceof Tone.TimeBase)this.copy(val);else if(!this.isUndef(units)||this.isNumber(val)){units=this.defaultArg(units,this._defaultUnits);var method=this._primaryExpressions[units].method;this._expr=method.bind(this,val)}else this.isString(val)?this.set(val):this.isUndef(val)&&(this._expr=this._defaultExpr())},Tone.extend(Tone.TimeBase),Tone.TimeBase.prototype.set=function(exprString){return this._expr=this._parseExprString(exprString),this},Tone.TimeBase.prototype.clone=function(){var instance=new this.constructor;return instance.copy(this),instance},Tone.TimeBase.prototype.copy=function(time){var val=time._expr();return this.set(val)},Tone.TimeBase.prototype._primaryExpressions={n:{regexp:/^(\d+)n/i,method:function(value){return 1===(value=parseInt(value))?this._beatsToUnits(this._timeSignature()):this._beatsToUnits(4/value)}},t:{regexp:/^(\d+)t/i,method:function(value){return value=parseInt(value),this._beatsToUnits(8/(3*parseInt(value)))}},m:{regexp:/^(\d+)m/i,method:function(value){return this._beatsToUnits(parseInt(value)*this._timeSignature())}},i:{regexp:/^(\d+)i/i,method:function(value){return this._ticksToUnits(parseInt(value))}},hz:{regexp:/^(\d+(?:\.\d+)?)hz/i,method:function(value){return this._frequencyToUnits(parseFloat(value))}},tr:{regexp:/^(\d+(?:\.\d+)?):(\d+(?:\.\d+)?):?(\d+(?:\.\d+)?)?/,method:function(m,q,s){var total=0;return m&&"0"!==m&&(total+=this._beatsToUnits(this._timeSignature()*parseFloat(m))),q&&"0"!==q&&(total+=this._beatsToUnits(parseFloat(q))),s&&"0"!==s&&(total+=this._beatsToUnits(parseFloat(s)/4)),total}},s:{regexp:/^(\d+(?:\.\d+)?s)/,method:function(value){return this._secondsToUnits(parseFloat(value))}},samples:{regexp:/^(\d+)samples/,method:function(value){return parseInt(value)/this.context.sampleRate}},default:{regexp:/^(\d+(?:\.\d+)?)/,method:function(value){return this._primaryExpressions[this._defaultUnits].method.call(this,value)}}},Tone.TimeBase.prototype._binaryExpressions={"+":{regexp:/^\+/,precedence:2,method:function(lh,rh){return lh()+rh()}},"-":{regexp:/^\-/,precedence:2,method:function(lh,rh){return lh()-rh()}},"*":{regexp:/^\*/,precedence:1,method:function(lh,rh){return lh()*rh()}},"/":{regexp:/^\//,precedence:1,method:function(lh,rh){return lh()/rh()}}},Tone.TimeBase.prototype._unaryExpressions={neg:{regexp:/^\-/,method:function(lh){return-lh()}}},Tone.TimeBase.prototype._syntaxGlue={"(":{regexp:/^\(/},")":{regexp:/^\)/}},Tone.TimeBase.prototype._tokenize=function(expr){for(var position=-1,tokens=[];expr.length>0;){var token=getNextToken(expr=expr.trim(),this);tokens.push(token),expr=expr.substr(token.value.length)}function getNextToken(expr,context){for(var expressions=["_binaryExpressions","_unaryExpressions","_primaryExpressions","_syntaxGlue"],i=0;i<expressions.length;i++){var group=context[expressions[i]];for(var opName in group){var op=group[opName],reg=op.regexp,match=expr.match(reg);if(null!==match)return{method:op.method,precedence:op.precedence,regexp:op.regexp,value:match[0]}}}throw new SyntaxError("Tone.TimeBase: Unexpected token "+expr)}return{next:function(){return tokens[++position]},peek:function(){return tokens[position+1]}}},Tone.TimeBase.prototype._matchGroup=function(token,group,prec){var ret=!1;if(!this.isUndef(token))for(var opName in group){var op=group[opName];if(op.regexp.test(token.value)){if(this.isUndef(prec))return op;if(op.precedence===prec)return op}}return!1},Tone.TimeBase.prototype._parseBinary=function(lexer,precedence){var expr;this.isUndef(precedence)&&(precedence=2),expr=precedence<0?this._parseUnary(lexer):this._parseBinary(lexer,precedence-1);for(var token=lexer.peek();token&&this._matchGroup(token,this._binaryExpressions,precedence);)expr=(token=lexer.next()).method.bind(this,expr,this._parseBinary(lexer,precedence-1)),token=lexer.peek();return expr},Tone.TimeBase.prototype._parseUnary=function(lexer){var token,expr;token=lexer.peek();var op=this._matchGroup(token,this._unaryExpressions);return op?(token=lexer.next(),expr=this._parseUnary(lexer),op.method.bind(this,expr)):this._parsePrimary(lexer)},Tone.TimeBase.prototype._parsePrimary=function(lexer){var token,expr;if(token=lexer.peek(),this.isUndef(token))throw new SyntaxError("Tone.TimeBase: Unexpected end of expression");if(this._matchGroup(token,this._primaryExpressions)){var matching=(token=lexer.next()).value.match(token.regexp);return token.method.bind(this,matching[1],matching[2],matching[3])}if(token&&"("===token.value){if(lexer.next(),expr=this._parseBinary(lexer),!(token=lexer.next())||")"!==token.value)throw new SyntaxError("Expected )");return expr}throw new SyntaxError("Tone.TimeBase: Cannot process token "+token.value)},Tone.TimeBase.prototype._parseExprString=function(exprString){this.isString(exprString)||(exprString=exprString.toString());var lexer=this._tokenize(exprString),tree;return this._parseBinary(lexer)},Tone.TimeBase.prototype._noOp=function(){return 0},Tone.TimeBase.prototype._defaultExpr=function(){return this._noOp},Tone.TimeBase.prototype._defaultUnits="s",Tone.TimeBase.prototype._frequencyToUnits=function(freq){return 1/freq},Tone.TimeBase.prototype._beatsToUnits=function(beats){return 60/Tone.Transport.bpm.value*beats},Tone.TimeBase.prototype._secondsToUnits=function(seconds){return seconds},Tone.TimeBase.prototype._ticksToUnits=function(ticks){return ticks*(this._beatsToUnits(1)/Tone.Transport.PPQ)},Tone.TimeBase.prototype._timeSignature=function(){return Tone.Transport.timeSignature},Tone.TimeBase.prototype._pushExpr=function(val,name,units){return val instanceof Tone.TimeBase||(val=new this.constructor(val,units)),this._expr=this._binaryExpressions[name].method.bind(this,this._expr,val._expr),this},Tone.TimeBase.prototype.add=function(val,units){return this._pushExpr(val,"+",units)},Tone.TimeBase.prototype.sub=function(val,units){return this._pushExpr(val,"-",units)},Tone.TimeBase.prototype.mult=function(val,units){return this._pushExpr(val,"*",units)},Tone.TimeBase.prototype.div=function(val,units){return this._pushExpr(val,"/",units)},Tone.TimeBase.prototype.valueOf=function(){return this._expr()},Tone.TimeBase.prototype.dispose=function(){this._expr=null},Tone_type_TimeBase=Tone.TimeBase,Tone_type_Time=function(Tone){return Tone.Time=function(val,units){if(!(this instanceof Tone.Time))return new Tone.Time(val,units);this._plusNow=!1,Tone.TimeBase.call(this,val,units)},Tone.extend(Tone.Time,Tone.TimeBase),Tone.Time.prototype._unaryExpressions=Object.create(Tone.TimeBase.prototype._unaryExpressions),Tone.Time.prototype._unaryExpressions.quantize={regexp:/^@/,method:function(rh){return Tone.Transport.nextSubdivision(rh())}},Tone.Time.prototype._unaryExpressions.now={regexp:/^\+/,method:function(lh){return this._plusNow=!0,lh()}},Tone.Time.prototype.quantize=function(subdiv,percent){return percent=this.defaultArg(percent,1),this._expr=function(expr,subdivision,percent){var multiple,ideal,diff;return expr=expr(),subdivision=subdivision.toSeconds(),expr+(Math.round(expr/subdivision)*subdivision-expr)*percent}.bind(this,this._expr,new this.constructor(subdiv),percent),this},Tone.Time.prototype.addNow=function(){return this._plusNow=!0,this},Tone.Time.prototype._defaultExpr=function(){return this._plusNow=!0,this._noOp},Tone.Time.prototype.copy=function(time){return Tone.TimeBase.prototype.copy.call(this,time),this._plusNow=time._plusNow,this},Tone.Time.prototype.toNotation=function(){var time=this.toSeconds(),testNotations=["1m","2n","4n","8n","16n","32n","64n","128n"],retNotation=this._toNotationHelper(time,testNotations),testTripletNotations=["1m","2n","2t","4n","4t","8n","8t","16n","16t","32n","32t","64n","64t","128n"],retTripletNotation=this._toNotationHelper(time,testTripletNotations);return retTripletNotation.split("+").length<retNotation.split("+").length?retTripletNotation:retNotation},Tone.Time.prototype._toNotationHelper=function(units,testNotations){for(var threshold=this._notationToUnits(testNotations[testNotations.length-1]),retNotation="",i=0;i<testNotations.length;i++){var notationTime=this._notationToUnits(testNotations[i]),multiple=units/notationTime,floatingPointError=1e-6;if(1-multiple%1<1e-6&&(multiple+=1e-6),(multiple=Math.floor(multiple))>0){if(retNotation+=1===multiple?testNotations[i]:multiple.toString()+"*"+testNotations[i],(units-=multiple*notationTime)<threshold)break;retNotation+=" + "}}return""===retNotation&&(retNotation="0"),retNotation},Tone.Time.prototype._notationToUnits=function(notation){for(var primaryExprs=this._primaryExpressions,notationExprs=[primaryExprs.n,primaryExprs.t,primaryExprs.m],i=0;i<notationExprs.length;i++){var expr=notationExprs[i],match=notation.match(expr.regexp);if(match)return expr.method.call(this,match[1])}},Tone.Time.prototype.toBarsBeatsSixteenths=function(){var quarterTime=this._beatsToUnits(1),quarters=this.toSeconds()/quarterTime,measures=Math.floor(quarters/this._timeSignature()),sixteenths=quarters%1*4,progress;return quarters=Math.floor(quarters)%this._timeSignature(),(sixteenths=sixteenths.toString()).length>3&&(sixteenths=parseFloat(sixteenths).toFixed(3)),[measures,quarters,sixteenths].join(":")},Tone.Time.prototype.toTicks=function(){var quarterTime=this._beatsToUnits(1),quarters=this.valueOf()/quarterTime;return Math.floor(quarters*Tone.Transport.PPQ)},Tone.Time.prototype.toSamples=function(){return this.toSeconds()*this.context.sampleRate},Tone.Time.prototype.toFrequency=function(){return 1/this.toSeconds()},Tone.Time.prototype.toSeconds=function(){return this.valueOf()},Tone.Time.prototype.toMilliseconds=function(){return 1e3*this.toSeconds()},Tone.Time.prototype.valueOf=function(){var val;return this._expr()+(this._plusNow?this.now():0)},Tone.Time}(Tone_core_Tone),Tone_type_Frequency=function(Tone){Tone.Frequency=function(val,units){if(!(this instanceof Tone.Frequency))return new Tone.Frequency(val,units);Tone.TimeBase.call(this,val,units)},Tone.extend(Tone.Frequency,Tone.TimeBase),Tone.Frequency.prototype._primaryExpressions=Object.create(Tone.TimeBase.prototype._primaryExpressions),Tone.Frequency.prototype._primaryExpressions.midi={regexp:/^(\d+(?:\.\d+)?midi)/,method:function(value){return this.midiToFrequency(value)}},Tone.Frequency.prototype._primaryExpressions.note={regexp:/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i,method:function(pitch,octave){var index,noteNumber=noteToScaleIndex[pitch.toLowerCase()]+12*(parseInt(octave)+1);return this.midiToFrequency(noteNumber)}},Tone.Frequency.prototype._primaryExpressions.tr={regexp:/^(\d+(?:\.\d+)?):(\d+(?:\.\d+)?):?(\d+(?:\.\d+)?)?/,method:function(m,q,s){var total=1;return m&&"0"!==m&&(total*=this._beatsToUnits(this._timeSignature()*parseFloat(m))),q&&"0"!==q&&(total*=this._beatsToUnits(parseFloat(q))),s&&"0"!==s&&(total*=this._beatsToUnits(parseFloat(s)/4)),total}},Tone.Frequency.prototype.transpose=function(interval){return this._expr=function(expr,interval){var val;return expr()*this.intervalToFrequencyRatio(interval)}.bind(this,this._expr,interval),this},Tone.Frequency.prototype.harmonize=function(intervals){return this._expr=function(expr,intervals){for(var val=expr(),ret=[],i=0;i<intervals.length;i++)ret[i]=val*this.intervalToFrequencyRatio(intervals[i]);return ret}.bind(this,this._expr,intervals),this},Tone.Frequency.prototype.toMidi=function(){return this.frequencyToMidi(this.valueOf())},Tone.Frequency.prototype.toNote=function(){var freq=this.valueOf(),log=Math.log(freq/Tone.Frequency.A4)/Math.LN2,noteNumber=Math.round(12*log)+57,octave=Math.floor(noteNumber/12),noteName;return octave<0&&(noteNumber+=-12*octave),scaleIndexToNote[noteNumber%12]+octave.toString()},Tone.Frequency.prototype.toSeconds=function(){return 1/this.valueOf()},Tone.Frequency.prototype.toFrequency=function(){return this.valueOf()},Tone.Frequency.prototype.toTicks=function(){var quarterTime=this._beatsToUnits(1),quarters=this.valueOf()/quarterTime;return Math.floor(quarters*Tone.Transport.PPQ)},Tone.Frequency.prototype._frequencyToUnits=function(freq){return freq},Tone.Frequency.prototype._ticksToUnits=function(ticks){return 1/(60*ticks/(Tone.Transport.bpm.value*Tone.Transport.PPQ))},Tone.Frequency.prototype._beatsToUnits=function(beats){return 1/Tone.TimeBase.prototype._beatsToUnits.call(this,beats)},Tone.Frequency.prototype._secondsToUnits=function(seconds){return 1/seconds},Tone.Frequency.prototype._defaultUnits="hz";var noteToScaleIndex={cbb:-2,cb:-1,c:0,"c#":1,cx:2,dbb:0,db:1,d:2,"d#":3,dx:4,ebb:2,eb:3,e:4,"e#":5,ex:6,fbb:3,fb:4,f:5,"f#":6,fx:7,gbb:5,gb:6,g:7,"g#":8,gx:9,abb:7,ab:8,a:9,"a#":10,ax:11,bbb:9,bb:10,b:11,"b#":12,bx:13},scaleIndexToNote=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];return Tone.Frequency.A4=440,Tone.Frequency.prototype.midiToFrequency=function(midi){return Tone.Frequency.A4*Math.pow(2,(midi-69)/12)},Tone.Frequency.prototype.frequencyToMidi=function(frequency){return 69+12*Math.log(frequency/Tone.Frequency.A4)/Math.LN2},Tone.Frequency}(Tone_core_Tone),Tone_type_TransportTime=function(Tone){return Tone.TransportTime=function(val,units){if(!(this instanceof Tone.TransportTime))return new Tone.TransportTime(val,units);Tone.Time.call(this,val,units)},Tone.extend(Tone.TransportTime,Tone.Time),Tone.TransportTime.prototype._unaryExpressions=Object.create(Tone.Time.prototype._unaryExpressions),Tone.TransportTime.prototype._unaryExpressions.quantize={regexp:/^@/,method:function(rh){var subdivision=this._secondsToTicks(rh()),multiple=Math.ceil(Tone.Transport.ticks/subdivision);return this._ticksToUnits(multiple*subdivision)}},Tone.TransportTime.prototype._secondsToTicks=function(seconds){var quarterTime,quarters=seconds/this._beatsToUnits(1);return Math.round(quarters*Tone.Transport.PPQ)},Tone.TransportTime.prototype.valueOf=function(){var val;return this._secondsToTicks(this._expr())+(this._plusNow?Tone.Transport.ticks:0)},Tone.TransportTime.prototype.toTicks=function(){return this.valueOf()},Tone.TransportTime.prototype.toSeconds=function(){var val;return this._expr()+(this._plusNow?Tone.Transport.seconds:0)},Tone.TransportTime.prototype.toFrequency=function(){return 1/this.toSeconds()},Tone.TransportTime}(Tone_core_Tone),Tone_core_Emitter=function(Tone){"use strict";return Tone.Emitter=function(){this._events={}},Tone.extend(Tone.Emitter),Tone.Emitter.prototype.on=function(event,callback){for(var events=event.split(/\W+/),i=0;i<events.length;i++){var eventName=events[i];this._events.hasOwnProperty(eventName)||(this._events[eventName]=[]),this._events[eventName].push(callback)}return this},Tone.Emitter.prototype.off=function(event,callback){for(var events=event.split(/\W+/),ev=0;ev<events.length;ev++)if(event=events[ev],this._events.hasOwnProperty(event))if(Tone.prototype.isUndef(callback))this._events[event]=[];else for(var eventList=this._events[event],i=0;i<eventList.length;i++)eventList[i]===callback&&eventList.splice(i,1);return this},Tone.Emitter.prototype.emit=function(event){if(this._events){var args=Array.apply(null,arguments).slice(1);if(this._events.hasOwnProperty(event))for(var eventList=this._events[event],i=0,len=eventList.length;i<len;i++)eventList[i].apply(this,args)}return this},Tone.Emitter.mixin=function(object){var functions=["on","off","emit"];object._events={};for(var i=0;i<functions.length;i++){var func=functions[i],emitterFunc=Tone.Emitter.prototype[func];object[func]=emitterFunc}},Tone.Emitter.prototype.dispose=function(){return Tone.prototype.dispose.call(this),this._events=null,this},Tone.Emitter}(Tone_core_Tone),Tone_core_Context=function(Tone){function shimConnect(){var nativeConnect=AudioNode.prototype.connect,nativeDisconnect=AudioNode.prototype.disconnect;function toneConnect(B,outNum,inNum){if(B.input)Array.isArray(B.input)?(Tone.prototype.isUndef(inNum)&&(inNum=0),this.connect(B.input[inNum])):this.connect(B.input,outNum,inNum);else try{B instanceof AudioNode?nativeConnect.call(this,B,outNum,inNum):nativeConnect.call(this,B,outNum)}catch(e){throw new Error("error connecting to node: "+B+"\n"+e)}}function toneDisconnect(B,outNum,inNum){if(B&&B.input&&Array.isArray(B.input))Tone.prototype.isUndef(inNum)&&(inNum=0),this.disconnect(B.input[inNum],outNum,inNum);else if(B&&B.input)this.disconnect(B.input,outNum,inNum);else try{nativeDisconnect.apply(this,arguments)}catch(e){throw new Error("error disconnecting node: "+B+"\n"+e)}}AudioNode.prototype.connect!==toneConnect&&(AudioNode.prototype.connect=toneConnect,AudioNode.prototype.disconnect=toneDisconnect)}return!window.hasOwnProperty("AudioContext")&&window.hasOwnProperty("webkitAudioContext")&&(window.AudioContext=window.webkitAudioContext),Tone.Context=function(context){for(var prop in Tone.Emitter.call(this),context||(context=new window.AudioContext),this._context=context,this._context)this._defineProperty(this._context,prop);this._latencyHint="interactive",this._lookAhead=.1,this._updateInterval=this._lookAhead/3,this._computedUpdateInterval=0,this._worker=this._createWorker(),this._constants={}},Tone.extend(Tone.Context,Tone.Emitter),Tone.Emitter.mixin(Tone.Context),Tone.Context.prototype._defineProperty=function(context,prop){this.isUndef(this[prop])&&Object.defineProperty(this,prop,{get:function(){return"function"==typeof context[prop]?context[prop].bind(context):context[prop]},set:function(val){context[prop]=val}})},Tone.Context.prototype.now=function(){return this._context.currentTime},Tone.Context.prototype._createWorker=function(){window.URL=window.URL||window.webkitURL;var blob=new Blob(["var timeoutTime = "+(1e3*this._updateInterval).toFixed(1)+";self.onmessage = function(msg){\ttimeoutTime = parseInt(msg.data);};function tick(){\tsetTimeout(tick, timeoutTime);\tself.postMessage('tick');}tick();"]),blobUrl=URL.createObjectURL(blob),worker=new Worker(blobUrl);return worker.addEventListener("message",function(){this.emit("tick")}.bind(this)),worker.addEventListener("message",function(){var now=this.now();if(this.isNumber(this._lastUpdate)){var diff=now-this._lastUpdate;this._computedUpdateInterval=Math.max(diff,.97*this._computedUpdateInterval)}this._lastUpdate=now}.bind(this)),worker},Tone.Context.prototype.getConstant=function(val){if(this._constants[val])return this._constants[val];for(var buffer=this._context.createBuffer(1,128,this._context.sampleRate),arr=buffer.getChannelData(0),i=0;i<arr.length;i++)arr[i]=val;var constant=this._context.createBufferSource();return constant.channelCount=1,constant.channelCountMode="explicit",constant.buffer=buffer,constant.loop=!0,constant.start(0),this._constants[val]=constant,constant},Object.defineProperty(Tone.Context.prototype,"lag",{get:function(){var diff=this._computedUpdateInterval-this._updateInterval;return diff=Math.max(diff,0)}}),Object.defineProperty(Tone.Context.prototype,"lookAhead",{get:function(){return this._lookAhead},set:function(lA){this._lookAhead=lA}}),Object.defineProperty(Tone.Context.prototype,"updateInterval",{get:function(){return this._updateInterval},set:function(interval){this._updateInterval=Math.max(interval,Tone.prototype.blockTime),this._worker.postMessage(Math.max(1e3*interval,1))}}),Object.defineProperty(Tone.Context.prototype,"latencyHint",{get:function(){return this._latencyHint},set:function(hint){var lookAhead=hint;if(this._latencyHint=hint,this.isString(hint))switch(hint){case"interactive":lookAhead=.1,this._context.latencyHint=hint;break;case"playback":lookAhead=.8,this._context.latencyHint=hint;break;case"balanced":lookAhead=.25,this._context.latencyHint=hint;break;case"fastest":lookAhead=.01}this.lookAhead=lookAhead,this.updateInterval=lookAhead/3}}),Tone.supported?(shimConnect(),Tone.context=new Tone.Context):console.warn("This browser does not support Tone.js"),Tone.Context}(Tone_core_Tone),Tone_type_Type=function(Tone){return Tone.Type={Default:"number",Time:"time",Frequency:"frequency",TransportTime:"transportTime",Ticks:"ticks",NormalRange:"normalRange",AudioRange:"audioRange",Decibels:"db",Interval:"interval",BPM:"bpm",Positive:"positive",Cents:"cents",Degrees:"degrees",MIDI:"midi",BarsBeatsSixteenths:"barsBeatsSixteenths",Samples:"samples",Hertz:"hertz",Note:"note",Milliseconds:"milliseconds",Seconds:"seconds",Notation:"notation"},Tone.prototype.toSeconds=function(time){return this.isNumber(time)?time:this.isUndef(time)?this.now():this.isString(time)?new Tone.Time(time).toSeconds():time instanceof Tone.TimeBase?time.toSeconds():void 0},Tone.prototype.toFrequency=function(freq){return this.isNumber(freq)?freq:this.isString(freq)||this.isUndef(freq)?new Tone.Frequency(freq).valueOf():freq instanceof Tone.TimeBase?freq.toFrequency():void 0},Tone.prototype.toTicks=function(time){return this.isNumber(time)||this.isString(time)?new Tone.TransportTime(time).toTicks():this.isUndef(time)?Tone.Transport.ticks:time instanceof Tone.TimeBase?time.toTicks():void 0},Tone}(Tone_core_Tone,Tone_type_Time,Tone_type_Frequency,Tone_type_TransportTime),Tone_core_Param=function(Tone){"use strict";return Tone.Param=function(){var options=this.optionsObject(arguments,["param","units","convert"],Tone.Param.defaults);this._param=this.input=options.param,this.units=options.units,this.convert=options.convert,this.overridden=!1,this._lfo=null,this.isObject(options.lfo)?this.value=options.lfo:this.isUndef(options.value)||(this.value=options.value)},Tone.extend(Tone.Param),Tone.Param.defaults={units:Tone.Type.Default,convert:!0,param:void 0},Object.defineProperty(Tone.Param.prototype,"value",{get:function(){return this._toUnits(this._param.value)},set:function(value){if(this.isObject(value)){if(this.isUndef(Tone.LFO))throw new Error("Include 'Tone.LFO' to use an LFO as a Param value.");this._lfo&&this._lfo.dispose(),this._lfo=new Tone.LFO(value).start(),this._lfo.connect(this.input)}else{var convertedVal=this._fromUnits(value);this._param.cancelScheduledValues(0),this._param.value=convertedVal}}}),Tone.Param.prototype._fromUnits=function(val){if(!this.convert&&!this.isUndef(this.convert))return val;switch(this.units){case Tone.Type.Time:return this.toSeconds(val);case Tone.Type.Frequency:return this.toFrequency(val);case Tone.Type.Decibels:return this.dbToGain(val);case Tone.Type.NormalRange:return Math.min(Math.max(val,0),1);case Tone.Type.AudioRange:return Math.min(Math.max(val,-1),1);case Tone.Type.Positive:return Math.max(val,0);default:return val}},Tone.Param.prototype._toUnits=function(val){if(!this.convert&&!this.isUndef(this.convert))return val;switch(this.units){case Tone.Type.Decibels:return this.gainToDb(val);default:return val}},Tone.Param.prototype._minOutput=1e-5,Tone.Param.prototype.setValueAtTime=function(value,time){return value=this._fromUnits(value),(time=this.toSeconds(time))<=this.now()+this.blockTime?this._param.value=value:this._param.setValueAtTime(value,time),this},Tone.Param.prototype.setRampPoint=function(now){now=this.defaultArg(now,this.now());var currentVal=this._param.value;return 0===currentVal&&(currentVal=this._minOutput),this._param.setValueAtTime(currentVal,now),this},Tone.Param.prototype.linearRampToValueAtTime=function(value,endTime){return value=this._fromUnits(value),this._param.linearRampToValueAtTime(value,this.toSeconds(endTime)),this},Tone.Param.prototype.exponentialRampToValueAtTime=function(value,endTime){return value=this._fromUnits(value),value=Math.max(this._minOutput,value),this._param.exponentialRampToValueAtTime(value,this.toSeconds(endTime)),this},Tone.Param.prototype.exponentialRampToValue=function(value,rampTime,startTime){return startTime=this.toSeconds(startTime),this.setRampPoint(startTime),this.exponentialRampToValueAtTime(value,startTime+this.toSeconds(rampTime)),this},Tone.Param.prototype.linearRampToValue=function(value,rampTime,startTime){return startTime=this.toSeconds(startTime),this.setRampPoint(startTime),this.linearRampToValueAtTime(value,startTime+this.toSeconds(rampTime)),this},Tone.Param.prototype.setTargetAtTime=function(value,startTime,timeConstant){return value=this._fromUnits(value),value=Math.max(this._minOutput,value),timeConstant=Math.max(this._minOutput,timeConstant),this._param.setTargetAtTime(value,this.toSeconds(startTime),timeConstant),this},Tone.Param.prototype.setValueCurveAtTime=function(values,startTime,duration){for(var i=0;i<values.length;i++)values[i]=this._fromUnits(values[i]);return this._param.setValueCurveAtTime(values,this.toSeconds(startTime),this.toSeconds(duration)),this},Tone.Param.prototype.cancelScheduledValues=function(startTime){return this._param.cancelScheduledValues(this.toSeconds(startTime)),this},Tone.Param.prototype.rampTo=function(value,rampTime,startTime){return rampTime=this.defaultArg(rampTime,0),this.units===Tone.Type.Frequency||this.units===Tone.Type.BPM||this.units===Tone.Type.Decibels?this.exponentialRampToValue(value,rampTime,startTime):this.linearRampToValue(value,rampTime,startTime),this},Object.defineProperty(Tone.Param.prototype,"lfo",{get:function(){return this._lfo}}),Tone.Param.prototype.dispose=function(){return Tone.prototype.dispose.call(this),this._param=null,this._lfo&&(this._lfo.dispose(),this._lfo=null),this},Tone.Param}(Tone_core_Tone),Tone_core_Gain=function(Tone){"use strict";return window.GainNode&&!AudioContext.prototype.createGain&&(AudioContext.prototype.createGain=AudioContext.prototype.createGainNode),Tone.Gain=function(){var options=this.optionsObject(arguments,["gain","units"],Tone.Gain.defaults);this.input=this.output=this._gainNode=this.context.createGain(),this.gain=new Tone.Param({param:this._gainNode.gain,units:options.units,value:options.gain,convert:options.convert}),this._readOnly("gain")},Tone.extend(Tone.Gain),Tone.Gain.defaults={gain:1,convert:!0},Tone.Gain.prototype.dispose=function(){Tone.Param.prototype.dispose.call(this),this._gainNode.disconnect(),this._gainNode=null,this._writable("gain"),this.gain.dispose(),this.gain=null},Tone.prototype.createInsOuts=function(inputs,outputs){1===inputs?this.input=new Tone.Gain:inputs>1&&(this.input=new Array(inputs)),1===outputs?this.output=new Tone.Gain:outputs>1&&(this.output=new Array(inputs))},Tone.Gain}(Tone_core_Tone,Tone_core_Param),Tone_signal_Signal=function(Tone){"use strict";return Tone.Signal=function(){var options=this.optionsObject(arguments,["value","units"],Tone.Signal.defaults);this.output=this._gain=this.context.createGain(),options.param=this._gain.gain,Tone.Param.call(this,options),this.input=this._param=this._gain.gain,this.context.getConstant(1).chain(this._gain)},Tone.extend(Tone.Signal,Tone.Param),Tone.Signal.defaults={value:0,units:Tone.Type.Default,convert:!0},Tone.Signal.prototype.connect=Tone.SignalBase.prototype.connect,Tone.Signal.prototype.dispose=function(){return Tone.Param.prototype.dispose.call(this),this._param=null,this._gain.disconnect(),this._gain=null,this},Tone.Signal}(Tone_core_Tone,Tone_signal_WaveShaper,Tone_type_Type,Tone_core_Param),Tone_signal_Add=function(Tone){"use strict";return Tone.Add=function(value){this.createInsOuts(2,0),this._sum=this.input[0]=this.input[1]=this.output=new Tone.Gain,this._param=this.input[1]=new Tone.Signal(value),this._param.connect(this._sum)},Tone.extend(Tone.Add,Tone.Signal),Tone.Add.prototype.dispose=function(){return Tone.prototype.dispose.call(this),this._sum.dispose(),this._sum=null,this._param.dispose(),this._param=null,this},Tone.Add}(Tone_core_Tone,Tone_signal_Signal),Tone_signal_Multiply=function(Tone){"use strict";return Tone.Multiply=function(value){this.createInsOuts(2,0),this._mult=this.input[0]=this.output=new Tone.Gain,this._param=this.input[1]=this.output.gain,this._param.value=this.defaultArg(value,0)},Tone.extend(Tone.Multiply,Tone.Signal),Tone.Multiply.prototype.dispose=function(){return Tone.prototype.dispose.call(this),this._mult.dispose(),this._mult=null,this._param=null,this},Tone.Multiply}(Tone_core_Tone,Tone_signal_Signal),Tone_signal_Scale=function(Tone){"use strict";return Tone.Scale=function(outputMin,outputMax){this._outputMin=this.defaultArg(outputMin,0),this._outputMax=this.defaultArg(outputMax,1),this._scale=this.input=new Tone.Multiply(1),this._add=this.output=new Tone.Add(0),this._scale.connect(this._add),this._setRange()},Tone.extend(Tone.Scale,Tone.SignalBase),Object.defineProperty(Tone.Scale.prototype,"min",{get:function(){return this._outputMin},set:function(min){this._outputMin=min,this._setRange()}}),Object.defineProperty(Tone.Scale.prototype,"max",{get:function(){return this._outputMax},set:function(max){this._outputMax=max,this._setRange()}}),Tone.Scale.prototype._setRange=function(){this._add.value=this._outputMin,this._scale.value=this._outputMax-this._outputMin},Tone.Scale.prototype.dispose=function(){return Tone.prototype.dispose.call(this),this._add.dispose(),this._add=null,this._scale.dispose(),this._scale=null,this},Tone.Scale}(Tone_core_Tone,Tone_signal_Add,Tone_signal_Multiply),signal=function(){var Signal=Tone_signal_Signal,Add=Tone_signal_Add,Mult=Tone_signal_Multiply,Scale=Tone_signal_Scale,Tone,p5sound=master;Tone_core_Tone.setContext(p5sound.audiocontext),p5.Signal=function(value){var s;return new Signal(value)},Signal.prototype.fade=Signal.prototype.linearRampToValueAtTime,Mult.prototype.fade=Signal.prototype.fade,Add.prototype.fade=Signal.prototype.fade,Scale.prototype.fade=Signal.prototype.fade,Signal.prototype.setInput=function(_input){_input.connect(this)},Mult.prototype.setInput=Signal.prototype.setInput,Add.prototype.setInput=Signal.prototype.setInput,Scale.prototype.setInput=Signal.prototype.setInput,Signal.prototype.add=function(num){var add=new Add(num);return this.connect(add),add},Mult.prototype.add=Signal.prototype.add,Add.prototype.add=Signal.prototype.add,Scale.prototype.add=Signal.prototype.add,Signal.prototype.mult=function(num){var mult=new Mult(num);return this.connect(mult),mult},Mult.prototype.mult=Signal.prototype.mult,Add.prototype.mult=Signal.prototype.mult,Scale.prototype.mult=Signal.prototype.mult,Signal.prototype.scale=function(inMin,inMax,outMin,outMax){var mapOutMin,mapOutMax;4===arguments.length?(mapOutMin=p5.prototype.map(outMin,inMin,inMax,0,1)-.5,mapOutMax=p5.prototype.map(outMax,inMin,inMax,0,1)-.5):(mapOutMin=arguments[0],mapOutMax=arguments[1]);var scale=new Scale(mapOutMin,mapOutMax);return this.connect(scale),scale},Mult.prototype.scale=Signal.prototype.scale,Add.prototype.scale=Signal.prototype.scale,Scale.prototype.scale=Signal.prototype.scale}(Tone_signal_Signal,Tone_signal_Add,Tone_signal_Multiply,Tone_signal_Scale,Tone_core_Tone,master),oscillator=function(){var p5sound=master,Add=Tone_signal_Add,Mult=Tone_signal_Multiply,Scale=Tone_signal_Scale;p5.Oscillator=function(freq,type){if("string"==typeof freq){var f=type;type=freq,freq=f}if("number"==typeof type){var f=type;type=freq,freq=f}this.started=!1,this.phaseAmount=void 0,this.oscillator=p5sound.audiocontext.createOscillator(),this.f=freq||440,this.oscillator.type=type||"sine",this.oscillator.frequency.setValueAtTime(this.f,p5sound.audiocontext.currentTime),this.output=p5sound.audiocontext.createGain(),this._freqMods=[],this.output.gain.value=.5,this.output.gain.setValueAtTime(.5,p5sound.audiocontext.currentTime),this.oscillator.connect(this.output),this.panPosition=0,this.connection=p5sound.input,this.panner=new p5.Panner(this.output,this.connection,1),this.mathOps=[this.output],p5sound.soundArray.push(this)},p5.Oscillator.prototype.start=function(time,f){if(this.started){var now=p5sound.audiocontext.currentTime;this.stop(now)}if(!this.started){var freq=f||this.f,type=this.oscillator.type;for(var i in this.oscillator&&(this.oscillator.disconnect(),delete this.oscillator),this.oscillator=p5sound.audiocontext.createOscillator(),this.oscillator.frequency.value=Math.abs(freq),this.oscillator.type=type,this.oscillator.connect(this.output),time=time||0,this.oscillator.start(time+p5sound.audiocontext.currentTime),this.freqNode=this.oscillator.frequency,this._freqMods)void 0!==this._freqMods[i].connect&&this._freqMods[i].connect(this.oscillator.frequency);this.started=!0}},p5.Oscillator.prototype.stop=function(time){if(this.started){var t=time||0,now=p5sound.audiocontext.currentTime;this.oscillator.stop(t+now),this.started=!1}},p5.Oscillator.prototype.amp=function(vol,rampTime,tFromNow){var self=this;if("number"==typeof vol){var rampTime=rampTime||0,tFromNow=tFromNow||0,now=p5sound.audiocontext.currentTime;this.output.gain.linearRampToValueAtTime(vol,now+tFromNow+rampTime)}else{if(!vol)return this.output.gain;vol.connect(this.output.gain)}},p5.Oscillator.prototype.fade=p5.Oscillator.prototype.amp,p5.Oscillator.prototype.getAmp=function(){return this.output.gain.value},p5.Oscillator.prototype.freq=function(val,rampTime,tFromNow){if("number"!=typeof val||isNaN(val)){if(!val)return this.oscillator.frequency;val.output&&(val=val.output),val.connect(this.oscillator.frequency),this._freqMods.push(val)}else{this.f=val;var now=p5sound.audiocontext.currentTime,rampTime=rampTime||0,tFromNow,t=now+(tFromNow=tFromNow||0)+rampTime;0===rampTime?this.oscillator.frequency.setValueAtTime(val,tFromNow+now):val>0?this.oscillator.frequency.exponentialRampToValueAtTime(val,tFromNow+rampTime+now):this.oscillator.frequency.linearRampToValueAtTime(val,tFromNow+rampTime+now),this.phaseAmount&&this.phase(this.phaseAmount)}},p5.Oscillator.prototype.getFreq=function(){return this.oscillator.frequency.value},p5.Oscillator.prototype.setType=function(type){this.oscillator.type=type},p5.Oscillator.prototype.getType=function(){return this.oscillator.type},p5.Oscillator.prototype.connect=function(unit){unit?unit.hasOwnProperty("input")?(this.panner.connect(unit.input),this.connection=unit.input):(this.panner.connect(unit),this.connection=unit):this.panner.connect(p5sound.input)},p5.Oscillator.prototype.disconnect=function(){this.output&&this.output.disconnect(),this.panner&&(this.panner.disconnect(),this.output&&this.output.connect(this.panner)),this.oscMods=[]},p5.Oscillator.prototype.pan=function(pval,tFromNow){this.panPosition=pval,this.panner.pan(pval,tFromNow)},p5.Oscillator.prototype.getPan=function(){return this.panPosition},p5.Oscillator.prototype.dispose=function(){var index=p5sound.soundArray.indexOf(this);if(p5sound.soundArray.splice(index,1),this.oscillator){var now=p5sound.audiocontext.currentTime;this.stop(now),this.disconnect(),this.panner=null,this.oscillator=null}this.osc2&&this.osc2.dispose()},p5.Oscillator.prototype.phase=function(p){var delayAmt=p5.prototype.map(p,0,1,0,1/this.f),now=p5sound.audiocontext.currentTime;this.phaseAmount=p,this.dNode||(this.dNode=p5sound.audiocontext.createDelay(),this.oscillator.disconnect(),this.oscillator.connect(this.dNode),this.dNode.connect(this.output)),this.dNode.delayTime.setValueAtTime(delayAmt,now)};var sigChain=function(o,mathObj,thisChain,nextChain,type){var chainSource=o.oscillator;for(var i in o.mathOps)o.mathOps[i]instanceof type&&(chainSource.disconnect(),o.mathOps[i].dispose(),(thisChain=i)<o.mathOps.length-2&&(nextChain=o.mathOps[i+1]));return thisChain===o.mathOps.length-1&&o.mathOps.push(nextChain),i>0&&(chainSource=o.mathOps[i-1]),chainSource.disconnect(),chainSource.connect(mathObj),mathObj.connect(nextChain),o.mathOps[thisChain]=mathObj,o};p5.Oscillator.prototype.add=function(num){var add=new Add(num),thisChain=this.mathOps.length-1,nextChain=this.output;return sigChain(this,add,thisChain,nextChain,Add)},p5.Oscillator.prototype.mult=function(num){var mult=new Mult(num),thisChain=this.mathOps.length-1,nextChain=this.output;return sigChain(this,mult,thisChain,nextChain,Mult)},p5.Oscillator.prototype.scale=function(inMin,inMax,outMin,outMax){var mapOutMin,mapOutMax;4===arguments.length?(mapOutMin=p5.prototype.map(outMin,inMin,inMax,0,1)-.5,mapOutMax=p5.prototype.map(outMax,inMin,inMax,0,1)-.5):(mapOutMin=arguments[0],mapOutMax=arguments[1]);var scale=new Scale(mapOutMin,mapOutMax),thisChain=this.mathOps.length-1,nextChain=this.output;return sigChain(this,scale,thisChain,nextChain,Scale)},p5.SinOsc=function(freq){p5.Oscillator.call(this,freq,"sine")},p5.SinOsc.prototype=Object.create(p5.Oscillator.prototype),p5.TriOsc=function(freq){p5.Oscillator.call(this,freq,"triangle")},p5.TriOsc.prototype=Object.create(p5.Oscillator.prototype),p5.SawOsc=function(freq){p5.Oscillator.call(this,freq,"sawtooth")},p5.SawOsc.prototype=Object.create(p5.Oscillator.prototype),p5.SqrOsc=function(freq){p5.Oscillator.call(this,freq,"square")},p5.SqrOsc.prototype=Object.create(p5.Oscillator.prototype)}(master,Tone_signal_Add,Tone_signal_Multiply,Tone_signal_Scale),Tone_core_Timeline=function(Tone){"use strict";return Tone.Timeline=function(){var options=this.optionsObject(arguments,["memory"],Tone.Timeline.defaults);this._timeline=[],this._toRemove=[],this._iterating=!1,this.memory=options.memory},Tone.extend(Tone.Timeline),Tone.Timeline.defaults={memory:1/0},Object.defineProperty(Tone.Timeline.prototype,"length",{get:function(){return this._timeline.length}}),Tone.Timeline.prototype.add=function(event){if(this.isUndef(event.time))throw new Error("Tone.Timeline: events must have a time attribute");if(this._timeline.length){var index=this._search(event.time);this._timeline.splice(index+1,0,event)}else this._timeline.push(event);if(this.length>this.memory){var diff=this.length-this.memory;this._timeline.splice(0,diff)}return this},Tone.Timeline.prototype.remove=function(event){if(this._iterating)this._toRemove.push(event);else{var index=this._timeline.indexOf(event);-1!==index&&this._timeline.splice(index,1)}return this},Tone.Timeline.prototype.get=function(time){var index=this._search(time);return-1!==index?this._timeline[index]:null},Tone.Timeline.prototype.peek=function(){return this._timeline[0]},Tone.Timeline.prototype.shift=function(){return this._timeline.shift()},Tone.Timeline.prototype.getAfter=function(time){var index=this._search(time);return index+1<this._timeline.length?this._timeline[index+1]:null},Tone.Timeline.prototype.getBefore=function(time){var len=this._timeline.length;if(len>0&&this._timeline[len-1].time<time)return this._timeline[len-1];var index=this._search(time);return index-1>=0?this._timeline[index-1]:null},Tone.Timeline.prototype.cancel=function(after){if(this._timeline.length>1){var index=this._search(after);if(index>=0)if(this._timeline[index].time===after){for(var i=index;i>=0&&this._timeline[i].time===after;i--)index=i;this._timeline=this._timeline.slice(0,index)}else this._timeline=this._timeline.slice(0,index+1);else this._timeline=[]}else 1===this._timeline.length&&this._timeline[0].time>=after&&(this._timeline=[]);return this},Tone.Timeline.prototype.cancelBefore=function(time){if(this._timeline.length){var index=this._search(time);index>=0&&(this._timeline=this._timeline.slice(index+1))}return this},Tone.Timeline.prototype._search=function(time){var beginning=0,len=this._timeline.length,end=len;if(len>0&&this._timeline[len-1].time<=time)return len-1;for(;beginning<end;){var midPoint=Math.floor(beginning+(end-beginning)/2),event=this._timeline[midPoint],nextEvent=this._timeline[midPoint+1];if(event.time===time){for(var i=midPoint;i<this._timeline.length;i++){var testEvent;this._timeline[i].time===time&&(midPoint=i)}return midPoint}if(event.time<time&&nextEvent.time>time)return midPoint;event.time>time?end=midPoint:event.time<time&&(beginning=midPoint+1)}return-1},Tone.Timeline.prototype._iterate=function(callback,lowerBound,upperBound){this._iterating=!0,lowerBound=this.defaultArg(lowerBound,0),upperBound=this.defaultArg(upperBound,this._timeline.length-1);for(var i=lowerBound;i<=upperBound;i++)callback(this._timeline[i]);if(this._iterating=!1,this._toRemove.length>0){for(var j=0;j<this._toRemove.length;j++){var index=this._timeline.indexOf(this._toRemove[j]);-1!==index&&this._timeline.splice(index,1)}this._toRemove=[]}},Tone.Timeline.prototype.forEach=function(callback){return this._iterate(callback),this},Tone.Timeline.prototype.forEachBefore=function(time,callback){var upperBound=this._search(time);return-1!==upperBound&&this._iterate(callback,0,upperBound),this},Tone.Timeline.prototype.forEachAfter=function(time,callback){var lowerBound=this._search(time);return this._iterate(callback,lowerBound+1),this},Tone.Timeline.prototype.forEachFrom=function(time,callback){for(var lowerBound=this._search(time);lowerBound>=0&&this._timeline[lowerBound].time>=time;)lowerBound--;return this._iterate(callback,lowerBound+1),this},Tone.Timeline.prototype.forEachAtTime=function(time,callback){var upperBound=this._search(time);return-1!==upperBound&&this._iterate(function(event){event.time===time&&callback(event)},0,upperBound),this},Tone.Timeline.prototype.dispose=function(){Tone.prototype.dispose.call(this),this._timeline=null,this._toRemove=null},Tone.Timeline}(Tone_core_Tone),Tone_signal_TimelineSignal=function(Tone){"use strict";return Tone.TimelineSignal=function(){var options=this.optionsObject(arguments,["value","units"],Tone.Signal.defaults);this._events=new Tone.Timeline(10),Tone.Signal.apply(this,options),options.param=this._param,Tone.Param.call(this,options),this._initial=this._fromUnits(this._param.value)},Tone.extend(Tone.TimelineSignal,Tone.Param),Tone.TimelineSignal.Type={Linear:"linear",Exponential:"exponential",Target:"target",Curve:"curve",Set:"set"},Object.defineProperty(Tone.TimelineSignal.prototype,"value",{get:function(){var now=this.now(),val=this.getValueAtTime(now);return this._toUnits(val)},set:function(value){var convertedVal=this._fromUnits(value);this._initial=convertedVal,this.cancelScheduledValues(),this._param.value=convertedVal}}),Tone.TimelineSignal.prototype.setValueAtTime=function(value,startTime){return value=this._fromUnits(value),startTime=this.toSeconds(startTime),this._events.add({type:Tone.TimelineSignal.Type.Set,value:value,time:startTime}),this._param.setValueAtTime(value,startTime),this},Tone.TimelineSignal.prototype.linearRampToValueAtTime=function(value,endTime){return value=this._fromUnits(value),endTime=this.toSeconds(endTime),this._events.add({type:Tone.TimelineSignal.Type.Linear,value:value,time:endTime}),this._param.linearRampToValueAtTime(value,endTime),this},Tone.TimelineSignal.prototype.exponentialRampToValueAtTime=function(value,endTime){endTime=this.toSeconds(endTime);var beforeEvent=this._searchBefore(endTime);beforeEvent&&0===beforeEvent.value&&this.setValueAtTime(this._minOutput,beforeEvent.time),value=this._fromUnits(value);var setValue=Math.max(value,this._minOutput);return this._events.add({type:Tone.TimelineSignal.Type.Exponential,value:setValue,time:endTime}),value<this._minOutput?(this._param.exponentialRampToValueAtTime(this._minOutput,endTime-this.sampleTime),this.setValueAtTime(0,endTime)):this._param.exponentialRampToValueAtTime(value,endTime),this},Tone.TimelineSignal.prototype.setTargetAtTime=function(value,startTime,timeConstant){return value=this._fromUnits(value),value=Math.max(this._minOutput,value),timeConstant=Math.max(this._minOutput,timeConstant),startTime=this.toSeconds(startTime),this._events.add({type:Tone.TimelineSignal.Type.Target,value:value,time:startTime,constant:timeConstant}),this._param.setTargetAtTime(value,startTime,timeConstant),this},Tone.TimelineSignal.prototype.setValueCurveAtTime=function(values,startTime,duration,scaling){scaling=this.defaultArg(scaling,1);for(var floats=new Array(values.length),i=0;i<floats.length;i++)floats[i]=this._fromUnits(values[i])*scaling;startTime=this.toSeconds(startTime),duration=this.toSeconds(duration),this._events.add({type:Tone.TimelineSignal.Type.Curve,value:floats,time:startTime,duration:duration}),this._param.setValueAtTime(floats[0],startTime);for(var j=1;j<floats.length;j++){var segmentTime=startTime+j/(floats.length-1)*duration;this._param.linearRampToValueAtTime(floats[j],segmentTime)}return this},Tone.TimelineSignal.prototype.cancelScheduledValues=function(after){return after=this.toSeconds(after),this._events.cancel(after),this._param.cancelScheduledValues(after),this},Tone.TimelineSignal.prototype.setRampPoint=function(time){time=this.toSeconds(time);var val=this._toUnits(this.getValueAtTime(time)),before=this._searchBefore(time);if(before&&before.time===time)this.cancelScheduledValues(time+this.sampleTime);else if(before&&before.type===Tone.TimelineSignal.Type.Curve&&before.time+before.duration>time)this.cancelScheduledValues(time),this.linearRampToValueAtTime(val,time);else{var after=this._searchAfter(time);after&&(this.cancelScheduledValues(time),after.type===Tone.TimelineSignal.Type.Linear?this.linearRampToValueAtTime(val,time):after.type===Tone.TimelineSignal.Type.Exponential&&this.exponentialRampToValueAtTime(val,time)),this.setValueAtTime(val,time)}return this},Tone.TimelineSignal.prototype.linearRampToValueBetween=function(value,start,finish){return this.setRampPoint(start),this.linearRampToValueAtTime(value,finish),this},Tone.TimelineSignal.prototype.exponentialRampToValueBetween=function(value,start,finish){return this.setRampPoint(start),this.exponentialRampToValueAtTime(value,finish),this},Tone.TimelineSignal.prototype._searchBefore=function(time){return this._events.get(time)},Tone.TimelineSignal.prototype._searchAfter=function(time){return this._events.getAfter(time)},Tone.TimelineSignal.prototype.getValueAtTime=function(time){time=this.toSeconds(time);var after=this._searchAfter(time),before=this._searchBefore(time),value=this._initial;if(null===before)value=this._initial;else if(before.type===Tone.TimelineSignal.Type.Target){var previous=this._events.getBefore(before.time),previouVal;previouVal=null===previous?this._initial:previous.value,value=this._exponentialApproach(before.time,previouVal,before.value,before.constant,time)}else value=before.type===Tone.TimelineSignal.Type.Curve?this._curveInterpolate(before.time,before.value,before.duration,time):null===after?before.value:after.type===Tone.TimelineSignal.Type.Linear?this._linearInterpolate(before.time,before.value,after.time,after.value,time):after.type===Tone.TimelineSignal.Type.Exponential?this._exponentialInterpolate(before.time,before.value,after.time,after.value,time):before.value;return value},Tone.TimelineSignal.prototype.connect=Tone.SignalBase.prototype.connect,Tone.TimelineSignal.prototype._exponentialApproach=function(t0,v0,v1,timeConstant,t){return v1+(v0-v1)*Math.exp(-(t-t0)/timeConstant)},Tone.TimelineSignal.prototype._linearInterpolate=function(t0,v0,t1,v1,t){return v0+(t-t0)/(t1-t0)*(v1-v0)},Tone.TimelineSignal.prototype._exponentialInterpolate=function(t0,v0,t1,v1,t){return(v0=Math.max(this._minOutput,v0))*Math.pow(v1/v0,(t-t0)/(t1-t0))},Tone.TimelineSignal.prototype._curveInterpolate=function(start,curve,duration,time){var len=curve.length;if(time>=start+duration)return curve[len-1];if(time<=start)return curve[0];var progress=(time-start)/duration,lowerIndex=Math.floor((len-1)*progress),upperIndex=Math.ceil((len-1)*progress),lowerVal=curve[lowerIndex],upperVal=curve[upperIndex];return upperIndex===lowerIndex?lowerVal:this._linearInterpolate(lowerIndex,lowerVal,upperIndex,upperVal,progress*(len-1))},Tone.TimelineSignal.prototype.dispose=function(){Tone.Signal.prototype.dispose.call(this),Tone.Param.prototype.dispose.call(this),this._events.dispose(),this._events=null},Tone.TimelineSignal}(Tone_core_Tone,Tone_signal_Signal),envelope=function(){var p5sound=master,Add=Tone_signal_Add,Mult=Tone_signal_Multiply,Scale=Tone_signal_Scale,TimelineSignal=Tone_signal_TimelineSignal,Tone;Tone_core_Tone.setContext(p5sound.audiocontext),p5.Envelope=function(t1,l1,t2,l2,t3,l3){this.aTime=t1||.1,this.aLevel=l1||1,this.dTime=t2||.5,this.dLevel=l2||0,this.rTime=t3||0,this.rLevel=l3||0,this._rampHighPercentage=.98,this._rampLowPercentage=.02,this.output=p5sound.audiocontext.createGain(),this.control=new TimelineSignal,this._init(),this.control.connect(this.output),this.connection=null,this.mathOps=[this.control],this.isExponential=!1,this.sourceToClear=null,this.wasTriggered=!1,p5sound.soundArray.push(this)},p5.Envelope.prototype._init=function(){var now,t=p5sound.audiocontext.currentTime;this.control.setTargetAtTime(1e-5,t,.001),this._setRampAD(this.aTime,this.dTime)},p5.Envelope.prototype.set=function(t1,l1,t2,l2,t3,l3){this.aTime=t1,this.aLevel=l1,this.dTime=t2||0,this.dLevel=l2||0,this.rTime=t3||0,this.rLevel=l3||0,this._setRampAD(t1,t2)},p5.Envelope.prototype.setADSR=function(aTime,dTime,sPercent,rTime){this.aTime=aTime,this.dTime=dTime||0,this.sPercent=sPercent||0,this.dLevel=void 0!==sPercent?sPercent*(this.aLevel-this.rLevel)+this.rLevel:0,this.rTime=rTime||0,this._setRampAD(aTime,dTime)},p5.Envelope.prototype.setRange=function(aLevel,rLevel){this.aLevel=aLevel||1,this.rLevel=rLevel||0},p5.Envelope.prototype._setRampAD=function(t1,t2){this._rampAttackTime=this.checkExpInput(t1),this._rampDecayTime=this.checkExpInput(t2);var TCDenominator=1;TCDenominator=Math.log(1/this.checkExpInput(1-this._rampHighPercentage)),this._rampAttackTC=t1/this.checkExpInput(TCDenominator),TCDenominator=Math.log(1/this._rampLowPercentage),this._rampDecayTC=t2/this.checkExpInput(TCDenominator)},p5.Envelope.prototype.setRampPercentages=function(p1,p2){this._rampHighPercentage=this.checkExpInput(p1),this._rampLowPercentage=this.checkExpInput(p2);var TCDenominator=1;TCDenominator=Math.log(1/this.checkExpInput(1-this._rampHighPercentage)),this._rampAttackTC=this._rampAttackTime/this.checkExpInput(TCDenominator),TCDenominator=Math.log(1/this._rampLowPercentage),this._rampDecayTC=this._rampDecayTime/this.checkExpInput(TCDenominator)},p5.Envelope.prototype.setInput=function(){for(var i=0;i<arguments.length;i++)this.connect(arguments[i])},p5.Envelope.prototype.setExp=function(isExp){this.isExponential=isExp},p5.Envelope.prototype.checkExpInput=function(value){return value<=0&&(value=1e-8),value},p5.Envelope.prototype.play=function(unit,secondsFromNow,susTime){var tFromNow=secondsFromNow||0,susTime=susTime||0;unit&&this.connection!==unit&&this.connect(unit),this.triggerAttack(unit,tFromNow),this.triggerRelease(unit,tFromNow+this.aTime+this.dTime+susTime)},p5.Envelope.prototype.triggerAttack=function(unit,secondsFromNow){var now,tFromNow,t=p5sound.audiocontext.currentTime+(secondsFromNow||0);this.lastAttack=t,this.wasTriggered=!0,unit&&this.connection!==unit&&this.connect(unit);var valToSet=this.control.getValueAtTime(t);!0===this.isExponential?this.control.exponentialRampToValueAtTime(this.checkExpInput(valToSet),t):this.control.linearRampToValueAtTime(valToSet,t),t+=this.aTime,!0===this.isExponential?(this.control.exponentialRampToValueAtTime(this.checkExpInput(this.aLevel),t),valToSet=this.checkExpInput(this.control.getValueAtTime(t)),this.control.cancelScheduledValues(t),this.control.exponentialRampToValueAtTime(valToSet,t)):(this.control.linearRampToValueAtTime(this.aLevel,t),valToSet=this.control.getValueAtTime(t),this.control.cancelScheduledValues(t),this.control.linearRampToValueAtTime(valToSet,t)),t+=this.dTime,!0===this.isExponential?(this.control.exponentialRampToValueAtTime(this.checkExpInput(this.dLevel),t),valToSet=this.checkExpInput(this.control.getValueAtTime(t)),this.control.cancelScheduledValues(t),this.control.exponentialRampToValueAtTime(valToSet,t)):(this.control.linearRampToValueAtTime(this.dLevel,t),valToSet=this.control.getValueAtTime(t),this.control.cancelScheduledValues(t),this.control.linearRampToValueAtTime(valToSet,t))},p5.Envelope.prototype.triggerRelease=function(unit,secondsFromNow){if(this.wasTriggered){var now,tFromNow,t=p5sound.audiocontext.currentTime+(secondsFromNow||0);unit&&this.connection!==unit&&this.connect(unit);var valToSet=this.control.getValueAtTime(t);!0===this.isExponential?this.control.exponentialRampToValueAtTime(this.checkExpInput(valToSet),t):this.control.linearRampToValueAtTime(valToSet,t),t+=this.rTime,!0===this.isExponential?(this.control.exponentialRampToValueAtTime(this.checkExpInput(this.rLevel),t),valToSet=this.checkExpInput(this.control.getValueAtTime(t)),this.control.cancelScheduledValues(t),this.control.exponentialRampToValueAtTime(valToSet,t)):(this.control.linearRampToValueAtTime(this.rLevel,t),valToSet=this.control.getValueAtTime(t),this.control.cancelScheduledValues(t),this.control.linearRampToValueAtTime(valToSet,t)),this.wasTriggered=!1}},p5.Envelope.prototype.ramp=function(unit,secondsFromNow,v1,v2){var now,tFromNow,t=p5sound.audiocontext.currentTime+(secondsFromNow||0),destination1=this.checkExpInput(v1),destination2=void 0!==v2?this.checkExpInput(v2):void 0;unit&&this.connection!==unit&&this.connect(unit);var currentVal=this.checkExpInput(this.control.getValueAtTime(t));destination1>currentVal?(this.control.setTargetAtTime(destination1,t,this._rampAttackTC),t+=this._rampAttackTime):destination1<currentVal&&(this.control.setTargetAtTime(destination1,t,this._rampDecayTC),t+=this._rampDecayTime),void 0!==destination2&&(destination2>destination1?this.control.setTargetAtTime(destination2,t,this._rampAttackTC):destination2<destination1&&this.control.setTargetAtTime(destination2,t,this._rampDecayTC))},p5.Envelope.prototype.connect=function(unit){this.connection=unit,(unit instanceof p5.Oscillator||unit instanceof p5.SoundFile||unit instanceof p5.AudioIn||unit instanceof p5.Reverb||unit instanceof p5.Noise||unit instanceof p5.Filter||unit instanceof p5.Delay)&&(unit=unit.output.gain),unit instanceof AudioParam&&unit.setValueAtTime(0,p5sound.audiocontext.currentTime),unit instanceof p5.Signal&&unit.setValue(0),this.output.connect(unit)},p5.Envelope.prototype.disconnect=function(){this.output&&this.output.disconnect()},p5.Envelope.prototype.add=function(num){var add=new Add(num),thisChain=this.mathOps.length,nextChain=this.output;return p5.prototype._mathChain(this,add,thisChain,nextChain,Add)},p5.Envelope.prototype.mult=function(num){var mult=new Mult(num),thisChain=this.mathOps.length,nextChain=this.output;return p5.prototype._mathChain(this,mult,thisChain,nextChain,Mult)},p5.Envelope.prototype.scale=function(inMin,inMax,outMin,outMax){var scale=new Scale(inMin,inMax,outMin,outMax),thisChain=this.mathOps.length,nextChain=this.output;return p5.prototype._mathChain(this,scale,thisChain,nextChain,Scale)},p5.Envelope.prototype.dispose=function(){var index=p5sound.soundArray.indexOf(this);p5sound.soundArray.splice(index,1),this.disconnect(),this.control&&(this.control.dispose(),this.control=null);for(var i=1;i<this.mathOps.length;i++)this.mathOps[i].dispose()},p5.Env=function(t1,l1,t2,l2,t3,l3){console.warn("WARNING: p5.Env is now deprecated and may be removed in future versions. Please use the new p5.Envelope instead."),p5.Envelope.call(this,t1,l1,t2,l2,t3,l3)},p5.Env.prototype=Object.create(p5.Envelope.prototype)}(master,Tone_signal_Add,Tone_signal_Multiply,Tone_signal_Scale,Tone_signal_TimelineSignal,Tone_core_Tone),pulse=function(){var p5sound=master;function createDCOffset(){for(var ac=p5sound.audiocontext,buffer=ac.createBuffer(1,2048,ac.sampleRate),data=buffer.getChannelData(0),i=0;i<2048;i++)data[i]=1;var bufferSource=ac.createBufferSource();return bufferSource.buffer=buffer,bufferSource.loop=!0,bufferSource}p5.Pulse=function(freq,w){p5.Oscillator.call(this,freq,"sawtooth"),this.w=w||0,this.osc2=new p5.SawOsc(freq),this.dNode=p5sound.audiocontext.createDelay(),this.dcOffset=createDCOffset(),this.dcGain=p5sound.audiocontext.createGain(),this.dcOffset.connect(this.dcGain),this.dcGain.connect(this.output),this.f=freq||440;var mW=this.w/this.oscillator.frequency.value;this.dNode.delayTime.value=mW,this.dcGain.gain.value=1.7*(.5-this.w),this.osc2.disconnect(),this.osc2.panner.disconnect(),this.osc2.amp(-1),this.osc2.output.connect(this.dNode),this.dNode.connect(this.output),this.output.gain.value=1,this.output.connect(this.panner)},p5.Pulse.prototype=Object.create(p5.Oscillator.prototype),p5.Pulse.prototype.width=function(w){if("number"==typeof w){if(w<=1&&w>=0){this.w=w;var mW=this.w/this.oscillator.frequency.value;this.dNode.delayTime.value=mW}this.dcGain.gain.value=1.7*(.5-this.w)}else{w.connect(this.dNode.delayTime);var sig=new p5.SignalAdd(-.5);sig.setInput(w),(sig=(sig=sig.mult(-1)).mult(1.7)).connect(this.dcGain.gain)}},p5.Pulse.prototype.start=function(f,time){var now=p5sound.audiocontext.currentTime,t=time||0;if(!this.started){var freq=f||this.f,type=this.oscillator.type;this.oscillator=p5sound.audiocontext.createOscillator(),this.oscillator.frequency.setValueAtTime(freq,now),this.oscillator.type=type,this.oscillator.connect(this.output),this.oscillator.start(t+now),this.osc2.oscillator=p5sound.audiocontext.createOscillator(),this.osc2.oscillator.frequency.setValueAtTime(freq,t+now),this.osc2.oscillator.type=type,this.osc2.oscillator.connect(this.osc2.output),this.osc2.start(t+now),this.freqNode=[this.oscillator.frequency,this.osc2.oscillator.frequency],this.dcOffset=createDCOffset(),this.dcOffset.connect(this.dcGain),this.dcOffset.start(t+now),void 0!==this.mods&&void 0!==this.mods.frequency&&(this.mods.frequency.connect(this.freqNode[0]),this.mods.frequency.connect(this.freqNode[1])),this.started=!0,this.osc2.started=!0}},p5.Pulse.prototype.stop=function(time){if(this.started){var t=time||0,now=p5sound.audiocontext.currentTime;this.oscillator.stop(t+now),this.osc2.oscillator&&this.osc2.oscillator.stop(t+now),this.dcOffset.stop(t+now),this.started=!1,this.osc2.started=!1}},p5.Pulse.prototype.freq=function(val,rampTime,tFromNow){if("number"==typeof val){this.f=val;var now=p5sound.audiocontext.currentTime,rampTime=rampTime||0,tFromNow=tFromNow||0,currentFreq=this.oscillator.frequency.value;this.oscillator.frequency.cancelScheduledValues(now),this.oscillator.frequency.setValueAtTime(currentFreq,now+tFromNow),this.oscillator.frequency.exponentialRampToValueAtTime(val,tFromNow+rampTime+now),this.osc2.oscillator.frequency.cancelScheduledValues(now),this.osc2.oscillator.frequency.setValueAtTime(currentFreq,now+tFromNow),this.osc2.oscillator.frequency.exponentialRampToValueAtTime(val,tFromNow+rampTime+now),this.freqMod&&(this.freqMod.output.disconnect(),this.freqMod=null)}else val.output&&(val.output.disconnect(),val.output.connect(this.oscillator.frequency),val.output.connect(this.osc2.oscillator.frequency),this.freqMod=val)}}(master,oscillator),noise=function(){var p5sound=master;p5.Noise=function(type){var assignType;p5.Oscillator.call(this),delete this.f,delete this.freq,delete this.oscillator,assignType="brown"===type?_brownNoise:"pink"===type?_pinkNoise:_whiteNoise,this.buffer=assignType},p5.Noise.prototype=Object.create(p5.Oscillator.prototype);var _whiteNoise=function(){for(var bufferSize=2*p5sound.audiocontext.sampleRate,whiteBuffer=p5sound.audiocontext.createBuffer(1,bufferSize,p5sound.audiocontext.sampleRate),noiseData=whiteBuffer.getChannelData(0),i=0;i<bufferSize;i++)noiseData[i]=2*Math.random()-1;return whiteBuffer.type="white",whiteBuffer}(),_pinkNoise=function(){var bufferSize=2*p5sound.audiocontext.sampleRate,pinkBuffer=p5sound.audiocontext.createBuffer(1,bufferSize,p5sound.audiocontext.sampleRate),noiseData=pinkBuffer.getChannelData(0),b0,b1,b2,b3,b4,b5,b6;b0=b1=b2=b3=b4=b5=b6=0;for(var i=0;i<bufferSize;i++){var white=2*Math.random()-1;b0=.99886*b0+.0555179*white,b1=.99332*b1+.0750759*white,b2=.969*b2+.153852*white,b3=.8665*b3+.3104856*white,b4=.55*b4+.5329522*white,b5=-.7616*b5-.016898*white,noiseData[i]=b0+b1+b2+b3+b4+b5+b6+.5362*white,noiseData[i]*=.11,b6=.115926*white}return pinkBuffer.type="pink",pinkBuffer}(),_brownNoise=function(){for(var bufferSize=2*p5sound.audiocontext.sampleRate,brownBuffer=p5sound.audiocontext.createBuffer(1,bufferSize,p5sound.audiocontext.sampleRate),noiseData=brownBuffer.getChannelData(0),lastOut=0,i=0;i<bufferSize;i++){var white=2*Math.random()-1;noiseData[i]=(lastOut+.02*white)/1.02,lastOut=noiseData[i],noiseData[i]*=3.5}return brownBuffer.type="brown",brownBuffer}();p5.Noise.prototype.setType=function(type){switch(type){case"white":this.buffer=_whiteNoise;break;case"pink":this.buffer=_pinkNoise;break;case"brown":this.buffer=_brownNoise;break;default:this.buffer=_whiteNoise}if(this.started){var now=p5sound.audiocontext.currentTime;this.stop(now),this.start(now+.01)}},p5.Noise.prototype.getType=function(){return this.buffer.type},p5.Noise.prototype.start=function(){this.started&&this.stop(),this.noise=p5sound.audiocontext.createBufferSource(),this.noise.buffer=this.buffer,this.noise.loop=!0,this.noise.connect(this.output);var now=p5sound.audiocontext.currentTime;this.noise.start(now),this.started=!0},p5.Noise.prototype.stop=function(){var now=p5sound.audiocontext.currentTime;this.noise&&(this.noise.stop(now),this.started=!1)},p5.Noise.prototype.dispose=function(){var now=p5sound.audiocontext.currentTime,index=p5sound.soundArray.indexOf(this);p5sound.soundArray.splice(index,1),this.noise&&(this.noise.disconnect(),this.stop(now)),this.output&&this.output.disconnect(),this.panner&&this.panner.disconnect(),this.output=null,this.panner=null,this.buffer=null,this.noise=null}}(master),audioin=function(){var p5sound=master;p5sound.inputSources=[],p5.AudioIn=function(errorCallback){this.input=p5sound.audiocontext.createGain(),this.output=p5sound.audiocontext.createGain(),this.stream=null,this.mediaStream=null,this.currentSource=null,this.enabled=!1,this.amplitude=new p5.Amplitude,this.output.connect(this.amplitude.input),window.MediaStreamTrack&&window.navigator.mediaDevices&&window.navigator.mediaDevices.getUserMedia||(errorCallback?errorCallback():window.alert("This browser does not support MediaStreamTrack and mediaDevices")),p5sound.soundArray.push(this)},p5.AudioIn.prototype.start=function(successCallback,errorCallback){var self=this;this.stream&&this.stop();var audioSource=p5sound.inputSources[self.currentSource],constraints={audio:{sampleRate:p5sound.audiocontext.sampleRate,echoCancellation:!1}};p5sound.inputSources[this.currentSource]&&(constraints.audio.deviceId=audioSource.deviceId),window.navigator.mediaDevices.getUserMedia(constraints).then(function(stream){self.stream=stream,self.enabled=!0,self.mediaStream=p5sound.audiocontext.createMediaStreamSource(stream),self.mediaStream.connect(self.output),self.amplitude.setInput(self.output),successCallback&&successCallback()}).catch(function(err){errorCallback?errorCallback(err):console.error(err)})},p5.AudioIn.prototype.stop=function(){this.stream&&(this.stream.getTracks().forEach(function(track){track.stop()}),this.mediaStream.disconnect(),delete this.mediaStream,delete this.stream)},p5.AudioIn.prototype.connect=function(unit){unit?unit.hasOwnProperty("input")?this.output.connect(unit.input):unit.hasOwnProperty("analyser")?this.output.connect(unit.analyser):this.output.connect(unit):this.output.connect(p5sound.input)},p5.AudioIn.prototype.disconnect=function(){this.output&&(this.output.disconnect(),this.output.connect(this.amplitude.input))},p5.AudioIn.prototype.getLevel=function(smoothing){return smoothing&&(this.amplitude.smoothing=smoothing),this.amplitude.getLevel()},p5.AudioIn.prototype.amp=function(vol,t){if(t){var rampTime=t||0,currentVol=this.output.gain.value;this.output.gain.cancelScheduledValues(p5sound.audiocontext.currentTime),this.output.gain.setValueAtTime(currentVol,p5sound.audiocontext.currentTime),this.output.gain.linearRampToValueAtTime(vol,rampTime+p5sound.audiocontext.currentTime)}else this.output.gain.cancelScheduledValues(p5sound.audiocontext.currentTime),this.output.gain.setValueAtTime(vol,p5sound.audiocontext.currentTime)},p5.AudioIn.prototype.getSources=function(onSuccess,onError){return new Promise(function(resolve,reject){window.navigator.mediaDevices.enumerateDevices().then(function(devices){p5sound.inputSources=devices.filter(function(device){return"audioinput"===device.kind}),resolve(p5sound.inputSources),onSuccess&&onSuccess(p5sound.inputSources)}).catch(function(error){reject(error),onError?onError(error):console.error("This browser does not support MediaStreamTrack.getSources()")})})},p5.AudioIn.prototype.setSource=function(num){p5sound.inputSources.length>0&&num<p5sound.inputSources.length?(this.currentSource=num,console.log("set source to ",p5sound.inputSources[this.currentSource])):console.log("unable to set input source"),this.stream&&this.stream.active&&this.start()},p5.AudioIn.prototype.dispose=function(){var index=p5sound.soundArray.indexOf(this);p5sound.soundArray.splice(index,1),this.stop(),this.output&&this.output.disconnect(),this.amplitude&&this.amplitude.disconnect(),delete this.amplitude,delete this.output}}(master),Tone_signal_Negate=function(Tone){"use strict";return Tone.Negate=function(){this._multiply=this.input=this.output=new Tone.Multiply(-1)},Tone.extend(Tone.Negate,Tone.SignalBase),Tone.Negate.prototype.dispose=function(){return Tone.prototype.dispose.call(this),this._multiply.dispose(),this._multiply=null,this},Tone.Negate}(Tone_core_Tone,Tone_signal_Multiply),Tone_signal_Subtract=function(Tone){"use strict";return Tone.Subtract=function(value){this.createInsOuts(2,0),this._sum=this.input[0]=this.output=new Tone.Gain,this._neg=new Tone.Negate,this._param=this.input[1]=new Tone.Signal(value),this._param.chain(this._neg,this._sum)},Tone.extend(Tone.Subtract,Tone.Signal),Tone.Subtract.prototype.dispose=function(){return Tone.prototype.dispose.call(this),this._neg.dispose(),this._neg=null,this._sum.disconnect(),this._sum=null,this._param.dispose(),this._param=null,this},Tone.Subtract}(Tone_core_Tone,Tone_signal_Add,Tone_signal_Negate,Tone_signal_Signal),Tone_signal_GreaterThanZero=function(Tone){"use strict";return Tone.GreaterThanZero=function(){this._thresh=this.output=new Tone.WaveShaper(function(val){return val<=0?0:1},127),this._scale=this.input=new Tone.Multiply(1e4),this._scale.connect(this._thresh)},Tone.extend(Tone.GreaterThanZero,Tone.SignalBase),Tone.GreaterThanZero.prototype.dispose=function(){return Tone.prototype.dispose.call(this),this._scale.dispose(),this._scale=null,this._thresh.dispose(),this._thresh=null,this},Tone.GreaterThanZero}(Tone_core_Tone,Tone_signal_Signal,Tone_signal_Multiply),Tone_signal_GreaterThan=function(Tone){"use strict";return Tone.GreaterThan=function(value){this.createInsOuts(2,0),this._param=this.input[0]=new Tone.Subtract(value),this.input[1]=this._param.input[1],this._gtz=this.output=new Tone.GreaterThanZero,this._param.connect(this._gtz)},Tone.extend(Tone.GreaterThan,Tone.Signal),Tone.GreaterThan.prototype.dispose=function(){return Tone.prototype.dispose.call(this),this._param.dispose(),this._param=null,this._gtz.dispose(),this._gtz=null,this},Tone.GreaterThan}(Tone_core_Tone,Tone_signal_GreaterThanZero,Tone_signal_Subtract),Tone_signal_Abs=function(Tone){"use strict";return Tone.Abs=function(){this._abs=this.input=this.output=new Tone.WaveShaper(function(val){return 0===val?0:Math.abs(val)},127)},Tone.extend(Tone.Abs,Tone.SignalBase),Tone.Abs.prototype.dispose=function(){return Tone.prototype.dispose.call(this),this._abs.dispose(),this._abs=null,this},Tone.Abs}(Tone_core_Tone,Tone_signal_WaveShaper),Tone_signal_Modulo=function(Tone){"use strict";return Tone.Modulo=function(modulus){this.createInsOuts(1,0),this._shaper=new Tone.WaveShaper(Math.pow(2,16)),this._multiply=new Tone.Multiply,this._subtract=this.output=new Tone.Subtract,this._modSignal=new Tone.Signal(modulus),this.input.fan(this._shaper,this._subtract),this._modSignal.connect(this._multiply,0,0),this._shaper.connect(this._multiply,0,1),this._multiply.connect(this._subtract,0,1),this._setWaveShaper(modulus)},Tone.extend(Tone.Modulo,Tone.SignalBase),Tone.Modulo.prototype._setWaveShaper=function(mod){this._shaper.setMap(function(val){var multiple;return Math.floor((val+1e-4)/mod)})},Object.defineProperty(Tone.Modulo.prototype,"value",{get:function(){return this._modSignal.value},set:function(mod){this._modSignal.value=mod,this._setWaveShaper(mod)}}),Tone.Modulo.prototype.dispose=function(){return Tone.prototype.dispose.call(this),this._shaper.dispose(),this._shaper=null,this._multiply.dispose(),this._multiply=null,this._subtract.dispose(),this._subtract=null,this._modSignal.dispose(),this._modSignal=null,this},Tone.Modulo}(Tone_core_Tone,Tone_signal_WaveShaper,Tone_signal_Multiply),Tone_signal_Pow=function(Tone){"use strict";return Tone.Pow=function(exp){this._exp=this.defaultArg(exp,1),this._expScaler=this.input=this.output=new Tone.WaveShaper(this._expFunc(this._exp),8192)},Tone.extend(Tone.Pow,Tone.SignalBase),Object.defineProperty(Tone.Pow.prototype,"value",{get:function(){return this._exp},set:function(exp){this._exp=exp,this._expScaler.setMap(this._expFunc(this._exp))}}),Tone.Pow.prototype._expFunc=function(exp){return function(val){return Math.pow(Math.abs(val),exp)}},Tone.Pow.prototype.dispose=function(){return Tone.prototype.dispose.call(this),this._expScaler.dispose(),this._expScaler=null,this},Tone.Pow}(Tone_core_Tone),Tone_signal_AudioToGain=function(Tone){"use strict";return Tone.AudioToGain=function(){this._norm=this.input=this.output=new Tone.WaveShaper(function(x){return(x+1)/2})},Tone.extend(Tone.AudioToGain,Tone.SignalBase),Tone.AudioToGain.prototype.dispose=function(){return Tone.prototype.dispose.call(this),this._norm.dispose(),this._norm=null,this},Tone.AudioToGain}(Tone_core_Tone,Tone_signal_WaveShaper),Tone_signal_Expr=function(Tone){"use strict";function applyBinary(Constructor,args,self){var op=new Constructor;return self._eval(args[0]).connect(op,0,0),self._eval(args[1]).connect(op,0,1),op}function applyUnary(Constructor,args,self){var op=new Constructor;return self._eval(args[0]).connect(op,0,0),op}function getNumber(arg){return arg?parseFloat(arg):void 0}function literalNumber(arg){return arg&&arg.args?parseFloat(arg.args):void 0}return Tone.Expr=function(){var expr=this._replacements(Array.prototype.slice.call(arguments)),inputCount=this._parseInputs(expr);this._nodes=[],this.input=new Array(inputCount);for(var i=0;i<inputCount;i++)this.input[i]=this.context.createGain();var tree=this._parseTree(expr),result;try{result=this._eval(tree)}catch(e){throw this._disposeNodes(),new Error("Tone.Expr: Could evaluate expression: "+expr)}this.output=result},Tone.extend(Tone.Expr,Tone.SignalBase),Tone.Expr._Expressions={value:{signal:{regexp:/^\d+\.\d+|^\d+/,method:function(arg){var sig;return new Tone.Signal(getNumber(arg))}},input:{regexp:/^\$\d/,method:function(arg,self){return self.input[getNumber(arg.substr(1))]}}},glue:{"(":{regexp:/^\(/},")":{regexp:/^\)/},",":{regexp:/^,/}},func:{abs:{regexp:/^abs/,method:applyUnary.bind(this,Tone.Abs)},mod:{regexp:/^mod/,method:function(args,self){var modulus=literalNumber(args[1]),op=new Tone.Modulo(modulus);return self._eval(args[0]).connect(op),op}},pow:{regexp:/^pow/,method:function(args,self){var exp=literalNumber(args[1]),op=new Tone.Pow(exp);return self._eval(args[0]).connect(op),op}},a2g:{regexp:/^a2g/,method:function(args,self){var op=new Tone.AudioToGain;return self._eval(args[0]).connect(op),op}}},binary:{"+":{regexp:/^\+/,precedence:1,method:applyBinary.bind(this,Tone.Add)},"-":{regexp:/^\-/,precedence:1,method:function(args,self){return 1===args.length?applyUnary(Tone.Negate,args,self):applyBinary(Tone.Subtract,args,self)}},"*":{regexp:/^\*/,precedence:0,method:applyBinary.bind(this,Tone.Multiply)}},unary:{"-":{regexp:/^\-/,method:applyUnary.bind(this,Tone.Negate)},"!":{regexp:/^\!/,method:applyUnary.bind(this,Tone.NOT)}}},Tone.Expr.prototype._parseInputs=function(expr){var inputArray=expr.match(/\$\d/g),inputMax=0;if(null!==inputArray)for(var i=0;i<inputArray.length;i++){var inputNum=parseInt(inputArray[i].substr(1))+1;inputMax=Math.max(inputMax,inputNum)}return inputMax},Tone.Expr.prototype._replacements=function(args){for(var expr=args.shift(),i=0;i<args.length;i++)expr=expr.replace(/\%/i,args[i]);return expr},Tone.Expr.prototype._tokenize=function(expr){for(var position=-1,tokens=[];expr.length>0;){var token=getNextToken(expr=expr.trim());tokens.push(token),expr=expr.substr(token.value.length)}function getNextToken(expr){for(var type in Tone.Expr._Expressions){var group=Tone.Expr._Expressions[type];for(var opName in group){var op=group[opName],reg=op.regexp,match=expr.match(reg);if(null!==match)return{type:type,value:match[0],method:op.method}}}throw new SyntaxError("Tone.Expr: Unexpected token "+expr)}return{next:function(){return tokens[++position]},peek:function(){return tokens[position+1]}}},Tone.Expr.prototype._parseTree=function(expr){var lexer=this._tokenize(expr),isUndef=this.isUndef.bind(this);function matchSyntax(token,syn){return!isUndef(token)&&"glue"===token.type&&token.value===syn}function matchGroup(token,groupName,prec){var ret=!1,group=Tone.Expr._Expressions[groupName];if(!isUndef(token))for(var opName in group){var op=group[opName];if(op.regexp.test(token.value)){if(isUndef(prec))return!0;if(op.precedence===prec)return!0}}return!1}function parseExpression(precedence){var expr;isUndef(precedence)&&(precedence=5),expr=precedence<0?parseUnary():parseExpression(precedence-1);for(var token=lexer.peek();matchGroup(token,"binary",precedence);)expr={operator:(token=lexer.next()).value,method:token.method,args:[expr,parseExpression(precedence-1)]},token=lexer.peek();return expr}function parseUnary(){var token,expr;return matchGroup(token=lexer.peek(),"unary")?(token=lexer.next(),expr=parseUnary(),{operator:token.value,method:token.method,args:[expr]}):parsePrimary()}function parsePrimary(){var token,expr;if(token=lexer.peek(),isUndef(token))throw new SyntaxError("Tone.Expr: Unexpected termination of expression");if("func"===token.type)return parseFunctionCall(token=lexer.next());if("value"===token.type)return{method:(token=lexer.next()).method,args:token.value};if(matchSyntax(token,"(")){if(lexer.next(),expr=parseExpression(),!matchSyntax(token=lexer.next(),")"))throw new SyntaxError("Expected )");return expr}throw new SyntaxError("Tone.Expr: Parse error, cannot process token "+token.value)}function parseFunctionCall(func){var token,args=[];if(!matchSyntax(token=lexer.next(),"("))throw new SyntaxError('Tone.Expr: Expected ( in a function call "'+func.value+'"');if(matchSyntax(token=lexer.peek(),")")||(args=parseArgumentList()),!matchSyntax(token=lexer.next(),")"))throw new SyntaxError('Tone.Expr: Expected ) in a function call "'+func.value+'"');return{method:func.method,args:args,name:name}}function parseArgumentList(){for(var token,expr,args=[];expr=parseExpression(),!isUndef(expr)&&(args.push(expr),matchSyntax(token=lexer.peek(),","));)lexer.next();return args}return parseExpression()},Tone.Expr.prototype._eval=function(tree){if(!this.isUndef(tree)){var node=tree.method(tree.args,this);return this._nodes.push(node),node}},Tone.Expr.prototype._disposeNodes=function(){for(var i=0;i<this._nodes.length;i++){var node=this._nodes[i];this.isFunction(node.dispose)?node.dispose():this.isFunction(node.disconnect)&&node.disconnect(),node=null,this._nodes[i]=null}this._nodes=null},Tone.Expr.prototype.dispose=function(){Tone.prototype.dispose.call(this),this._disposeNodes()},Tone.Expr}(Tone_core_Tone,Tone_signal_Add,Tone_signal_Subtract,Tone_signal_Multiply,Tone_signal_GreaterThan,Tone_signal_GreaterThanZero,Tone_signal_Abs,Tone_signal_Negate,Tone_signal_Modulo,Tone_signal_Pow),Tone_signal_EqualPowerGain=function(Tone){"use strict";return Tone.EqualPowerGain=function(){this._eqPower=this.input=this.output=new Tone.WaveShaper(function(val){return Math.abs(val)<.001?0:this.equalPowerScale(val)}.bind(this),4096)},Tone.extend(Tone.EqualPowerGain,Tone.SignalBase),Tone.EqualPowerGain.prototype.dispose=function(){return Tone.prototype.dispose.call(this),this._eqPower.dispose(),this._eqPower=null,this},Tone.EqualPowerGain}(Tone_core_Tone),Tone_component_CrossFade=function(Tone){"use strict";return Tone.CrossFade=function(initialFade){this.createInsOuts(2,1),this.a=this.input[0]=new Tone.Gain,this.b=this.input[1]=new Tone.Gain,this.fade=new Tone.Signal(this.defaultArg(initialFade,.5),Tone.Type.NormalRange),this._equalPowerA=new Tone.EqualPowerGain,this._equalPowerB=new Tone.EqualPowerGain,this._invert=new Tone.Expr("1 - $0"),this.a.connect(this.output),this.b.connect(this.output),this.fade.chain(this._equalPowerB,this.b.gain),this.fade.chain(this._invert,this._equalPowerA,this.a.gain),this._readOnly("fade")},Tone.extend(Tone.CrossFade),Tone.CrossFade.prototype.dispose=function(){return Tone.prototype.dispose.call(this),this._writable("fade"),this._equalPowerA.dispose(),this._equalPowerA=null,this._equalPowerB.dispose(),this._equalPowerB=null,this.fade.dispose(),this.fade=null,this._invert.dispose(),this._invert=null,this.a.dispose(),this.a=null,this.b.dispose(),this.b=null,this},Tone.CrossFade}(Tone_core_Tone,Tone_signal_Signal,Tone_signal_Expr,Tone_signal_EqualPowerGain),effect=function(){var p5sound=master,CrossFade=Tone_component_CrossFade;return p5.Effect=function(){this.ac=p5sound.audiocontext,this.input=this.ac.createGain(),this.output=this.ac.createGain(),this._drywet=new CrossFade(1),this.wet=this.ac.createGain(),this.input.connect(this._drywet.a),this.wet.connect(this._drywet.b),this._drywet.connect(this.output),this.connect(),p5sound.soundArray.push(this)},p5.Effect.prototype.amp=function(vol,rampTime,tFromNow){var rampTime=rampTime||0,tFromNow=tFromNow||0,now=p5sound.audiocontext.currentTime,currentVol=this.output.gain.value;this.output.gain.cancelScheduledValues(now),this.output.gain.linearRampToValueAtTime(currentVol,now+tFromNow+.001),this.output.gain.linearRampToValueAtTime(vol,now+tFromNow+rampTime+.001)},p5.Effect.prototype.chain=function(){if(arguments.length>0){this.connect(arguments[0]);for(var i=1;i<arguments.length;i+=1)arguments[i-1].connect(arguments[i])}return this},p5.Effect.prototype.drywet=function(fade){return void 0!==fade&&(this._drywet.fade.value=fade),this._drywet.fade.value},p5.Effect.prototype.connect=function(unit){var u=unit||p5.soundOut.input;this.output.connect(u.input?u.input:u)},p5.Effect.prototype.disconnect=function(){this.output&&this.output.disconnect()},p5.Effect.prototype.dispose=function(){var index=p5sound.soundArray.indexOf(this);p5sound.soundArray.splice(index,1),this.input&&(this.input.disconnect(),delete this.input),this.output&&(this.output.disconnect(),delete this.output),this._drywet&&(this._drywet.disconnect(),delete this._drywet),this.wet&&(this.wet.disconnect(),delete this.wet),this.ac=void 0},p5.Effect}(master,Tone_component_CrossFade),filter=function(){var p5sound=master,Effect=effect;return p5.Filter=function(type){Effect.call(this),this.biquad=this.ac.createBiquadFilter(),this.input.connect(this.biquad),this.biquad.connect(this.wet),type&&this.setType(type),this._on=!0,this._untoggledType=this.biquad.type},p5.Filter.prototype=Object.create(Effect.prototype),p5.Filter.prototype.process=function(src,freq,res,time){src.connect(this.input),this.set(freq,res,time)},p5.Filter.prototype.set=function(freq,res,time){freq&&this.freq(freq,time),res&&this.res(res,time)},p5.Filter.prototype.freq=function(freq,time){var t=time||0;return freq<=0&&(freq=1),"number"==typeof freq?(this.biquad.frequency.value=freq,this.biquad.frequency.cancelScheduledValues(this.ac.currentTime+.01+t),this.biquad.frequency.exponentialRampToValueAtTime(freq,this.ac.currentTime+.02+t)):freq&&freq.connect(this.biquad.frequency),this.biquad.frequency.value},p5.Filter.prototype.res=function(res,time){var t=time||0;return"number"==typeof res?(this.biquad.Q.value=res,this.biquad.Q.cancelScheduledValues(this.ac.currentTime+.01+t),this.biquad.Q.linearRampToValueAtTime(res,this.ac.currentTime+.02+t)):res&&res.connect(this.biquad.Q),this.biquad.Q.value},p5.Filter.prototype.gain=function(gain,time){var t=time||0;return"number"==typeof gain?(this.biquad.gain.value=gain,this.biquad.gain.cancelScheduledValues(this.ac.currentTime+.01+t),this.biquad.gain.linearRampToValueAtTime(gain,this.ac.currentTime+.02+t)):gain&&gain.connect(this.biquad.gain),this.biquad.gain.value},p5.Filter.prototype.toggle=function(){return this._on=!this._on,!0===this._on?this.biquad.type=this._untoggledType:!1===this._on&&(this.biquad.type="allpass"),this._on},p5.Filter.prototype.setType=function(t){this.biquad.type=t,this._untoggledType=this.biquad.type},p5.Filter.prototype.dispose=function(){Effect.prototype.dispose.apply(this),this.biquad&&(this.biquad.disconnect(),delete this.biquad)},p5.LowPass=function(){p5.Filter.call(this,"lowpass")},p5.LowPass.prototype=Object.create(p5.Filter.prototype),p5.HighPass=function(){p5.Filter.call(this,"highpass")},p5.HighPass.prototype=Object.create(p5.Filter.prototype),p5.BandPass=function(){p5.Filter.call(this,"bandpass")},p5.BandPass.prototype=Object.create(p5.Filter.prototype),p5.Filter}(master,effect),src_eqFilter=function(){var Filter=filter,p5sound=master,EQFilter=function(freq,res){Filter.call(this,"peaking"),this.disconnect(),this.set(freq,res),this.biquad.gain.value=0,delete this.input,delete this.output,delete this._drywet,delete this.wet};return(EQFilter.prototype=Object.create(Filter.prototype)).amp=function(){console.warn("`amp()` is not available for p5.EQ bands. Use `.gain()`")},EQFilter.prototype.drywet=function(){console.warn("`drywet()` is not available for p5.EQ bands.")},EQFilter.prototype.connect=function(unit){var u=unit||p5.soundOut.input;this.biquad?this.biquad.connect(u.input?u.input:u):this.output.connect(u.input?u.input:u)},EQFilter.prototype.disconnect=function(){this.biquad&&this.biquad.disconnect()},EQFilter.prototype.dispose=function(){var index=p5sound.soundArray.indexOf(this);p5sound.soundArray.splice(index,1),this.disconnect(),delete this.biquad},EQFilter}(filter,master),Effect=effect,EQFilter=src_eqFilter,p5.EQ=function(_eqsize){var factor,freq,res;Effect.call(this),factor=3===(_eqsize=3===_eqsize||8===_eqsize?_eqsize:3)?Math.pow(2,3):2,this.bands=[];for(var i=0;i<_eqsize;i++)i===_eqsize-1?(freq=21e3,res=.01):0===i?(freq=100,res=.1):1===i?(freq=3===_eqsize?360*factor:360,res=1):(freq=this.bands[i-1].freq()*factor,res=1),this.bands[i]=this._newBand(freq,res),i>0?this.bands[i-1].connect(this.bands[i].biquad):this.input.connect(this.bands[i].biquad);this.bands[_eqsize-1].connect(this.output)},p5.EQ.prototype=Object.create(Effect.prototype),p5.EQ.prototype.process=function(src){src.connect(this.input)},p5.EQ.prototype.set=function(){if(arguments.length===2*this.bands.length)for(var i=0;i<arguments.length;i+=2)this.bands[i/2].freq(arguments[i]),this.bands[i/2].gain(arguments[i+1]);else console.error("Argument mismatch. .set() should be called with "+2*this.bands.length+" arguments. (one frequency and gain value pair for each band of the eq)")},p5.EQ.prototype._newBand=function(freq,res){return new EQFilter(freq,res)},p5.EQ.prototype.dispose=function(){if(Effect.prototype.dispose.apply(this),this.bands){for(;this.bands.length>0;)this.bands.pop().dispose();delete this.bands}},eq=p5.EQ,panner3d=function(){var p5sound=master,Effect=effect;return p5.Panner3D=function(){Effect.call(this),this.panner=this.ac.createPanner(),this.panner.panningModel="HRTF",this.panner.distanceModel="linear",this.panner.connect(this.output),this.input.connect(this.panner)},p5.Panner3D.prototype=Object.create(Effect.prototype),p5.Panner3D.prototype.process=function(src){src.connect(this.input)},p5.Panner3D.prototype.set=function(xVal,yVal,zVal,time){return this.positionX(xVal,time),this.positionY(yVal,time),this.positionZ(zVal,time),[this.panner.positionX.value,this.panner.positionY.value,this.panner.positionZ.value]},p5.Panner3D.prototype.positionX=function(xVal,time){var t=time||0;return"number"==typeof xVal?(this.panner.positionX.value=xVal,this.panner.positionX.cancelScheduledValues(this.ac.currentTime+.01+t),this.panner.positionX.linearRampToValueAtTime(xVal,this.ac.currentTime+.02+t)):xVal&&xVal.connect(this.panner.positionX),this.panner.positionX.value},p5.Panner3D.prototype.positionY=function(yVal,time){var t=time||0;return"number"==typeof yVal?(this.panner.positionY.value=yVal,this.panner.positionY.cancelScheduledValues(this.ac.currentTime+.01+t),this.panner.positionY.linearRampToValueAtTime(yVal,this.ac.currentTime+.02+t)):yVal&&yVal.connect(this.panner.positionY),this.panner.positionY.value},p5.Panner3D.prototype.positionZ=function(zVal,time){var t=time||0;return"number"==typeof zVal?(this.panner.positionZ.value=zVal,this.panner.positionZ.cancelScheduledValues(this.ac.currentTime+.01+t),this.panner.positionZ.linearRampToValueAtTime(zVal,this.ac.currentTime+.02+t)):zVal&&zVal.connect(this.panner.positionZ),this.panner.positionZ.value},p5.Panner3D.prototype.orient=function(xVal,yVal,zVal,time){return this.orientX(xVal,time),this.orientY(yVal,time),this.orientZ(zVal,time),[this.panner.orientationX.value,this.panner.orientationY.value,this.panner.orientationZ.value]},p5.Panner3D.prototype.orientX=function(xVal,time){var t=time||0;return"number"==typeof xVal?(this.panner.orientationX.value=xVal,this.panner.orientationX.cancelScheduledValues(this.ac.currentTime+.01+t),this.panner.orientationX.linearRampToValueAtTime(xVal,this.ac.currentTime+.02+t)):xVal&&xVal.connect(this.panner.orientationX),this.panner.orientationX.value},p5.Panner3D.prototype.orientY=function(yVal,time){var t=time||0;return"number"==typeof yVal?(this.panner.orientationY.value=yVal,this.panner.orientationY.cancelScheduledValues(this.ac.currentTime+.01+t),this.panner.orientationY.linearRampToValueAtTime(yVal,this.ac.currentTime+.02+t)):yVal&&yVal.connect(this.panner.orientationY),this.panner.orientationY.value},p5.Panner3D.prototype.orientZ=function(zVal,time){var t=time||0;return"number"==typeof zVal?(this.panner.orientationZ.value=zVal,this.panner.orientationZ.cancelScheduledValues(this.ac.currentTime+.01+t),this.panner.orientationZ.linearRampToValueAtTime(zVal,this.ac.currentTime+.02+t)):zVal&&zVal.connect(this.panner.orientationZ),this.panner.orientationZ.value},p5.Panner3D.prototype.setFalloff=function(maxDistance,rolloffFactor){this.maxDist(maxDistance),this.rolloff(rolloffFactor)},p5.Panner3D.prototype.maxDist=function(maxDistance){return"number"==typeof maxDistance&&(this.panner.maxDistance=maxDistance),this.panner.maxDistance},p5.Panner3D.prototype.rolloff=function(rolloffFactor){return"number"==typeof rolloffFactor&&(this.panner.rolloffFactor=rolloffFactor),this.panner.rolloffFactor},p5.Panner3D.dispose=function(){Effect.prototype.dispose.apply(this),this.panner&&(this.panner.disconnect(),delete this.panner)},p5.Panner3D}(master,effect),listener3d=function(){var p5sound=master,Effect=effect;return p5.Listener3D=function(type){this.ac=p5sound.audiocontext,this.listener=this.ac.listener},p5.Listener3D.prototype.process=function(src){src.connect(this.input)},p5.Listener3D.prototype.position=function(xVal,yVal,zVal,time){return this.positionX(xVal,time),this.positionY(yVal,time),this.positionZ(zVal,time),[this.listener.positionX.value,this.listener.positionY.value,this.listener.positionZ.value]},p5.Listener3D.prototype.positionX=function(xVal,time){var t=time||0;return"number"==typeof xVal?(this.listener.positionX.value=xVal,this.listener.positionX.cancelScheduledValues(this.ac.currentTime+.01+t),this.listener.positionX.linearRampToValueAtTime(xVal,this.ac.currentTime+.02+t)):xVal&&xVal.connect(this.listener.positionX),this.listener.positionX.value},p5.Listener3D.prototype.positionY=function(yVal,time){var t=time||0;return"number"==typeof yVal?(this.listener.positionY.value=yVal,this.listener.positionY.cancelScheduledValues(this.ac.currentTime+.01+t),this.listener.positionY.linearRampToValueAtTime(yVal,this.ac.currentTime+.02+t)):yVal&&yVal.connect(this.listener.positionY),this.listener.positionY.value},p5.Listener3D.prototype.positionZ=function(zVal,time){var t=time||0;return"number"==typeof zVal?(this.listener.positionZ.value=zVal,this.listener.positionZ.cancelScheduledValues(this.ac.currentTime+.01+t),this.listener.positionZ.linearRampToValueAtTime(zVal,this.ac.currentTime+.02+t)):zVal&&zVal.connect(this.listener.positionZ),this.listener.positionZ.value},p5.Listener3D.prototype.orient=function(xValF,yValF,zValF,xValU,yValU,zValU,time){return 3===arguments.length||4===arguments.length?(time=arguments[3],this.orientForward(xValF,yValF,zValF,time)):6!==arguments.length&&7!==arguments||(this.orientForward(xValF,yValF,zValF),this.orientUp(xValU,yValU,zValU,time)),[this.listener.forwardX.value,this.listener.forwardY.value,this.listener.forwardZ.value,this.listener.upX.value,this.listener.upY.value,this.listener.upZ.value]},p5.Listener3D.prototype.orientForward=function(xValF,yValF,zValF,time){return this.forwardX(xValF,time),this.forwardY(yValF,time),this.forwardZ(zValF,time),[this.listener.forwardX,this.listener.forwardY,this.listener.forwardZ]},p5.Listener3D.prototype.orientUp=function(xValU,yValU,zValU,time){return this.upX(xValU,time),this.upY(yValU,time),this.upZ(zValU,time),[this.listener.upX,this.listener.upY,this.listener.upZ]},p5.Listener3D.prototype.forwardX=function(xVal,time){var t=time||0;return"number"==typeof xVal?(this.listener.forwardX.value=xVal,this.listener.forwardX.cancelScheduledValues(this.ac.currentTime+.01+t),this.listener.forwardX.linearRampToValueAtTime(xVal,this.ac.currentTime+.02+t)):xVal&&xVal.connect(this.listener.forwardX),this.listener.forwardX.value},p5.Listener3D.prototype.forwardY=function(yVal,time){var t=time||0;return"number"==typeof yVal?(this.listener.forwardY.value=yVal,this.listener.forwardY.cancelScheduledValues(this.ac.currentTime+.01+t),this.listener.forwardY.linearRampToValueAtTime(yVal,this.ac.currentTime+.02+t)):yVal&&yVal.connect(this.listener.forwardY),this.listener.forwardY.value},p5.Listener3D.prototype.forwardZ=function(zVal,time){var t=time||0;return"number"==typeof zVal?(this.listener.forwardZ.value=zVal,this.listener.forwardZ.cancelScheduledValues(this.ac.currentTime+.01+t),this.listener.forwardZ.linearRampToValueAtTime(zVal,this.ac.currentTime+.02+t)):zVal&&zVal.connect(this.listener.forwardZ),this.listener.forwardZ.value},p5.Listener3D.prototype.upX=function(xVal,time){var t=time||0;return"number"==typeof xVal?(this.listener.upX.value=xVal,this.listener.upX.cancelScheduledValues(this.ac.currentTime+.01+t),this.listener.upX.linearRampToValueAtTime(xVal,this.ac.currentTime+.02+t)):xVal&&xVal.connect(this.listener.upX),this.listener.upX.value},p5.Listener3D.prototype.upY=function(yVal,time){var t=time||0;return"number"==typeof yVal?(this.listener.upY.value=yVal,this.listener.upY.cancelScheduledValues(this.ac.currentTime+.01+t),this.listener.upY.linearRampToValueAtTime(yVal,this.ac.currentTime+.02+t)):yVal&&yVal.connect(this.listener.upY),this.listener.upY.value},p5.Listener3D.prototype.upZ=function(zVal,time){var t=time||0;return"number"==typeof zVal?(this.listener.upZ.value=zVal,this.listener.upZ.cancelScheduledValues(this.ac.currentTime+.01+t),this.listener.upZ.linearRampToValueAtTime(zVal,this.ac.currentTime+.02+t)):zVal&&zVal.connect(this.listener.upZ),this.listener.upZ.value},p5.Listener3D}(master,effect),delay=function(){var Filter=filter,Effect=effect;p5.Delay=function(){Effect.call(this),this._split=this.ac.createChannelSplitter(2),this._merge=this.ac.createChannelMerger(2),this._leftGain=this.ac.createGain(),this._rightGain=this.ac.createGain(),this.leftDelay=this.ac.createDelay(),this.rightDelay=this.ac.createDelay(),this._leftFilter=new Filter,this._rightFilter=new Filter,this._leftFilter.disconnect(),this._rightFilter.disconnect(),this._leftFilter.biquad.frequency.setValueAtTime(1200,this.ac.currentTime),this._rightFilter.biquad.frequency.setValueAtTime(1200,this.ac.currentTime),this._leftFilter.biquad.Q.setValueAtTime(.3,this.ac.currentTime),this._rightFilter.biquad.Q.setValueAtTime(.3,this.ac.currentTime),this.input.connect(this._split),this.leftDelay.connect(this._leftGain),this.rightDelay.connect(this._rightGain),this._leftGain.connect(this._leftFilter.input),this._rightGain.connect(this._rightFilter.input),this._merge.connect(this.wet),this._leftFilter.biquad.gain.setValueAtTime(1,this.ac.currentTime),this._rightFilter.biquad.gain.setValueAtTime(1,this.ac.currentTime),this.setType(0),this._maxDelay=this.leftDelay.delayTime.maxValue,this.feedback(.5)},p5.Delay.prototype=Object.create(Effect.prototype),p5.Delay.prototype.process=function(src,_delayTime,_feedback,_filter){var feedback=_feedback||0,delayTime=_delayTime||0;if(feedback>=1)throw new Error("Feedback value will force a positive feedback loop.");if(delayTime>=this._maxDelay)throw new Error("Delay Time exceeds maximum delay time of "+this._maxDelay+" second.");src.connect(this.input),this.leftDelay.delayTime.setValueAtTime(delayTime,this.ac.currentTime),this.rightDelay.delayTime.setValueAtTime(delayTime,this.ac.currentTime),this._leftGain.gain.value=feedback,this._rightGain.gain.value=feedback,_filter&&(this._leftFilter.freq(_filter),this._rightFilter.freq(_filter))},p5.Delay.prototype.delayTime=function(t){"number"!=typeof t?(t.connect(this.leftDelay.delayTime),t.connect(this.rightDelay.delayTime)):(this.leftDelay.delayTime.cancelScheduledValues(this.ac.currentTime),this.rightDelay.delayTime.cancelScheduledValues(this.ac.currentTime),this.leftDelay.delayTime.linearRampToValueAtTime(t,this.ac.currentTime),this.rightDelay.delayTime.linearRampToValueAtTime(t,this.ac.currentTime))},p5.Delay.prototype.feedback=function(f){if(f&&"number"!=typeof f)f.connect(this._leftGain.gain),f.connect(this._rightGain.gain);else{if(f>=1)throw new Error("Feedback value will force a positive feedback loop.");"number"==typeof f&&(this._leftGain.gain.value=f,this._rightGain.gain.value=f)}return this._leftGain.gain.value},p5.Delay.prototype.filter=function(freq,q){this._leftFilter.set(freq,q),this._rightFilter.set(freq,q)},p5.Delay.prototype.setType=function(t){switch(1===t&&(t="pingPong"),this._split.disconnect(),this._leftFilter.disconnect(),this._rightFilter.disconnect(),this._split.connect(this.leftDelay,0),this._split.connect(this.rightDelay,1),t){case"pingPong":this._rightFilter.setType(this._leftFilter.biquad.type),this._leftFilter.output.connect(this._merge,0,0),this._rightFilter.output.connect(this._merge,0,1),this._leftFilter.output.connect(this.rightDelay),this._rightFilter.output.connect(this.leftDelay);break;default:this._leftFilter.output.connect(this._merge,0,0),this._rightFilter.output.connect(this._merge,0,1),this._leftFilter.output.connect(this.leftDelay),this._rightFilter.output.connect(this.rightDelay)}},p5.Delay.prototype.dispose=function(){Effect.prototype.dispose.apply(this),this._split.disconnect(),this._leftFilter.dispose(),this._rightFilter.dispose(),this._merge.disconnect(),this._leftGain.disconnect(),this._rightGain.disconnect(),this.leftDelay.disconnect(),this.rightDelay.disconnect(),this._split=void 0,this._leftFilter=void 0,this._rightFilter=void 0,this._merge=void 0,this._leftGain=void 0,this._rightGain=void 0,this.leftDelay=void 0,this.rightDelay=void 0}}(filter,effect),reverb=function(){var CustomError=errorHandler,Effect=effect;p5.Reverb=function(){Effect.call(this),this._initConvolverNode(),this.input.gain.value=.5,this._seconds=3,this._decay=2,this._reverse=!1,this._buildImpulse()},p5.Reverb.prototype=Object.create(Effect.prototype),p5.Reverb.prototype._initConvolverNode=function(){this.convolverNode=this.ac.createConvolver(),this.input.connect(this.convolverNode),this.convolverNode.connect(this.wet)},p5.Reverb.prototype._teardownConvolverNode=function(){this.convolverNode&&(this.convolverNode.disconnect(),delete this.convolverNode)},p5.Reverb.prototype._setBuffer=function(audioBuffer){this._teardownConvolverNode(),this._initConvolverNode(),this.convolverNode.buffer=audioBuffer},p5.Reverb.prototype.process=function(src,seconds,decayRate,reverse){src.connect(this.input);var rebuild=!1;seconds&&(this._seconds=seconds,rebuild=!0),decayRate&&(this._decay=decayRate),reverse&&(this._reverse=reverse),rebuild&&this._buildImpulse()},p5.Reverb.prototype.set=function(seconds,decayRate,reverse){var rebuild=!1;seconds&&(this._seconds=seconds,rebuild=!0),decayRate&&(this._decay=decayRate),reverse&&(this._reverse=reverse),rebuild&&this._buildImpulse()},p5.Reverb.prototype._buildImpulse=function(){var rate=this.ac.sampleRate,length=rate*this._seconds,decay=this._decay,impulse=this.ac.createBuffer(2,length,rate),impulseL=impulse.getChannelData(0),impulseR=impulse.getChannelData(1),n,i;for(i=0;i<length;i++)n=this._reverse?length-i:i,impulseL[i]=(2*Math.random()-1)*Math.pow(1-n/length,decay),impulseR[i]=(2*Math.random()-1)*Math.pow(1-n/length,decay);this._setBuffer(impulse)},p5.Reverb.prototype.dispose=function(){Effect.prototype.dispose.apply(this),this._teardownConvolverNode()},p5.Convolver=function(path,callback,errorCallback){p5.Reverb.call(this),this._initConvolverNode(),this.input.gain.value=.5,path?(this.impulses=[],this._loadBuffer(path,callback,errorCallback)):(this._seconds=3,this._decay=2,this._reverse=!1,this._buildImpulse())},p5.Convolver.prototype=Object.create(p5.Reverb.prototype),p5.prototype.registerPreloadMethod("createConvolver",p5.prototype),p5.prototype.createConvolver=function(path,callback,errorCallback){window.location.origin.indexOf("file://")>-1&&"undefined"===window.cordova&&alert("This sketch may require a server to load external files. Please see http://bit.ly/1qcInwS");var self=this,cReverb=new p5.Convolver(path,function(buffer){"function"==typeof callback&&callback(buffer),"function"==typeof self._decrementPreload&&self._decrementPreload()},errorCallback);return cReverb.impulses=[],cReverb},p5.Convolver.prototype._loadBuffer=function(path,callback,errorCallback){var path=p5.prototype._checkFileFormats(path),self=this,errorTrace=(new Error).stack,ac=p5.prototype.getAudioContext(),request=new XMLHttpRequest;request.open("GET",path,!0),request.responseType="arraybuffer",request.onload=function(){if(200===request.status)ac.decodeAudioData(request.response,function(buff){var buffer={},chunks=path.split("/");buffer.name=chunks[chunks.length-1],buffer.audioBuffer=buff,self.impulses.push(buffer),self._setBuffer(buffer.audioBuffer),callback&&callback(buffer)},function(){var err=new CustomError("decodeAudioData",errorTrace,self.url),msg="AudioContext error at decodeAudioData for "+self.url;errorCallback?(err.msg=msg,errorCallback(err)):console.error(msg+"\n The error stack trace includes: \n"+err.stack)});else{var err=new CustomError("loadConvolver",errorTrace,self.url),msg="Unable to load "+self.url+". The request status was: "+request.status+" ("+request.statusText+")";errorCallback?(err.message=msg,errorCallback(err)):console.error(msg+"\n The error stack trace includes: \n"+err.stack)}},request.onerror=function(){var err=new CustomError("loadConvolver",errorTrace,self.url),msg="There was no response from the server at "+self.url+". Check the url and internet connectivity.";errorCallback?(err.message=msg,errorCallback(err)):console.error(msg+"\n The error stack trace includes: \n"+err.stack)},request.send()},p5.Convolver.prototype.set=null,p5.Convolver.prototype.process=function(src){src.connect(this.input)},p5.Convolver.prototype.impulses=[],p5.Convolver.prototype.addImpulse=function(path,callback,errorCallback){window.location.origin.indexOf("file://")>-1&&"undefined"===window.cordova&&alert("This sketch may require a server to load external files. Please see http://bit.ly/1qcInwS"),this._loadBuffer(path,callback,errorCallback)},p5.Convolver.prototype.resetImpulse=function(path,callback,errorCallback){window.location.origin.indexOf("file://")>-1&&"undefined"===window.cordova&&alert("This sketch may require a server to load external files. Please see http://bit.ly/1qcInwS"),this.impulses=[],this._loadBuffer(path,callback,errorCallback)},p5.Convolver.prototype.toggleImpulse=function(id){if("number"==typeof id&&id<this.impulses.length&&this._setBuffer(this.impulses[id].audioBuffer),"string"==typeof id)for(var i=0;i<this.impulses.length;i++)if(this.impulses[i].name===id){this._setBuffer(this.impulses[i].audioBuffer);break}},p5.Convolver.prototype.dispose=function(){for(var i in p5.Reverb.prototype.dispose.apply(this),this.impulses)this.impulses[i]&&(this.impulses[i]=null)}}(errorHandler,effect),Tone_core_TimelineState=function(Tone){"use strict";return Tone.TimelineState=function(initial){Tone.Timeline.call(this),this._initial=initial},Tone.extend(Tone.TimelineState,Tone.Timeline),Tone.TimelineState.prototype.getValueAtTime=function(time){var event=this.get(time);return null!==event?event.state:this._initial},Tone.TimelineState.prototype.setStateAtTime=function(state,time){this.add({state:state,time:time})},Tone.TimelineState}(Tone_core_Tone,Tone_core_Timeline),Tone_core_Clock=function(Tone){"use strict";return Tone.Clock=function(){Tone.Emitter.call(this);var options=this.optionsObject(arguments,["callback","frequency"],Tone.Clock.defaults);this.callback=options.callback,this._nextTick=0,this._lastState=Tone.State.Stopped,this.frequency=new Tone.TimelineSignal(options.frequency,Tone.Type.Frequency),this._readOnly("frequency"),this.ticks=0,this._state=new Tone.TimelineState(Tone.State.Stopped),this._boundLoop=this._loop.bind(this),this.context.on("tick",this._boundLoop)},Tone.extend(Tone.Clock,Tone.Emitter),Tone.Clock.defaults={callback:Tone.noOp,frequency:1,lookAhead:"auto"},Object.defineProperty(Tone.Clock.prototype,"state",{get:function(){return this._state.getValueAtTime(this.now())}}),Tone.Clock.prototype.start=function(time,offset){return time=this.toSeconds(time),this._state.getValueAtTime(time)!==Tone.State.Started&&this._state.add({state:Tone.State.Started,time:time,offset:offset}),this},Tone.Clock.prototype.stop=function(time){return time=this.toSeconds(time),this._state.cancel(time),this._state.setStateAtTime(Tone.State.Stopped,time),this},Tone.Clock.prototype.pause=function(time){return time=this.toSeconds(time),this._state.getValueAtTime(time)===Tone.State.Started&&this._state.setStateAtTime(Tone.State.Paused,time),this},Tone.Clock.prototype._loop=function(){for(var now,lookAhead,updateInterval,lagCompensation,loopInterval=this.now()+this.context.lookAhead+this.context.updateInterval+2*this.context.lag;loopInterval>this._nextTick&&this._state;){var currentState=this._state.getValueAtTime(this._nextTick);if(currentState!==this._lastState){this._lastState=currentState;var event=this._state.get(this._nextTick);currentState===Tone.State.Started?(this._nextTick=event.time,this.isUndef(event.offset)||(this.ticks=event.offset),this.emit("start",event.time,this.ticks)):currentState===Tone.State.Stopped?(this.ticks=0,this.emit("stop",event.time)):currentState===Tone.State.Paused&&this.emit("pause",event.time)}var tickTime=this._nextTick;this.frequency&&(this._nextTick+=1/this.frequency.getValueAtTime(this._nextTick),currentState===Tone.State.Started&&(this.callback(tickTime),this.ticks++))}},Tone.Clock.prototype.getStateAtTime=function(time){return time=this.toSeconds(time),this._state.getValueAtTime(time)},Tone.Clock.prototype.dispose=function(){Tone.Emitter.prototype.dispose.call(this),this.context.off("tick",this._boundLoop),this._writable("frequency"),this.frequency.dispose(),this.frequency=null,this._boundLoop=null,this._nextTick=1/0,this.callback=null,this._state.dispose(),this._state=null},Tone.Clock}(Tone_core_Tone,Tone_signal_TimelineSignal,Tone_core_TimelineState,Tone_core_Emitter),metro=function(){var p5sound=master,Clock=Tone_core_Clock;p5.Metro=function(){this.clock=new Clock({callback:this.ontick.bind(this)}),this.syncedParts=[],this.bpm=120,this._init(),this.prevTick=0,this.tatumTime=0,this.tickCallback=function(){}},p5.Metro.prototype.ontick=function(tickTime){var elapsedTime=tickTime-this.prevTick,secondsFromNow=tickTime-p5sound.audiocontext.currentTime;if(!(elapsedTime-this.tatumTime<=-.02)){this.prevTick=tickTime;var self=this;this.syncedParts.forEach(function(thisPart){thisPart.isPlaying&&(thisPart.incrementStep(secondsFromNow),thisPart.phrases.forEach(function(thisPhrase){var phraseArray=thisPhrase.sequence,bNum=self.metroTicks%phraseArray.length;0!==phraseArray[bNum]&&(self.metroTicks<phraseArray.length||!thisPhrase.looping)&&thisPhrase.callback(secondsFromNow,phraseArray[bNum])}))}),this.metroTicks+=1,this.tickCallback(secondsFromNow)}},p5.Metro.prototype.setBPM=function(bpm,rampTime){var beatTime=60/(bpm*this.tatums),now=p5sound.audiocontext.currentTime;this.tatumTime=beatTime;var rampTime=rampTime||0;this.clock.frequency.setValueAtTime(this.clock.frequency.value,now),this.clock.frequency.linearRampToValueAtTime(bpm,now+rampTime),this.bpm=bpm},p5.Metro.prototype.getBPM=function(){return this.clock.getRate()/this.tatums*60},p5.Metro.prototype._init=function(){this.metroTicks=0},p5.Metro.prototype.resetSync=function(part){this.syncedParts=[part]},p5.Metro.prototype.pushSync=function(part){this.syncedParts.push(part)},p5.Metro.prototype.start=function(timeFromNow){var t=timeFromNow||0,now=p5sound.audiocontext.currentTime;this.clock.start(now+t),this.setBPM(this.bpm)},p5.Metro.prototype.stop=function(timeFromNow){var t=timeFromNow||0,now=p5sound.audiocontext.currentTime;this.clock.stop(now+t)},p5.Metro.prototype.beatLength=function(tatums){this.tatums=1/tatums/4}}(master,Tone_core_Clock),looper=function(){var p5sound=master,BPM=120;function playNextPart(aScore){aScore.currentPart++,aScore.currentPart>=aScore.parts.length?(aScore.scoreStep=0,aScore.onended()):(aScore.scoreStep=0,aScore.parts[aScore.currentPart-1].stop(),aScore.parts[aScore.currentPart].start())}p5.prototype.setBPM=function(bpm,rampTime){for(var i in BPM=bpm,p5sound.parts)p5sound.parts[i]&&p5sound.parts[i].setBPM(bpm,rampTime)},p5.Phrase=function(name,callback,sequence){this.phraseStep=0,this.name=name,this.callback=callback,this.sequence=sequence},p5.Part=function(steps,bLength){this.length=steps||0,this.partStep=0,this.phrases=[],this.isPlaying=!1,this.noLoop(),this.tatums=bLength||.0625,this.metro=new p5.Metro,this.metro._init(),this.metro.beatLength(this.tatums),this.metro.setBPM(BPM),p5sound.parts.push(this),this.callback=function(){}},p5.Part.prototype.setBPM=function(tempo,rampTime){this.metro.setBPM(tempo,rampTime)},p5.Part.prototype.getBPM=function(){return this.metro.getBPM()},p5.Part.prototype.start=function(time){if(!this.isPlaying){this.isPlaying=!0,this.metro.resetSync(this);var t=time||0;this.metro.start(t)}},p5.Part.prototype.loop=function(time){this.looping=!0,this.onended=function(){this.partStep=0};var t=time||0;this.start(t)},p5.Part.prototype.noLoop=function(){this.looping=!1,this.onended=function(){this.stop()}},p5.Part.prototype.stop=function(time){this.partStep=0,this.pause(time)},p5.Part.prototype.pause=function(time){this.isPlaying=!1;var t=time||0;this.metro.stop(t)},p5.Part.prototype.addPhrase=function(name,callback,array){var p;if(3===arguments.length)p=new p5.Phrase(name,callback,array);else{if(!(arguments[0]instanceof p5.Phrase))throw"invalid input. addPhrase accepts name, callback, array or a p5.Phrase";p=arguments[0]}this.phrases.push(p),p.sequence.length>this.length&&(this.length=p.sequence.length)},p5.Part.prototype.removePhrase=function(name){for(var i in this.phrases)this.phrases[i].name===name&&this.phrases.splice(i,1)},p5.Part.prototype.getPhrase=function(name){for(var i in this.phrases)if(this.phrases[i].name===name)return this.phrases[i]},p5.Part.prototype.replaceSequence=function(name,array){for(var i in this.phrases)this.phrases[i].name===name&&(this.phrases[i].sequence=array)},p5.Part.prototype.incrementStep=function(time){this.partStep<this.length-1?(this.callback(time),this.partStep+=1):this.looping||this.partStep!==this.length-1||(console.log("done"),this.onended())},p5.Part.prototype.onStep=function(callback){this.callback=callback},p5.Score=function(){this.parts=[],this.currentPart=0;var thisScore=this;for(var i in arguments)arguments[i]&&this.parts[i]&&(this.parts[i]=arguments[i],this.parts[i].nextPart=this.parts[i+1],this.parts[i].onended=function(){thisScore.resetPart(i),playNextPart(thisScore)});this.looping=!1},p5.Score.prototype.onended=function(){this.looping?this.parts[0].start():this.parts[this.parts.length-1].onended=function(){this.stop(),this.resetParts()},this.currentPart=0},p5.Score.prototype.start=function(){this.parts[this.currentPart].start(),this.scoreStep=0},p5.Score.prototype.stop=function(){this.parts[this.currentPart].stop(),this.currentPart=0,this.scoreStep=0},p5.Score.prototype.pause=function(){this.parts[this.currentPart].stop()},p5.Score.prototype.loop=function(){this.looping=!0,this.start()},p5.Score.prototype.noLoop=function(){this.looping=!1},p5.Score.prototype.resetParts=function(){var self=this;this.parts.forEach(function(part){self.resetParts[part]})},p5.Score.prototype.resetPart=function(i){for(var p in this.parts[i].stop(),this.parts[i].partStep=0,this.parts[i].phrases)this.parts[i]&&(this.parts[i].phrases[p].phraseStep=0)},p5.Score.prototype.setBPM=function(bpm,rampTime){for(var i in this.parts)this.parts[i]&&this.parts[i].setBPM(bpm,rampTime)}}(master),soundloop=function(){var p5sound=master,Clock=Tone_core_Clock;return p5.SoundLoop=function(callback,interval){this.callback=callback,this.musicalTimeMode="number"!=typeof this._interval,this._interval=interval||1,this._timeSignature=4,this._bpm=60,this.isPlaying=!1,this.maxIterations=1/0;var self=this;this.clock=new Clock({callback:function(time){var timeFromNow=time-p5sound.audiocontext.currentTime;timeFromNow>0&&self.iterations<=self.maxIterations&&self.callback(timeFromNow)},frequency:this._calcFreq()})},p5.SoundLoop.prototype.start=function(timeFromNow){var t=timeFromNow||0,now=p5sound.audiocontext.currentTime;this.isPlaying||(this.clock.start(now+t),this.isPlaying=!0)},p5.SoundLoop.prototype.stop=function(timeFromNow){var t=timeFromNow||0,now=p5sound.audiocontext.currentTime;this.isPlaying&&(this.clock.stop(now+t),this.isPlaying=!1)},p5.SoundLoop.prototype.pause=function(timeFromNow){var t=timeFromNow||0,now=p5sound.audiocontext.currentTime;this.isPlaying&&(this.clock.pause(now+t),this.isPlaying=!1)},p5.SoundLoop.prototype.syncedStart=function(otherLoop,timeFromNow){var t=timeFromNow||0,now=p5sound.audiocontext.currentTime;if(otherLoop.isPlaying){if(otherLoop.isPlaying){var time=otherLoop.clock._nextTick-p5sound.audiocontext.currentTime;this.clock.start(now+time),this.isPlaying=!0}}else otherLoop.clock.start(now+t),otherLoop.isPlaying=!0,this.clock.start(now+t),this.isPlaying=!0},p5.SoundLoop.prototype._update=function(){this.clock.frequency.value=this._calcFreq()},p5.SoundLoop.prototype._calcFreq=function(){return"number"==typeof this._interval?(this.musicalTimeMode=!1,1/this._interval):"string"==typeof this._interval?(this.musicalTimeMode=!0,this._bpm/60/this._convertNotation(this._interval)*(this._timeSignature/4)):void 0},p5.SoundLoop.prototype._convertNotation=function(value){var type=value.slice(-1);switch(value=Number(value.slice(0,-1)),type){case"m":return this._measure(value);case"n":return this._note(value);default:console.warn("Specified interval is not formatted correctly. See Tone.js timing reference for more info: https://github.com/Tonejs/Tone.js/wiki/Time")}},p5.SoundLoop.prototype._measure=function(value){return value*this._timeSignature},p5.SoundLoop.prototype._note=function(value){return this._timeSignature/value},Object.defineProperty(p5.SoundLoop.prototype,"bpm",{get:function(){return this._bpm},set:function(bpm){this.musicalTimeMode||console.warn('Changing the BPM in "seconds" mode has no effect. BPM is only relevant in musicalTimeMode when the interval is specified as a string ("2n", "4n", "1m"...etc)'),this._bpm=bpm,this._update()}}),Object.defineProperty(p5.SoundLoop.prototype,"timeSignature",{get:function(){return this._timeSignature},set:function(timeSig){this.musicalTimeMode||console.warn('Changing the timeSignature in "seconds" mode has no effect. BPM is only relevant in musicalTimeMode when the interval is specified as a string ("2n", "4n", "1m"...etc)'),this._timeSignature=timeSig,this._update()}}),Object.defineProperty(p5.SoundLoop.prototype,"interval",{get:function(){return this._interval},set:function(interval){this.musicalTimeMode="Number"!=typeof interval,this._interval=interval,this._update()}}),Object.defineProperty(p5.SoundLoop.prototype,"iterations",{get:function(){return this.clock.ticks}}),p5.SoundLoop}(master,Tone_core_Clock),compressor=function(){"use strict";var p5sound=master,Effect=effect,CustomError=errorHandler;return p5.Compressor=function(){Effect.call(this),this.compressor=this.ac.createDynamicsCompressor(),this.input.connect(this.compressor),this.compressor.connect(this.wet)},p5.Compressor.prototype=Object.create(Effect.prototype),p5.Compressor.prototype.process=function(src,attack,knee,ratio,threshold,release){src.connect(this.input),this.set(attack,knee,ratio,threshold,release)},p5.Compressor.prototype.set=function(attack,knee,ratio,threshold,release){void 0!==attack&&this.attack(attack),void 0!==knee&&this.knee(knee),void 0!==ratio&&this.ratio(ratio),void 0!==threshold&&this.threshold(threshold),void 0!==release&&this.release(release)},p5.Compressor.prototype.attack=function(attack,time){var t=time||0;return"number"==typeof attack?(this.compressor.attack.value=attack,this.compressor.attack.cancelScheduledValues(this.ac.currentTime+.01+t),this.compressor.attack.linearRampToValueAtTime(attack,this.ac.currentTime+.02+t)):void 0!==attack&&attack.connect(this.compressor.attack),this.compressor.attack.value},p5.Compressor.prototype.knee=function(knee,time){var t=time||0;return"number"==typeof knee?(this.compressor.knee.value=knee,this.compressor.knee.cancelScheduledValues(this.ac.currentTime+.01+t),this.compressor.knee.linearRampToValueAtTime(knee,this.ac.currentTime+.02+t)):void 0!==knee&&knee.connect(this.compressor.knee),this.compressor.knee.value},p5.Compressor.prototype.ratio=function(ratio,time){var t=time||0;return"number"==typeof ratio?(this.compressor.ratio.value=ratio,this.compressor.ratio.cancelScheduledValues(this.ac.currentTime+.01+t),this.compressor.ratio.linearRampToValueAtTime(ratio,this.ac.currentTime+.02+t)):void 0!==ratio&&ratio.connect(this.compressor.ratio),this.compressor.ratio.value},p5.Compressor.prototype.threshold=function(threshold,time){var t=time||0;return"number"==typeof threshold?(this.compressor.threshold.value=threshold,this.compressor.threshold.cancelScheduledValues(this.ac.currentTime+.01+t),this.compressor.threshold.linearRampToValueAtTime(threshold,this.ac.currentTime+.02+t)):void 0!==threshold&&threshold.connect(this.compressor.threshold),this.compressor.threshold.value},p5.Compressor.prototype.release=function(release,time){var t=time||0;return"number"==typeof release?(this.compressor.release.value=release,this.compressor.release.cancelScheduledValues(this.ac.currentTime+.01+t),this.compressor.release.linearRampToValueAtTime(release,this.ac.currentTime+.02+t)):"undefined"!=typeof number&&release.connect(this.compressor.release),this.compressor.release.value},p5.Compressor.prototype.reduction=function(){return this.compressor.reduction.value},p5.Compressor.prototype.dispose=function(){Effect.prototype.dispose.apply(this),this.compressor&&(this.compressor.disconnect(),delete this.compressor)},p5.Compressor}(master,effect,errorHandler),soundRecorder=function(){var p5sound=master,convertToWav=helpers.convertToWav,ac=p5sound.audiocontext;p5.SoundRecorder=function(){this.input=ac.createGain(),this.output=ac.createGain(),this.recording=!1,this.bufferSize=1024,this._channels=2,this._clear(),this._jsNode=ac.createScriptProcessor(this.bufferSize,this._channels,2),this._jsNode.onaudioprocess=this._audioprocess.bind(this),this._callback=function(){},this._jsNode.connect(p5.soundOut._silentNode),this.setInput(),p5sound.soundArray.push(this)},p5.SoundRecorder.prototype.setInput=function(unit){this.input.disconnect(),this.input=null,this.input=ac.createGain(),this.input.connect(this._jsNode),this.input.connect(this.output),unit?unit.connect(this.input):p5.soundOut.output.connect(this.input)},p5.SoundRecorder.prototype.record=function(sFile,duration,callback){this.recording=!0,duration&&(this.sampleLimit=Math.round(duration*ac.sampleRate)),sFile&&callback?this._callback=function(){this.buffer=this._getBuffer(),sFile.setBuffer(this.buffer),callback()}:sFile&&(this._callback=function(){this.buffer=this._getBuffer(),sFile.setBuffer(this.buffer)})},p5.SoundRecorder.prototype.stop=function(){this.recording=!1,this._callback(),this._clear()},p5.SoundRecorder.prototype._clear=function(){this._leftBuffers=[],this._rightBuffers=[],this.recordedSamples=0,this.sampleLimit=null},p5.SoundRecorder.prototype._audioprocess=function(event){if(!1!==this.recording&&!0===this.recording)if(this.sampleLimit&&this.recordedSamples>=this.sampleLimit)this.stop();else{var left=event.inputBuffer.getChannelData(0),right=event.inputBuffer.getChannelData(1);this._leftBuffers.push(new Float32Array(left)),this._rightBuffers.push(new Float32Array(right)),this.recordedSamples+=this.bufferSize}},p5.SoundRecorder.prototype._getBuffer=function(){var buffers=[];return buffers.push(this._mergeBuffers(this._leftBuffers)),buffers.push(this._mergeBuffers(this._rightBuffers)),buffers},p5.SoundRecorder.prototype._mergeBuffers=function(channelBuffer){for(var result=new Float32Array(this.recordedSamples),offset=0,lng=channelBuffer.length,i=0;i<lng;i++){var buffer=channelBuffer[i];result.set(buffer,offset),offset+=buffer.length}return result},p5.SoundRecorder.prototype.dispose=function(){this._clear();var index=p5sound.soundArray.indexOf(this);p5sound.soundArray.splice(index,1),this._callback=function(){},this.input&&this.input.disconnect(),this.input=null,this._jsNode=null},p5.prototype.saveSound=function(soundFile,fileName){const dataView=convertToWav(soundFile.buffer);p5.prototype.writeFile([dataView],fileName,"wav")}}(master,helpers),p5.PeakDetect=function(freq1,freq2,threshold,_framesPerPeak){this.framesPerPeak=_framesPerPeak||20,this.framesSinceLastPeak=0,this.decayRate=.95,this.threshold=threshold||.35,this.cutoff=0,this.cutoffMult=1.5,this.energy=0,this.penergy=0,this.currentValue=0,this.isDetected=!1,this.f1=freq1||40,this.f2=freq2||2e4,this._onPeak=function(){}},p5.PeakDetect.prototype.update=function(fftObject){var nrg=this.energy=fftObject.getEnergy(this.f1,this.f2)/255;nrg>this.cutoff&&nrg>this.threshold&&nrg-this.penergy>0?(this._onPeak(),this.isDetected=!0,this.cutoff=nrg*this.cutoffMult,this.framesSinceLastPeak=0):(this.isDetected=!1,this.framesSinceLastPeak<=this.framesPerPeak?this.framesSinceLastPeak++:(this.cutoff*=this.decayRate,this.cutoff=Math.max(this.cutoff,this.threshold))),this.currentValue=nrg,this.penergy=nrg},peakdetect=void(p5.PeakDetect.prototype.onPeak=function(callback,val){var self=this;self._onPeak=function(){callback(self.energy,val)}}),gain=function(){var p5sound=master;p5.Gain=function(){this.ac=p5sound.audiocontext,this.input=this.ac.createGain(),this.output=this.ac.createGain(),this.input.gain.value=.5,this.input.connect(this.output),p5sound.soundArray.push(this)},p5.Gain.prototype.setInput=function(src){src.connect(this.input)},p5.Gain.prototype.connect=function(unit){var u=unit||p5.soundOut.input;this.output.connect(u.input?u.input:u)},p5.Gain.prototype.disconnect=function(){this.output&&this.output.disconnect()},p5.Gain.prototype.amp=function(vol,rampTime,tFromNow){var rampTime=rampTime||0,tFromNow=tFromNow||0,now=p5sound.audiocontext.currentTime,currentVol=this.output.gain.value;this.output.gain.cancelScheduledValues(now),this.output.gain.linearRampToValueAtTime(currentVol,now+tFromNow),this.output.gain.linearRampToValueAtTime(vol,now+tFromNow+rampTime)},p5.Gain.prototype.dispose=function(){var index=p5sound.soundArray.indexOf(this);p5sound.soundArray.splice(index,1),this.output&&(this.output.disconnect(),delete this.output),this.input&&(this.input.disconnect(),delete this.input)}}(master),audioVoice=function(){var p5sound=master;return p5.AudioVoice=function(){this.ac=p5sound.audiocontext,this.output=this.ac.createGain(),this.connect(),p5sound.soundArray.push(this)},p5.AudioVoice.prototype.play=function(note,velocity,secondsFromNow,sustime){},p5.AudioVoice.prototype.triggerAttack=function(note,velocity,secondsFromNow){},p5.AudioVoice.prototype.triggerRelease=function(secondsFromNow){},p5.AudioVoice.prototype.amp=function(vol,rampTime){},p5.AudioVoice.prototype.connect=function(unit){var u=unit||p5sound.input;this.output.connect(u.input?u.input:u)},p5.AudioVoice.prototype.disconnect=function(){this.output.disconnect()},p5.AudioVoice.prototype.dispose=function(){this.output&&(this.output.disconnect(),delete this.output)},p5.AudioVoice}(master),monosynth=function(){var p5sound=master,AudioVoice=audioVoice,noteToFreq=helpers.noteToFreq,DEFAULT_SUSTAIN=.15;p5.MonoSynth=function(){AudioVoice.call(this),this.oscillator=new p5.Oscillator,this.env=new p5.Envelope,this.env.setRange(1,0),this.env.setExp(!0),this.setADSR(.02,.25,.05,.35),this.oscillator.disconnect(),this.oscillator.connect(this.output),this.env.disconnect(),this.env.setInput(this.output.gain),this.oscillator.output.gain.value=1,this.oscillator.start(),this.connect(),p5sound.soundArray.push(this)},p5.MonoSynth.prototype=Object.create(p5.AudioVoice.prototype),p5.MonoSynth.prototype.play=function(note,velocity,secondsFromNow,susTime){this.triggerAttack(note,velocity,~~secondsFromNow),this.triggerRelease(~~secondsFromNow+(susTime||.15))},p5.MonoSynth.prototype.triggerAttack=function(note,velocity,secondsFromNow){var secondsFromNow=~~secondsFromNow,freq=noteToFreq(note),vel=velocity||.1;this.oscillator.freq(freq,0,secondsFromNow),this.env.ramp(this.output.gain,secondsFromNow,vel)},p5.MonoSynth.prototype.triggerRelease=function(secondsFromNow){var secondsFromNow=secondsFromNow||0;this.env.ramp(this.output.gain,secondsFromNow,0)},p5.MonoSynth.prototype.setADSR=function(attack,decay,sustain,release){this.env.setADSR(attack,decay,sustain,release)},Object.defineProperties(p5.MonoSynth.prototype,{attack:{get:function(){return this.env.aTime},set:function(attack){this.env.setADSR(attack,this.env.dTime,this.env.sPercent,this.env.rTime)}},decay:{get:function(){return this.env.dTime},set:function(decay){this.env.setADSR(this.env.aTime,decay,this.env.sPercent,this.env.rTime)}},sustain:{get:function(){return this.env.sPercent},set:function(sustain){this.env.setADSR(this.env.aTime,this.env.dTime,sustain,this.env.rTime)}},release:{get:function(){return this.env.rTime},set:function(release){this.env.setADSR(this.env.aTime,this.env.dTime,this.env.sPercent,release)}}}),p5.MonoSynth.prototype.amp=function(vol,rampTime){var t=rampTime||0;return void 0!==vol&&this.oscillator.amp(vol,t),this.oscillator.amp().value},p5.MonoSynth.prototype.connect=function(unit){var u=unit||p5sound.input;this.output.connect(u.input?u.input:u)},p5.MonoSynth.prototype.disconnect=function(){this.output&&this.output.disconnect()},p5.MonoSynth.prototype.dispose=function(){AudioVoice.prototype.dispose.apply(this),this.env&&this.env.dispose(),this.oscillator&&this.oscillator.dispose()}}(master,audioVoice,helpers),polysynth=function(){var p5sound=master,TimelineSignal=Tone_signal_TimelineSignal,noteToFreq=helpers.noteToFreq;p5.PolySynth=function(audioVoice,maxVoices){this.audiovoices=[],this.notes={},this._newest=0,this._oldest=0,this.maxVoices=maxVoices||8,this.AudioVoice=void 0===audioVoice?p5.MonoSynth:audioVoice,this._voicesInUse=new TimelineSignal(0),this.output=p5sound.audiocontext.createGain(),this.connect(),this._allocateVoices(),p5sound.soundArray.push(this)},p5.PolySynth.prototype._allocateVoices=function(){for(var i=0;i<this.maxVoices;i++)this.audiovoices.push(new this.AudioVoice),this.audiovoices[i].disconnect(),this.audiovoices[i].connect(this.output)},p5.PolySynth.prototype.play=function(note,velocity,secondsFromNow,susTime){var susTime=susTime||1;this.noteAttack(note,velocity,secondsFromNow),this.noteRelease(note,secondsFromNow+susTime)},p5.PolySynth.prototype.noteADSR=function(note,a,d,s,r,timeFromNow){var now,timeFromNow,t=p5sound.audiocontext.currentTime+(timeFromNow=timeFromNow||0);this.audiovoices[this.notes[note].getValueAtTime(t)].setADSR(a,d,s,r)},p5.PolySynth.prototype.setADSR=function(a,d,s,r){this.audiovoices.forEach(function(voice){voice.setADSR(a,d,s,r)})},p5.PolySynth.prototype.noteAttack=function(_note,_velocity,secondsFromNow){var secondsFromNow=~~secondsFromNow,acTime=p5sound.audiocontext.currentTime+secondsFromNow,note=noteToFreq(_note),velocity=_velocity||.1,currentVoice;if(this.notes[note]&&null!==this.notes[note].getValueAtTime(acTime)&&this.noteRelease(note,0),this._voicesInUse.getValueAtTime(acTime)<this.maxVoices)currentVoice=Math.max(~~this._voicesInUse.getValueAtTime(acTime),0);else{currentVoice=this._oldest;var oldestNote=p5.prototype.freqToMidi(this.audiovoices[this._oldest].oscillator.freq().value);this.noteRelease(oldestNote),this._oldest=(this._oldest+1)%(this.maxVoices-1)}this.notes[note]=new TimelineSignal,this.notes[note].setValueAtTime(currentVoice,acTime);var previousVal=null===this._voicesInUse._searchBefore(acTime)?0:this._voicesInUse._searchBefore(acTime).value;if(this._voicesInUse.setValueAtTime(previousVal+1,acTime),this._updateAfter(acTime,1),this._newest=currentVoice,"number"==typeof velocity){var maxRange=1/this._voicesInUse.getValueAtTime(acTime)*2;velocity=velocity>maxRange?maxRange:velocity}this.audiovoices[currentVoice].triggerAttack(note,velocity,secondsFromNow)},p5.PolySynth.prototype._updateAfter=function(time,value){if(null!==this._voicesInUse._searchAfter(time)){this._voicesInUse._searchAfter(time).value+=value;var nextTime=this._voicesInUse._searchAfter(time).time;this._updateAfter(nextTime,value)}},p5.PolySynth.prototype.noteRelease=function(_note,secondsFromNow){var now=p5sound.audiocontext.currentTime,tFromNow=secondsFromNow||0,t=now+tFromNow;if(_note){var note=noteToFreq(_note);if(this.notes[note]&&null!==this.notes[note].getValueAtTime(t)){var previousVal=Math.max(~~this._voicesInUse.getValueAtTime(t).value,1);this._voicesInUse.setValueAtTime(previousVal-1,t),previousVal>0&&this._updateAfter(t,-1),this.audiovoices[this.notes[note].getValueAtTime(t)].triggerRelease(tFromNow),this.notes[note].dispose(),delete this.notes[note],this._newest=0===this._newest?0:(this._newest-1)%(this.maxVoices-1)}else console.warn("Cannot release a note that is not already playing")}else for(var n in this.audiovoices.forEach(function(voice){voice.triggerRelease(tFromNow)}),this._voicesInUse.setValueAtTime(0,t),this.notes)this.notes[n].dispose(),delete this.notes[n]},p5.PolySynth.prototype.connect=function(unit){var u=unit||p5sound.input;this.output.connect(u.input?u.input:u)},p5.PolySynth.prototype.disconnect=function(){this.output&&this.output.disconnect()},p5.PolySynth.prototype.dispose=function(){this.audiovoices.forEach(function(voice){voice.dispose()}),this.output&&(this.output.disconnect(),delete this.output)}}(master,Tone_signal_TimelineSignal,helpers),distortion=function(){var Effect=effect;function makeDistortionCurve(amount){for(var k="number"==typeof amount?amount:50,numSamples=44100,curve=new Float32Array(44100),deg=Math.PI/180,i=0,x;i<44100;++i)x=2*i/44100-1,curve[i]=(3+k)*x*20*deg/(Math.PI+k*Math.abs(x));return curve}p5.Distortion=function(amount,oversample){if(Effect.call(this),void 0===amount&&(amount=.25),"number"!=typeof amount)throw new Error("amount must be a number");if(void 0===oversample&&(oversample="2x"),"string"!=typeof oversample)throw new Error("oversample must be a String");var curveAmount=p5.prototype.map(amount,0,1,0,2e3);this.waveShaperNode=this.ac.createWaveShaper(),this.amount=curveAmount,this.waveShaperNode.curve=makeDistortionCurve(curveAmount),this.waveShaperNode.oversample=oversample,this.input.connect(this.waveShaperNode),this.waveShaperNode.connect(this.wet)},p5.Distortion.prototype=Object.create(Effect.prototype),p5.Distortion.prototype.process=function(src,amount,oversample){src.connect(this.input),this.set(amount,oversample)},p5.Distortion.prototype.set=function(amount,oversample){if(amount){var curveAmount=p5.prototype.map(amount,0,1,0,2e3);this.amount=curveAmount,this.waveShaperNode.curve=makeDistortionCurve(curveAmount)}oversample&&(this.waveShaperNode.oversample=oversample)},p5.Distortion.prototype.getAmount=function(){return this.amount},p5.Distortion.prototype.getOversample=function(){return this.waveShaperNode.oversample},p5.Distortion.prototype.dispose=function(){Effect.prototype.dispose.apply(this),this.waveShaperNode&&(this.waveShaperNode.disconnect(),this.waveShaperNode=null)}}(effect),src_app=master});